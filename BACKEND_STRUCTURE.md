# Backend Structure Overview

## ğŸ“ Directory Structure

```
backend/
â”œâ”€â”€ wsgi.py                    # Flask app factory & WSGI entry point
â””â”€â”€ app/
    â”œâ”€â”€ __init__.py            # Package initialization
    â”œâ”€â”€ config.py              # Configuration constants & env vars
    â”œâ”€â”€ extensions.py          # Flask extensions (CORS, Firebase, Auth)
    â”‚
    â”œâ”€â”€ routes/                # Route blueprints (12 files, 46 routes)
    â”‚   â”œâ”€â”€ __init__.py        # Exports all blueprints
    â”‚   â”œâ”€â”€ health.py           # Health checks
    â”‚   â”œâ”€â”€ spa.py             # SPA serving
    â”‚   â”œâ”€â”€ gmail_oauth.py     # Gmail OAuth
    â”‚   â”œâ”€â”€ emails.py          # Email generation
    â”‚   â”œâ”€â”€ contacts.py        # Contact CRUD
    â”‚   â”œâ”€â”€ directory.py       # Directory operations
    â”‚   â”œâ”€â”€ runs.py            # Free/Pro tier searches
    â”‚   â”œâ”€â”€ enrichment.py     # Autocomplete/enrichment
    â”‚   â”œâ”€â”€ resume.py          # Resume parsing
    â”‚   â”œâ”€â”€ coffee_chat_prep.py # Coffee chat preps
    â”‚   â”œâ”€â”€ billing.py         # Stripe/billing
    â”‚   â””â”€â”€ users.py           # User management
    â”‚
    â”œâ”€â”€ services/              # Business logic & external integrations (10 files)
    â”‚   â”œâ”€â”€ __init__.py
    â”‚   â”œâ”€â”€ auth.py            # Authentication & credits
    â”‚   â”œâ”€â”€ firebase.py        # Firebase initialization
    â”‚   â”œâ”€â”€ gmail_client.py    # Gmail OAuth & API
    â”‚   â”œâ”€â”€ openai_client.py   # OpenAI client
    â”‚   â”œâ”€â”€ pdl_client.py      # PDL API client
    â”‚   â”œâ”€â”€ reply_generation.py # Email generation
    â”‚   â”œâ”€â”€ directory_search.py # Directory search
    â”‚   â”œâ”€â”€ resume_parser.py  # Resume parsing
    â”‚   â”œâ”€â”€ pdf_builder.py     # PDF generation
    â”‚   â””â”€â”€ stripe_client.py   # Stripe webhooks
    â”‚
    â”œâ”€â”€ utils/                 # Shared utility functions (3 files)
    â”‚   â”œâ”€â”€ __init__.py
    â”‚   â”œâ”€â”€ contact.py         # Contact utilities
    â”‚   â”œâ”€â”€ users.py           # User utilities
    â”‚   â””â”€â”€ coffee_chat_prep.py # Coffee chat utilities
    â”‚
    â””â”€â”€ models/                # Data models & schemas (4 files)
        â”œâ”€â”€ __init__.py        # Exports all models
        â”œâ”€â”€ enums.py           # Enum definitions
        â”œâ”€â”€ contact.py         # Contact normalization
        â”œâ”€â”€ users.py           # User data models
        â””â”€â”€ coffee_chat_prep.py # Coffee chat prep models
```

---

## ğŸ“ About `__pycache__` Directories

### What are `__pycache__` files?

**`__pycache__`** directories contain Python bytecode cache files (`.pyc` files). These are:
- âœ… **Automatically generated** by Python when modules are imported
- âœ… **Performance optimization** - speeds up subsequent imports
- âœ… **Safe to ignore** - Python manages them automatically
- âœ… **Already in `.gitignore`** - won't be committed to git

### Example Structure:
```
backend/app/__pycache__/
  â””â”€â”€ __init__.cpython-312.pyc  â† Auto-generated bytecode
```

### What to do:
- âœ… **Nothing** - they're already in `.gitignore`
- âœ… Python will regenerate them automatically
- âœ… Can be safely deleted (they'll regenerate)

---

## ğŸ“¦ Model Files Status

### âœ… `models/users.py`
**Functions:**
- `create_user_data()` - Create user structure for Firestore
- `update_user_tier_data()` - Create tier update data
- `validate_user_tier()` - Validate tier values
- `get_default_credits_for_tier()` - Get default credits

### âœ… `models/coffee_chat_prep.py`
**Functions:**
- `create_coffee_chat_prep_data()` - Create prep structure
- `update_coffee_chat_prep_status()` - Update prep status
- `validate_prep_status()` - Validate status values
- `format_coffee_chat_prep_response()` - Format API response

### âœ… `models/contact.py`
**Functions:**
- `normalize_contact()` - Normalize contact data for storage

### âœ… `models/enums.py`
**Enums:**
- `ContactStatus` - Contact status enumeration
- `UserTier` - User tier enumeration
- `SearchType` - Search type enumeration

### âœ… `models/__init__.py`
**Exports:**
- All model functions
- All enums
- Clean import interface

---

## ğŸ”„ Import Pattern

All imports use absolute paths:
```python
from app.config import TIER_CONFIGS
from app.extensions import require_firebase_auth, get_db
from app.services.pdl_client import search_contacts_with_pdl
from app.utils.users import get_university_shorthand
from app.models.users import create_user_data
```

---

## ğŸš€ Running the App

### Option 1: Using root app.py shim
```bash
python app.py
```

### Option 2: Directly from backend
```bash
cd backend
python wsgi.py
```

### Option 3: With WSGI server
```bash
gunicorn backend.wsgi:app
```

---

## âœ… Verification

All files verified:
- âœ… 46 routes registered
- âœ… 12 blueprints loaded
- âœ… All models imported successfully
- âœ… No linter errors
- âœ… All imports resolved

**Status:** âœ… **REFACTORING COMPLETE**

