import{r,j as e,J as se,m as Z,a9 as Ye,X as Ie,l as We,u as je,a7 as Se,aa as Ue,ab as ue,U as be,ac as Be,M as ne,ad as Pe,F as ve,E as me,ae as ze,af as Ve,ag as He,ah as qe,ai as Je,aj as Ke,ak as Xe,al as De,k as Ze,i as Re,q as Qe,G as et,am as tt,an as Ce,ao as ye,ap as Me,aq as ie,ar as Ae,as as st,at as Le,au as Oe,O as Ne,av as at,z as rt,W as nt,Y as ot,$ as it,aw as lt,ax as ct}from"./vendor-react-b5qb9EdN.js";import{S as dt,A as mt,a as ut}from"./AppSidebar-CzbZqumK.js";import{B as q,u as we,a as oe,c as ce,e as ke}from"./index-B_VQ6MHu.js";import{f as W}from"./firebaseApi-DtNS3LbF.js";import{a as K}from"./api-DAvNaJNf.js";import{c as ht,l as xt,a as ft,g as gt,b as pt}from"./activityLogger-CbH2wuv3.js";import{T as le}from"./vendor-firebase-C23ypVz2.js";import{L as J,S as he,a as xe,b as fe,c as ge,d as ee}from"./select-7D7xiRiQ.js";import{T as de}from"./textarea-B4On5PE6.js";import{I as re}from"./input-JHROAKOp.js";import{B as Te}from"./badge-DSdGnCIA.js";import{D as bt,c as yt,d as jt,e as vt,P as Nt,a as wt,b as St,f as Dt}from"./popover-DonP5JXb.js";import{o as te,a as Fe,s as Ct,e as Mt,F as kt,G as Tt,c as Ft}from"./vendor-dates-CPvpAlHY.js";import{P as $t}from"./PageHeaderActions-DWjEuDKF.js";function $e({onSubmit:t,isLoading:c,isUpdate:u=!1,existingPrompt:n=""}){const[d,b]=r.useState(n);r.useEffect(()=>{n&&b(n)},[n]);const S=async i=>{i.preventDefault(),!(!u&&!d.trim())&&(await t(d.trim()),u||b(""))};return e.jsxs("form",{onSubmit:S,className:"space-y-4 p-6 bg-card border border-border rounded-xl",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{htmlFor:"prompt",children:u?"Update your timeline with AI (optional)":"Describe your recruiting goals"}),e.jsx(de,{id:"prompt",value:d,onChange:i=>b(i.target.value),placeholder:u?"e.g., Add a networking phase in December, or change the application deadline to March 2027...":"e.g., I'm recruiting for Investment Banking Analyst roles starting in January 2024. I want to submit 30 applications by June 2024 and start working by August 2024.",rows:u?3:4,required:!u,disabled:c,className:"resize-none"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:u?"Describe changes you want to make to your timeline. Leave empty to manually edit by dragging and clicking phases above.":"Include details like: role/industry, start date, target deadline, number of applications, and any specific goals."})]}),e.jsx(q,{type:"submit",disabled:c||!u&&!d.trim(),className:"w-full",variant:d.trim()||!u?"default":"outline",children:c?e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"mr-2 h-4 w-4 animate-spin"}),u?"Updating Timeline...":"Generating Timeline..."]}):u?d.trim()?"Update Timeline":"Generate New Timeline":"Generate Timeline"})]})}function Et({phases:t,startDate:c,targetDeadline:u,onUpdate:n}){const d=r.useRef(null),[b,S]=r.useState(new Date),[i,p]=r.useState(null),[j,v]=r.useState(t),[E,R]=r.useState(null),[I,U]=r.useState(null);r.useEffect(()=>{v(t)},[t]);const P=s=>new Date(s+"T00:00:00"),A=s=>new Date(s.getFullYear(),s.getMonth(),1),L=(s,m)=>{const y=new Date(s);return y.setMonth(y.getMonth()+m),y},k=(s,m)=>{const y=s.getFullYear()-m.getFullYear(),G=s.getMonth()-m.getMonth();return y*12+G},F=(s,m)=>s.getFullYear()===m.getFullYear()&&s.getMonth()===m.getMonth(),D=s=>["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][s.getMonth()],$=s=>`${["January","February","March","April","May","June","July","August","September","October","November","December"][s.getMonth()]} ${s.getFullYear()}`,O=(s,m)=>{if(!s||typeof s!="string")return console.warn(`âš ï¸ Invalid month string: ${s}, using baseDate`),m;const y=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"],G=["january","february","march","april","may","june","july","august","september","october","november","december"],Y=s.toLowerCase().trim();let z=y.findIndex(M=>Y.startsWith(M));if(z===-1&&(z=G.findIndex(M=>Y.startsWith(M))),z!==-1){const M=s.match(/\b(\d{4})\b/),H=M?parseInt(M[1]):m.getFullYear(),X=new Date(H,z,1);return console.log(`ðŸ“… Parsed "${s}" -> ${X.toISOString()}`),X}return console.warn(`âš ï¸ Could not parse month string: "${s}", using baseDate: ${m.toISOString()}`),m};let T=A(P(c)),a=A(P(u));const o=[];if(j.forEach(s=>{const m=O(s.startMonth,T),y=O(s.endMonth,T);o.push(m,y)}),o.length>0){const s=new Date(Math.min(...o.map(y=>y.getTime()))),m=new Date(Math.max(...o.map(y=>y.getTime())));s<T&&(console.log(`ðŸ“… Extending timeline start from ${T.toISOString()} to ${s.toISOString()} to include phases`),T=A(s)),m>a&&(console.log(`ðŸ“… Extending timeline end from ${a.toISOString()} to ${m.toISOString()} to include phases`),a=A(m))}const f=k(a,T)+1,x=[];for(let s=0;s<f;s++)x.push(L(T,s));console.log(`ðŸ“… Timeline range: ${T.toISOString()} to ${a.toISOString()}, ${f} months`);const w=x.findIndex(s=>F(s,b)),_=j.map(s=>{const m=O(s.startMonth,T),y=O(s.endMonth,T),G=x.findIndex(M=>F(M,m)),Y=x.findIndex(M=>F(M,y)),z={phase:s,startIndex:G>=0?G:0,endIndex:Y>=0?Y:f-1,phaseStart:m,phaseEnd:y};return console.log(`ðŸ“… Phase "${s.name}": startMonth="${s.startMonth}" -> ${m.toISOString()}, endMonth="${s.endMonth}" -> ${y.toISOString()}, startIndex=${z.startIndex}, endIndex=${z.endIndex}`),z});console.log(`ðŸ” Total phases: ${j.length}, phasePositions:`,_);const N=s=>{R(s)},h=s=>{E!==null&&U(s)},g=s=>{if(E===null)return;const m=x[s],y=[...j],G=y[E],Y=$(m),z=k(O(G.endMonth,T),O(G.startMonth,T)),M=L(m,z),H=$(M);y[E]={...G,startMonth:Y,endMonth:H},v(y),R(null),U(null),n&&n(y)},C=s=>{p(s)},B=(s,m)=>{const y=[...j];y[s]=m,v(y),p(null),n&&n(y)},V=()=>{p(null)};r.useEffect(()=>{if(d.current&&w>=0){const m=w*200-d.current.clientWidth/2;d.current.scrollTo({left:Math.max(0,m),behavior:"smooth"})}},[w]);const l=w>=0?w/(f-1||1)*100:0;return e.jsx("div",{className:"w-full max-w-full bg-card border border-border rounded-xl overflow-hidden",children:e.jsx("div",{className:"px-4 sm:px-6 lg:px-8 py-8",children:e.jsx("div",{ref:d,className:"overflow-x-auto pb-4 w-full",style:{scrollbarWidth:"thin",scrollbarColor:"rgba(139, 92, 246, 0.3) transparent"},children:e.jsxs("div",{className:"relative",style:{minWidth:`${Math.max(f*180,600)}px`,height:"220px",paddingLeft:"75px",paddingRight:"75px"},children:[e.jsx("div",{className:"absolute top-[70px] left-[75px] right-[75px] h-[3px] z-0",children:e.jsx("div",{className:"w-full h-full rounded-full",style:{background:"linear-gradient(to right, #8B5CF6, #D946EF)"}})}),e.jsx("div",{className:"relative flex justify-between items-start h-full",children:x.map((s,m)=>{const y=m===w,G=m<w,Y=m/(f-1||1)*100,z=_.filter(M=>M.startIndex===m);return e.jsxs("div",{className:"flex flex-col items-center absolute",style:{left:`${Y}%`,transform:"translateX(-50%)",width:"150px"},onMouseEnter:()=>h(m),onMouseUp:()=>{E!==null&&g(m)},children:[e.jsx("div",{className:`font-medium mb-3 ${y?"text-black font-semibold":"text-black"}`,children:D(s)}),e.jsx("div",{className:"relative z-10 mb-3",children:(()=>{const M=z.length>0,H=_.find(Q=>Q.startIndex<=w&&Q.endIndex>=w);return M||m===w&&H?e.jsx(Z.div,{className:"w-[10px] h-[10px] rounded-full gradient-bg",style:{boxShadow:"0 0 12px rgba(139, 92, 246, 0.6), 0 0 24px rgba(217, 70, 239, 0.4)"},animate:{scale:[.8,1.1,.8]},transition:{duration:2,repeat:1/0,ease:"easeInOut"}}):e.jsx("div",{className:"w-[10px] h-[10px] rounded-full bg-black border-2 border-black"})})()}),e.jsx("div",{className:"w-[1px] h-10 bg-border/50 mb-2"}),z.length>0&&e.jsx("div",{className:"flex flex-col gap-2 mt-2",style:{minWidth:"150px"},children:z.map((M,H)=>{const X=M.startIndex<=w&&M.endIndex>=w;return e.jsxs(Z.div,{className:`px-4 py-3 rounded-xl border-2 text-center text-sm transition-all relative group ${X?"bg-gradient-to-br from-blue-500/20 via-blue-400/20 to-blue-600/20 border-blue-400 shadow-lg shadow-blue-500/20":"bg-gradient-to-br from-slate-50 to-slate-100 border-slate-300 hover:border-blue-300 hover:shadow-md"}`,initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:H*.1},whileHover:{y:-4,scale:1.02,transition:{duration:.2}},draggable:!0,onDragStart:()=>N(_.indexOf(M)),style:{cursor:"grab"},onDragEnd:()=>{R(null),U(null)},children:[e.jsx("button",{onClick:()=>C(_.indexOf(M)),className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity p-1 rounded hover:bg-white/20",children:e.jsx(Ye,{className:"h-3 w-3 text-gray-600"})}),i===_.indexOf(M)?e.jsx(It,{phase:M.phase,onSave:Q=>B(_.indexOf(M),Q),onCancel:V}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`font-semibold mb-1 ${X?"text-blue-700":"text-slate-700"}`,children:M.phase.name}),e.jsx("div",{className:`text-xs leading-relaxed ${X?"text-blue-600":"text-slate-600"}`,children:M.phase.description}),M.phase.goals&&M.phase.goals.length>0&&e.jsx("div",{className:"mt-2 pt-2 border-t border-purple-200/50",children:e.jsx("div",{className:"text-xs space-y-1 text-left",children:M.phase.goals.slice(0,2).map((Q,_e)=>e.jsxs("div",{className:"flex items-start gap-1.5",children:[e.jsx("span",{className:"text-blue-500 mt-0.5",children:"â€¢"}),e.jsx("span",{className:X?"text-blue-600":"text-slate-500",children:Q})]},_e))})})]})]},`${M.phase.name}-${m}-${H}`)})})]},m)})}),w>=0&&e.jsx(Z.div,{className:"absolute top-0 z-20",style:{left:`calc(${l}% + 75px)`,transform:"translateX(-50%)"},initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{delay:.3,duration:.5},children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(Z.div,{className:"mb-2 px-3 py-1.5 rounded-full gradient-bg text-white text-xs font-medium shadow-lg",animate:{y:[0,-3,0]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:"You Are Here"}),e.jsx("div",{className:"w-[3px] h-[66px] rounded-full",style:{background:"linear-gradient(to bottom, #8B5CF6, #D946EF)"}}),e.jsx(Z.div,{className:"relative",animate:{boxShadow:["0 0 0 0 rgba(139, 92, 246, 0.6)","0 0 0 10px rgba(139, 92, 246, 0)","0 0 0 0 rgba(139, 92, 246, 0)"]},transition:{duration:2,repeat:1/0,ease:"easeInOut"},children:e.jsx("div",{className:"w-4 h-4 rounded-full gradient-bg",style:{boxShadow:"0 2px 8px rgba(139, 92, 246, 0.4)"}})})]})})]})})})})}function It({phase:t,onSave:c,onCancel:u}){const[n,d]=r.useState(t.name),[b,S]=r.useState(t.description),[i,p]=r.useState(t.goals.join(`
`)),j=()=>{c({...t,name:n,description:b,goals:i.split(`
`).filter(v=>v.trim())})};return e.jsxs("div",{className:"space-y-2 text-left",children:[e.jsx(re,{value:n,onChange:v=>d(v.target.value),placeholder:"Phase name",className:"text-sm"}),e.jsx(de,{value:b,onChange:v=>S(v.target.value),placeholder:"Description",rows:2,className:"text-xs resize-none"}),e.jsx(de,{value:i,onChange:v=>p(v.target.value),placeholder:"Goals (one per line)",rows:2,className:"text-xs resize-none"}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(q,{size:"sm",variant:"ghost",onClick:u,children:e.jsx(Ie,{className:"h-3 w-3"})}),e.jsx(q,{size:"sm",onClick:j,children:e.jsx(We,{className:"h-3 w-3"})})]})]})}function Pt(){var L;const[t,c]=r.useState(null),[u,n]=r.useState(""),[d,b]=r.useState(""),[S,i]=r.useState(""),[p,j]=r.useState(!1),[v,E]=r.useState(!0),{toast:R}=we(),{user:I}=oe();r.useEffect(()=>{let k=!0;return(async()=>{if(!(I!=null&&I.uid)){E(!1);return}try{const D=await W.getTimeline(I.uid);k&&D&&D.phases&&D.phases.length>0&&(c($=>$||{phases:D.phases}),n($=>$||D.startDate),b($=>$||D.targetDeadline),D.lastPrompt?i(D.lastPrompt):i(""),console.log("âœ… Loaded saved timeline:",D))}catch(D){console.error("âŒ Failed to load saved timeline:",D)}finally{k&&E(!1)}})(),()=>{k=!1}},[I==null?void 0:I.uid]);const U=async(k,F,D,$)=>{if(!(!(I!=null&&I.uid)||!k||!F||!D))try{await W.saveTimeline(I.uid,{phases:k,startDate:F,targetDeadline:D,lastPrompt:$||S}),console.log("âœ… Timeline saved")}catch(O){console.error("âŒ Failed to save timeline:",O)}},P=async k=>{var D,$,O,T,a;const F=t&&u&&d;if(!F&&!k.trim()){R({variant:"destructive",title:"Prompt Required",description:"Please enter a prompt to generate your timeline."});return}if(!(F&&!k.trim())){j(!0);try{const o=F?{phases:t.phases,startDate:u,targetDeadline:d}:void 0,f=await K.generateTimeline(k,F,o);console.log("âœ… Timeline result:",f),console.log("ðŸ“Š Timeline phases count:",(($=(D=f.timeline)==null?void 0:D.phases)==null?void 0:$.length)||0),console.log("ðŸ“Š Timeline phases:",(O=f.timeline)==null?void 0:O.phases),c(f.timeline),n(f.startDate),b(f.targetDeadline),i(k),console.log("âœ… State set - timelineData:",f.timeline,"startDate:",f.startDate,"targetDeadline:",f.targetDeadline),console.log("ðŸ“Š Phases in state:",(a=(T=f.timeline)==null?void 0:T.phases)==null?void 0:a.map(x=>({name:x.name,startMonth:x.startMonth,endMonth:x.endMonth}))),U(f.timeline.phases,f.startDate,f.targetDeadline,k).catch(x=>{console.error("âŒ Failed to save timeline:",x),R({variant:"destructive",title:"Save Warning",description:"Timeline generated but failed to save. It may not persist across sessions."})}),R({title:F?"Timeline Updated":"Timeline Generated",description:F?"Your timeline has been updated!":"Your personalized recruiting timeline has been created!"})}catch(o){console.error("âŒ Failed to generate timeline:",o),R({variant:"destructive",title:"Generation Failed",description:o.message||"Failed to generate timeline. Please try again."})}finally{j(!1)}}},A=async k=>{c({phases:k}),await U(k,u,d)};return console.log("ðŸ” Render - timelineData:",t),console.log("ðŸ” Render - phases count:",((L=t==null?void 0:t.phases)==null?void 0:L.length)||0),console.log("ðŸ” Render - startDate:",u,"targetDeadline:",d),v?e.jsx("div",{className:"space-y-6",children:e.jsx("div",{className:"text-sm text-muted-foreground",children:"Loading timeline..."})}):e.jsx("div",{className:"space-y-6",children:t&&u&&d?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h3",{className:"text-lg font-semibold",children:"Your Recruiting Timeline"})}),e.jsx(Et,{phases:t.phases,startDate:u,targetDeadline:d,onUpdate:A}),e.jsx("div",{className:"mt-6",children:e.jsx($e,{onSubmit:P,isLoading:p,isUpdate:!0,existingPrompt:S})})]}):e.jsx($e,{onSubmit:P,isLoading:p,isUpdate:!1})})}const zt=t=>{if(!t)return"Just now";const c=Date.now(),u=t.toMillis?t.toMillis():t,n=c-u,d=Math.floor(n/1e3),b=Math.floor(d/60),S=Math.floor(b/60),i=Math.floor(S/24);if(d<60)return"Just now";if(b<60)return`${b} ${b===1?"minute":"minutes"} ago`;if(S<24)return`${S} ${S===1?"hour":"hours"} ago`;if(i<7)return`${i} ${i===1?"day":"days"} ago`;const p=Math.floor(i/7);return`${p} ${p===1?"week":"weeks"} ago`},Rt=t=>{switch(t){case"firmSearch":return e.jsx(Pe,{size:16});case"contactSearch":return e.jsx(be,{size:16});case"coffeePrep":return e.jsx(ve,{size:16});case"interviewPrep":return e.jsx(ze,{size:16});default:return e.jsx(me,{size:16})}},At=t=>{switch(t){case"firmSearch":return"/firm-search";case"contactSearch":return"/contact-search";case"coffeePrep":return"/coffee-chat-prep";case"interviewPrep":return"/interview-prep";default:return"/home"}};function ae({icon:t,label:c,value:u,subtitle:n,progress:d,showProgress:b}){const i=2*Math.PI*45,p=d!==void 0?Math.min(100,Math.max(0,d)):0,j=i-p/100*i;return e.jsxs("div",{className:"bg-card border border-border rounded-xl p-6 transition-all h-[180px] flex flex-col overflow-visible shadow-sm transform hover:scale-[1.02]",children:[e.jsx("div",{className:"flex items-start justify-between mb-2",children:e.jsx("div",{className:`rounded-lg bg-purple-soft flex items-center justify-center ${r.isValidElement(t)&&t.type==="div"?"px-3 py-2":"w-10 h-10"}`,children:r.isValidElement(t)&&t.type==="div"?e.jsx("div",{className:"flex items-center gap-1",children:Re.Children.map(t.props.children,v=>r.isValidElement(v)?r.cloneElement(v,{stroke:"url(#kpi-icon-gradient)"}):v)}):r.isValidElement(t)?r.cloneElement(t,{className:"w-5 h-5",stroke:"url(#kpi-icon-gradient)"}):t})}),b&&d!==void 0?e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center -mt-2",children:[e.jsxs("div",{className:"relative flex items-center justify-center mb-2",style:{width:"90px",height:"90px"},children:[e.jsxs("svg",{className:"transform -rotate-90 absolute inset-0",width:"90",height:"90",viewBox:"0 0 90 90",style:{overflow:"visible"},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"circular-progress-gradient",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:"#06B6D4"}),e.jsx("stop",{offset:"100%",stopColor:"#a855f7"})]})}),e.jsx("circle",{cx:"45",cy:"45",r:45,stroke:"currentColor",strokeWidth:"10",fill:"none",className:"text-border"}),e.jsx("circle",{cx:"45",cy:"45",r:45,stroke:"url(#circular-progress-gradient)",strokeWidth:"10",fill:"none",strokeDasharray:i,strokeDashoffset:j,strokeLinecap:"round",className:"transition-all duration-500"})]}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-10",children:e.jsx("div",{className:"text-xl font-bold text-foreground",children:u})})]}),e.jsxs("div",{className:"text-center mt-1",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:c}),n&&e.jsx("div",{className:"text-xs text-muted-foreground mt-0.5",children:n})]})]}):e.jsxs("div",{className:"space-y-1.5 flex-1",children:[e.jsx("div",{className:"text-3xl font-bold text-foreground",children:u}),e.jsx("div",{className:"text-sm text-muted-foreground",children:c}),n&&e.jsx("div",{className:"text-xs text-muted-foreground",children:n})]})]})}function Lt(){const{user:t}=oe(),c=je(),u=Qe(),[n,d]=r.useState([]),[b,S]=r.useState(!0);r.useEffect(()=>{(async()=>{if(!(t!=null&&t.uid)){S(!1);return}try{console.log("ðŸ”„ Fetching activities for user:",t.uid);const j=await W.getActivities(t.uid,10);console.log("âœ… Fetched activities:",j),d(j)}catch(j){console.error("âŒ Failed to fetch activities:",j),d([])}finally{S(!1)}})()},[t==null?void 0:t.uid,u.pathname]);const i=p=>{const j=At(p.type);c(j)};return e.jsxs("div",{className:"bg-card border border-border rounded-xl p-6 h-full flex flex-col shadow-sm transform transition-all hover:scale-[1.02]",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(me,{size:18,className:"text-blue-600"}),e.jsx("h3",{className:"text-foreground",children:"Recent Activity"})]}),e.jsx("div",{className:"space-y-5 flex-1",children:b?e.jsx("div",{className:"text-sm text-muted-foreground",children:"Loading activities..."}):n.length===0?e.jsx("div",{className:"text-sm text-muted-foreground",children:"No recent activity"}):n.map(p=>e.jsxs("div",{className:"flex gap-3 cursor-pointer hover:opacity-80 transition-opacity",onClick:()=>i(p),children:[e.jsx("div",{className:"w-8 h-8 rounded-lg bg-purple-soft flex items-center justify-center text-purple flex-shrink-0",children:Rt(p.type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm text-foreground leading-relaxed break-words line-clamp-2",children:p.summary}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:zt(p.timestamp)})]})]},p.id))}),e.jsx("button",{className:"w-full mt-6 text-sm text-blue-600 hover:text-purple-700 transition-colors pt-4 border-t border-border",children:"View all activity"})]})}function Ot(){var _;const{user:t}=oe(),c=je(),u=((_=t==null?void 0:t.name)==null?void 0:_.split(" ")[0])||"Your",[n,d]=r.useState(0),[b,S]=r.useState(0),[i,p]=r.useState(0),[j,v]=r.useState(null),[E,R]=r.useState(null),[I,U]=r.useState([]),[P,A]=r.useState([]),[L,k]=r.useState([]),[F,D]=r.useState([]),[$,O]=r.useState(null),[T,a]=r.useState(null),[o,f]=r.useState([]),w=(()=>{const N=n*20,h=b*2,g=i*30,B=(N+h+g)/60;return Math.round(B*10)/10})();return r.useEffect(()=>{(async()=>{if(t!=null&&t.uid)try{const h=await W.getContacts(t.uid);d(h.length)}catch(h){console.error("Failed to fetch contacts:",h),d(0)}})()},[t==null?void 0:t.uid]),r.useEffect(()=>{(async()=>{if(!t){S(0);return}try{const h=await K.getFirmSearchHistory(50),g=[],C=new Set;for(const B of h)try{const V=await K.getFirmSearchById(B.id);V&&V.firms&&V.firms.forEach(l=>{var m;const s=l.id||`${l.name}-${(m=l.location)==null?void 0:m.display}`;C.has(s)||(C.add(s),g.push(l))})}catch(V){console.error(`Failed to load search ${B.id}:`,V)}S(g.length)}catch(h){console.error("Failed to fetch firms:",h),S(0)}})()},[t]),r.useEffect(()=>{(async()=>{var h;if(!t){p(0);return}try{const g=await K.getAllCoffeeChatPreps();"error"in g?(console.error("Failed to fetch coffee chat preps:",g.error),p(0)):p(((h=g.preps)==null?void 0:h.length)||0)}catch(g){console.error("Failed to fetch coffee chat preps:",g),p(0)}})()},[t]),r.useEffect(()=>{(async()=>{if(t!=null&&t.uid)try{const h=await ht(t.uid);v(h)}catch(h){console.error("Failed to fetch weekly summary:",h)}})()},[t==null?void 0:t.uid]),r.useEffect(()=>{const N=async()=>{if(t!=null&&t.uid)try{const g=new Date().toISOString().split("T")[0],C=await W.getUserStreak(t.uid);(!(C!=null&&C.lastActivityDate)||C.lastActivityDate!==g)&&await xt(t.uid,"contactSearch","Logged in",{type:"dashboard_visit",date:g})}catch(g){console.error("Failed to log dashboard visit:",g)}},h=async()=>{if(t!=null&&t.uid)try{const g=await W.getUserStreak(t.uid);g&&R(g);const C=await ft(t.uid);R(C)}catch(g){console.error("Failed to fetch streak:",g)}};N(),h()},[t==null?void 0:t.uid]),r.useEffect(()=>{(async()=>{if(t!=null&&t.uid)try{let h=await W.getGoals(t.uid);if(h.length===0){const s=new Date,m=new Date(s.getFullYear(),s.getMonth(),1),y=new Date(s.getFullYear(),s.getMonth()+1,0,23,59,59),G=gt();for(const Y of G){const z=await W.createGoal(t.uid,{...Y,startDate:le.fromDate(m),endDate:le.fromDate(y)});h.push({id:z,type:Y.type,target:Y.target,period:Y.period,startDate:le.fromDate(m),endDate:le.fromDate(y)})}}const g=["contacts","firms","coffeeChats"],V=h.filter(s=>g.includes(s.type)).reduce((s,m)=>{var G,Y,z,M;const y=s.find(H=>H.type===m.type);if(!y)s.push(m);else{const H=((Y=(G=y.startDate)==null?void 0:G.toMillis)==null?void 0:Y.call(G))||0;if((((M=(z=m.startDate)==null?void 0:z.toMillis)==null?void 0:M.call(z))||0)>H){const Q=s.indexOf(y);s[Q]=m}}return s},[]).map(async s=>{const m={id:s.id,type:s.type,target:s.target,period:s.period,startDate:s.startDate,endDate:s.endDate};return await pt(t.uid,m)}),l=await Promise.all(V);U(l)}catch(h){console.error("Failed to initialize goals:",h)}})()},[t==null?void 0:t.uid]),r.useEffect(()=>{(async()=>{if(t!=null&&t.uid)try{const h=await K.getDashboardStats();if("error"in h){console.error("Failed to fetch dashboard stats:",h.error);return}A(h.outreachByMonth),k(h.topFirms.map(g=>({name:g.name,contacts:g.contacts,replyRate:g.replyRate}))),O(h.replyStats)}catch(h){console.error("Failed to fetch dashboard stats:",h)}})()},[t==null?void 0:t.uid]),r.useEffect(()=>{(async()=>{if(t!=null&&t.uid)try{const h=await K.getRecommendations();if("error"in h){console.error("Failed to fetch recommendations:",h.error);return}const g=h.recommendations.map(C=>{let B=e.jsx(ue,{size:16});return C.type==="follow_up"?B=e.jsx(ne,{size:16}):C.type==="unread_replies"?B=e.jsx(be,{size:16}):C.type==="explore_firms"&&(B=e.jsx(ue,{size:16})),{icon:B,title:C.title,description:C.description,action:C.action,contactId:C.contactId,contactIds:C.contactIds}});D(g)}catch(h){console.error("Failed to fetch recommendations:",h)}})()},[t==null?void 0:t.uid]),r.useEffect(()=>{(async()=>{if(t!=null&&t.uid)try{const h=await K.getFirmLocations();if("error"in h){console.error("Failed to fetch firm locations:",h.error);return}const g=h.locations.map((C,B)=>({id:B+1,name:C.name,city:C.city,state:C.state,contacts:C.contacts,x:C.coordinates.x,y:C.coordinates.y}));f(g)}catch(h){console.error("Failed to fetch firm locations:",h)}})()},[t==null?void 0:t.uid]),r.useEffect(()=>{(async()=>{if(t!=null&&t.uid)try{const h=await K.getInterviewPrepStats();if("error"in h){console.error("Failed to fetch interview prep stats:",h.error);return}a(h)}catch(h){console.error("Failed to fetch interview prep stats:",h)}})()},[t==null?void 0:t.uid]),e.jsxs("div",{className:"space-y-16",children:[e.jsx("svg",{className:"absolute w-0 h-0",children:e.jsx("defs",{children:e.jsxs("linearGradient",{id:"kpi-icon-gradient",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:"#06B6D4"}),e.jsx("stop",{offset:"100%",stopColor:"#a855f7"})]})})}),e.jsxs("div",{className:"pt-6 text-center",children:[e.jsxs("h2",{className:"text-foreground text-4xl md:text-5xl lg:text-6xl font-bold",children:[u,"'s Recruiting Snapshot"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Track your progress and stay on top of your recruiting pipeline"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 bg-card border border-border rounded-xl p-6 shadow-sm transform transition-all hover:scale-[1.02]",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Se,{size:18,className:"text-blue-600"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"This Week"})]}),j?e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-foreground",children:j.contactsGenerated}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Contacts"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-foreground",children:j.firmsSearched}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Firms"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-foreground",children:j.coffeeChatsCreated}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Coffee Chats"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-foreground",children:j.totalActivities}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Activities"})]})]}):e.jsx("div",{className:"text-sm text-muted-foreground",children:"Loading weekly summary..."})]}),e.jsxs("div",{className:"bg-card border border-border rounded-xl p-6 shadow-sm transform transition-all hover:scale-[1.02]",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Ue,{size:18,className:"text-orange-500"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Streak"})]}),E?e.jsxs("div",{children:[e.jsx("div",{className:"text-3xl font-bold mb-1 text-foreground",children:E.currentStreak}),e.jsx("div",{className:"text-sm text-muted-foreground mb-4",children:"days in a row!"}),E.longestStreak>E.currentStreak&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Best: ",E.longestStreak," days"]})]}):e.jsx("div",{className:"text-sm text-muted-foreground",children:"Loading streak..."})]})]}),I.length>0&&e.jsxs("div",{className:"pt-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg text-foreground",children:"Monthly Goals"}),e.jsx("p",{className:"text-muted-foreground text-sm mt-1",children:"Track your progress toward this month's targets"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:I.map(N=>{const h={contacts:"Contacts",firms:"Firms Searched",coffeeChats:"Coffee Chats",outreach:"Outreach"}[N.goal.type];return e.jsxs("div",{className:"bg-card border border-border rounded-xl p-6 shadow-sm transform transition-all hover:scale-[1.02]",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(ue,{size:16,className:"text-blue-600"}),e.jsx("h4",{className:"font-medium text-foreground",children:h})]}),e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex items-baseline gap-2 mb-1",children:[e.jsx("span",{className:"text-2xl font-bold text-foreground",children:N.current}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["/ ",N.target]})]}),e.jsx("div",{className:"w-full bg-muted rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:"h-full transition-all duration-500",style:{background:"linear-gradient(135deg, #3B82F6, #60A5FA)",width:`${N.percentage}%`}})})]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[Math.round(N.percentage),"% complete"]})]},N.goal.id)})})]}),e.jsxs("div",{className:"pt-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg text-foreground",children:"Statistics"}),e.jsx("p",{className:"text-muted-foreground text-sm mt-1",children:"Total activity on site"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:[e.jsx(ae,{icon:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(be,{size:20}),e.jsx(Be,{size:20}),e.jsx(ne,{size:20})]}),label:"Contacts Found + Emails",value:n}),e.jsx(ae,{icon:e.jsx(Pe,{size:20}),label:"Firms Searched",value:b}),e.jsx(ae,{icon:e.jsx(ve,{size:20}),label:"Coffee Chats",value:i}),e.jsx(ae,{icon:e.jsx(ne,{size:20}),label:"Replies Received",value:($==null?void 0:$.totalReplies)??0,subtitle:$?`${Math.round($.responseRate)}% response rate`:void 0}),e.jsx(ae,{icon:e.jsx(me,{size:20}),label:"Total Time Saved",value:`${w}h`,subtitle:"vs manual research"}),e.jsx(ae,{icon:e.jsx(ze,{size:20}),label:"Interview Preps",value:(T==null?void 0:T.total)??0,subtitle:T?`${T.completedThisMonth} completed this month`:void 0})]})]}),e.jsxs("div",{className:"pt-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg text-foreground",children:"Activity & Analytics"}),e.jsx("p",{className:"text-muted-foreground text-sm mt-1",children:"Your recent activity and performance trends"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-8",children:[e.jsx("div",{className:"lg:col-span-4",children:e.jsx(Lt,{})}),e.jsxs("div",{className:"lg:col-span-8 space-y-8",children:[e.jsxs("div",{className:"bg-card border border-border rounded-xl p-8 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[e.jsx(Se,{size:18,className:"text-blue-600"}),e.jsx("h3",{className:"text-foreground",children:"Outreach vs Replies"})]}),P.length>0?e.jsx("div",{className:"w-full overflow-x-auto overflow-y-visible -mx-2 px-2",style:{paddingBottom:"20px"},children:e.jsx("div",{style:{minWidth:`${Math.max(100,P.length*80)}px`,height:"280px"},children:e.jsx(Ve,{width:"100%",height:"100%",children:e.jsxs(He,{data:P,margin:{top:5,right:10,left:0,bottom:20},children:[e.jsx(qe,{strokeDasharray:"3 3",stroke:"hsl(214.3, 31.8%, 91.4%)"}),e.jsx(Je,{dataKey:"month",stroke:"hsl(215.4, 16.3%, 46.9%)",style:{fontSize:"12px"},tick:{fill:"hsl(215.4, 16.3%, 46.9%)"}}),e.jsx(Ke,{stroke:"hsl(215.4, 16.3%, 46.9%)",style:{fontSize:"12px"},tick:{fill:"hsl(215.4, 16.3%, 46.9%)"}}),e.jsx(Xe,{contentStyle:{backgroundColor:"hsl(var(--card))",border:"1px solid hsl(var(--border))",borderRadius:"8px",fontSize:"12px",color:"hsl(var(--card-foreground))"}}),e.jsx(De,{type:"monotone",dataKey:"outreach",stroke:"#8B5CF6",strokeWidth:2,dot:{fill:"#8B5CF6"}}),e.jsx(De,{type:"monotone",dataKey:"replies",stroke:"#D946EF",strokeWidth:2,dot:{fill:"#D946EF"}})]})})})}):e.jsx("div",{className:"h-[280px] flex items-center justify-center text-sm text-muted-foreground",children:"Loading chart data..."})]}),e.jsxs("div",{className:"bg-card border border-border rounded-xl p-8 shadow-sm",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg mb-1 text-foreground",children:"AI Recommendations"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Personalized insights to accelerate your search"})]}),e.jsx("div",{className:"space-y-4",children:F.length===0?e.jsx("div",{className:"text-sm text-muted-foreground text-center py-4",children:"No recommendations at this time"}):F.map((N,h)=>e.jsx("div",{className:"p-4 rounded-xl bg-card border border-border transition-all cursor-pointer group shadow-sm transform hover:scale-[1.02]",onClick:()=>{N.contactId||N.contactIds?c("/outbox"):N.action.includes("firms")&&c("/firm-search")},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-purple-soft flex items-center justify-center text-purple flex-shrink-0",children:N.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-sm mb-1 leading-snug text-foreground",children:N.title}),e.jsx("div",{className:"text-xs text-muted-foreground mb-3 leading-relaxed",children:N.description}),e.jsxs("button",{className:"text-xs text-blue-600 hover:text-purple-700 transition-colors flex items-center gap-1 group-hover:gap-2",children:[N.action,e.jsx(Ze,{size:12,className:"transition-all"})]})]})]})},h))})]})]})]})]}),e.jsxs("div",{className:"py-16",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg text-foreground",children:"Recruiting Timeline"}),e.jsx("p",{className:"text-muted-foreground text-sm mt-1",children:"Track your progress through recruiting season"})]}),e.jsx(Pt,{})]})]})}const Gt={no_reply_yet:"Draft (not sent)",new_reply:"New reply",waiting_on_them:"Sent - waiting for reply",waiting_on_you:"Waiting on you",closed:"Closed"},_t={no_reply_yet:"bg-muted text-foreground border-border",new_reply:"bg-blue-500/10 text-blue-700 border-blue-500/40",waiting_on_them:"bg-emerald-500/10 text-emerald-700 border-emerald-500/40",waiting_on_you:"bg-amber-500/10 text-amber-700 border-amber-500/40",closed:"bg-muted text-muted-foreground border-border"},Ee=({icon:t,label:c,value:u})=>e.jsxs("div",{className:"flex items-center gap-3 px-4 py-3 bg-white rounded-lg shadow-sm border border-border transform transition-all hover:scale-[1.02]",children:[e.jsx(t,{className:"w-5 h-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xl font-semibold text-foreground",children:u}),e.jsx("p",{className:"text-sm text-muted-foreground",children:c})]})]}),Yt=()=>{const t=new Date().getHours();return t<12?"Good morning":t<18?"Good afternoon":"Good evening"},Wt=t=>!t||typeof t!="string"?"":t.trim().split(" ")[0]||"",pe=t=>t?t.status==="new_reply"||t.status==="waiting_on_you":!1;function Ut(){const{user:t}=oe(),c=je(),{toast:u}=we(),[n,d]=r.useState([]),[b,S]=r.useState(!0),[i,p]=r.useState(null),[j,v]=r.useState(""),[E,R]=r.useState(!1),I=async()=>{try{S(!0);const a=await K.getOutboxThreads();if("error"in a)throw new Error(a.error);d(a.threads||[])}catch(a){u({title:"Failed to load Outbox",description:a.message||"Try again in a moment.",variant:"destructive"})}finally{S(!1)}};r.useEffect(()=>{I()},[]);const U=r.useMemo(()=>{const a=j.toLowerCase();return n.filter(o=>[o.contactName,o.company,o.jobTitle,o.email,o.lastMessageSnippet].join(" ").toLowerCase().includes(a))},[n,j]),P=r.useMemo(()=>n.filter(a=>a.hasDraft).length,[n]),A=r.useMemo(()=>n.filter(a=>a.status!=="no_reply_yet").length,[n]),L=Wt(t==null?void 0:t.name),k=Yt(),F=r.useMemo(()=>P>0?`You have ${P} ${P===1?"draft":"drafts"} ready to send`:n.length===0?"Ready to grow your network?":"Let's keep the conversation going",[P,n.length]),D=a=>{const o=new Date(a),x=(new Date().getTime()-o.getTime())/1e3;return x<60?"Just now":x<3600?`${Math.round(x/60)}m ago`:x<86400?`${Math.round(x/3600)}h ago`:o.toLocaleDateString()},$=()=>{if(!i)return;const a=i.gmailDraftId;let o=i.gmailDraftUrl;if(!a&&!o){u({title:"No Gmail draft found",description:"Generate or regenerate a reply draft first.",variant:"destructive"});return}if(o&&o.includes("#drafts/")&&(o=o.replace("#drafts/","#draft/")),!o||!o.includes("#draft/"))if(a)o=`https://mail.google.com/mail/u/0/#draft/${a}`;else{u({title:"No Gmail draft found",description:"Generate or regenerate a reply draft first.",variant:"destructive"});return}console.log("Opening draft URL:",o),window.open(o,"_blank")},O=async()=>{if(i){if(!pe(i)){u({title:"No reply from contact",description:"You can only generate a reply after the contact responds.",variant:"destructive"});return}try{R(!0);const a=await K.regenerateOutboxReply(i.id);if("error"in a)throw new Error(a.error);const o=a.thread;d(f=>f.map(x=>x.id===o.id?o:x)),p(o),u({title:"Reply generated",description:o.hasDraft?"Your AI-generated reply has been saved as a Gmail draft.":"Reply generated successfully."})}catch(a){u({title:"Failed to regenerate",description:a.message,variant:"destructive"})}finally{R(!1)}}},T=async()=>{i!=null&&i.suggestedReply&&(await navigator.clipboard.writeText(i.suggestedReply),u({title:"Copied",description:"Reply text copied to clipboard."}))};return e.jsxs("div",{className:"w-full space-y-8",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("h1",{className:"text-2xl font-semibold text-foreground",children:[k,L?`, ${L}`:"","!"]}),e.jsx("p",{className:"text-muted-foreground",children:F})]}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsx(Ee,{icon:et,label:"Drafts",value:P}),e.jsx(Ee,{icon:tt,label:"Sent",value:A})]}),e.jsx("div",{className:"border-t border-gray-100/30 pt-6",children:e.jsxs("div",{className:"flex gap-6",children:[e.jsxs("div",{className:"w-1/2 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-lg font-medium text-foreground",children:"Your Drafts"}),e.jsx(q,{size:"icon",variant:"outline",onClick:I,className:"border-0 shadow-sm hover:shadow-md bg-white",children:b?e.jsx(se,{className:"h-4 w-4 animate-spin"}):e.jsx(Ce,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ye,{className:"h-4 w-4 absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground z-10"}),e.jsx(re,{className:"pl-9 bg-white shadow-sm hover:shadow-md transition-shadow border-0 focus:ring-2 focus:ring-purple-500/20",placeholder:"Search by name, firm, subjectâ€¦",value:j,onChange:a=>v(a.target.value)})]}),e.jsxs("div",{className:"space-y-2 max-h-[520px] overflow-y-auto pr-1",children:[b&&e.jsxs("div",{className:"py-10 text-center text-muted-foreground text-sm",children:[e.jsx(se,{className:"h-4 w-4 animate-spin mb-2"}),"Loading conversationsâ€¦"]}),!b&&U.length===0&&n.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Me,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-foreground mb-2",children:"No drafts yet"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Find contacts and start building your network"}),e.jsx(q,{onClick:()=>c("/contact-search"),children:"Find Contacts"})]}),!b&&U.length===0&&n.length>0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ye,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-foreground mb-2",children:"No results found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Try adjusting your search query"})]}),!b&&U.length>0&&U.map(a=>e.jsx("button",{onClick:()=>p(a),className:`w-full text-left p-4 rounded-xl transition-all duration-200 ${(i==null?void 0:i.id)===a.id?"bg-gradient-to-r from-blue-50 to-indigo-50 shadow-md ring-2 ring-blue-500/30":"bg-white shadow-sm hover:shadow-md hover:bg-gray-50/50"}`,children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-sm",children:a.contactName}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[a.jobTitle," Â· ",a.company]}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground line-clamp-2",children:a.lastMessageSnippet})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[e.jsx("span",{className:"text-[11px] text-muted-foreground",children:D(a.lastActivityAt)}),e.jsx(Te,{className:`border ${_t[a.status]} text-[10px]`,children:Gt[a.status]}),a.hasDraft&&e.jsxs("span",{className:"text-[10px] text-blue-700 flex items-center gap-1",children:[e.jsx(ie,{className:"h-3 w-3"})," Draft ready"]})]})]})},a.id))]})]}),e.jsx("div",{className:"w-1/2",children:i?e.jsxs("div",{className:"h-full rounded-2xl p-6 bg-white shadow-lg flex flex-col",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("p",{className:"font-semibold text-sm text-foreground",children:i.contactName}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[i.jobTitle," Â· ",i.company]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:i.email})]}),e.jsxs("div",{className:"rounded-xl border border-gray-100 bg-white p-3 mb-4",children:[e.jsx("p",{className:"text-[11px] font-medium text-foreground mb-2",children:i.status==="no_reply_yet"?"Draft content":"Latest message"}),e.jsx("p",{className:"text-xs text-muted-foreground whitespace-pre-wrap line-clamp-4",children:i.lastMessageSnippet||(i.status==="no_reply_yet"?"Draft is ready to send in Gmail":"No message content available.")})]}),pe(i)?e.jsxs("div",{className:"border border-gray-100 rounded-xl p-4 bg-white flex flex-col flex-1",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-4 w-4 text-primary"}),e.jsx("h3",{className:"text-sm font-semibold text-foreground",children:"Suggested reply"})]}),i.hasDraft&&i.suggestedReply&&e.jsx(Te,{variant:"outline",className:"border-blue-500/60 bg-blue-500/10 text-[10px] text-blue-700",children:"Draft saved in Gmail"})]}),i.suggestedReply?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-[11px] text-muted-foreground mb-3",children:"We drafted this response based on their message. Review and edit before sending â€” you're always in control."}),e.jsx("textarea",{readOnly:!0,value:i.suggestedReply,className:"flex-1 w-full text-xs bg-white rounded-xl p-3 resize-none text-foreground whitespace-pre-wrap shadow-inner focus:ring-2 focus:ring-purple-500/20"})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-[11px] text-muted-foreground mb-3",children:"Generate an AI-powered reply based on their message. We'll analyze their tone and content to craft an appropriate response."}),e.jsx("div",{className:"flex-1 flex items-center justify-center border border-dashed border-gray-100 rounded-xl p-6 bg-white",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ie,{className:"h-8 w-8 text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"No suggested reply yet"}),e.jsx("p",{className:"text-[10px] text-muted-foreground mt-1",children:'Click "Regenerate" to create one'})]})})]})]}):e.jsxs("div",{className:"border border-gray-100 rounded-xl p-4 bg-white flex flex-col flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ie,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("h3",{className:"text-sm font-semibold text-foreground",children:"Suggested reply"})]}),e.jsx("div",{className:"flex-1 flex items-center justify-center border border-dashed border-gray-100 rounded-xl p-6 bg-white",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ne,{className:"h-8 w-8 text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Waiting for reply from contact"}),e.jsx("p",{className:"text-[10px] text-muted-foreground mt-1",children:"We'll generate a suggested reply once they respond"})]})})]}),e.jsxs("div",{className:"mt-3 flex gap-2 flex-wrap",children:[e.jsxs(q,{size:"sm",onClick:$,disabled:!i.gmailDraftId&&!i.gmailDraftUrl,className:"flex items-center gap-1",children:[e.jsx(Ae,{className:"h-4 w-4"})," Open Gmail draft"]}),e.jsxs(q,{size:"sm",variant:"outline",onClick:T,disabled:!i.suggestedReply,className:"flex items-center gap-1 border-input",children:[e.jsx(ne,{className:"h-4 w-4"})," Copy reply text"]}),e.jsxs(q,{size:"sm",variant:"ghost",onClick:O,disabled:E||!i||!pe(i),className:"flex items-center gap-1 text-foreground",children:[E?e.jsx(se,{className:"h-4 w-4 animate-spin"}):e.jsx(Ce,{className:"h-4 w-4"}),"Regenerate"]})]}),e.jsx("p",{className:"text-[10px] text-muted-foreground mt-3",children:"Tip: personalize your first line â€” it's the one they read carefully."})]}):e.jsx("div",{className:"h-full rounded-2xl p-6 text-center text-muted-foreground text-sm bg-gradient-to-br from-gray-50/50 to-white shadow-inner",children:e.jsxs("div",{className:"flex flex-col items-center justify-center h-full",children:[e.jsx(Me,{className:"w-16 h-16 text-muted-foreground/30 mb-4"}),e.jsx("p",{children:"Select a conversation to view the reply and your AI-generated response draft."})]})})})]})})]})}function Ge({className:t,classNames:c,showOutsideDays:u=!0,...n}){return e.jsx(st,{showOutsideDays:u,className:ce("p-3",t),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:ce(ke({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100 hover:bg-blue-50/50"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-blue-50/30 [&:has([aria-selected])]:bg-blue-50/30 first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:ce(ke({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100 hover:bg-blue-50/50 hover:text-foreground"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary/90 hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-blue-50 text-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-blue-50/30 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-blue-50/30 aria-selected:text-foreground",day_hidden:"invisible",...c},components:{Chevron:({orientation:d})=>{const b=d==="left"?Le:Oe;return e.jsx(b,{className:"h-4 w-4"})}},...n})}Ge.displayName="Calendar";function Bt({isOpen:t,onClose:c,onEventCreated:u,prefillContact:n}){const{user:d}=oe(),{toast:b}=we(),[S,i]=r.useState(!1),[p,j]=r.useState(""),[v,E]=r.useState(null),[R,I]=r.useState([]),[U,P]=r.useState(!1),[A,L]=r.useState(""),[k,F]=r.useState(""),[D,$]=r.useState(void 0),[O,T]=r.useState(""),[a,o]=r.useState("30"),[f,x]=r.useState("video"),[w,_]=r.useState(""),[N,h]=r.useState(""),g=Re.useMemo(()=>{const l=[];for(let s=8;s<=20;s++)for(let m=0;m<60;m+=30){const y=`${s.toString().padStart(2,"0")}:${m.toString().padStart(2,"0")}`;l.push(y)}return l},[]);r.useEffect(()=>{n&&t&&(n.contactName&&(j(n.contactName),L(`Coffee Chat with ${n.contactName}`)),n.firm&&F(n.firm),n.contactId&&W.getContact((d==null?void 0:d.uid)||"",n.contactId).then(l=>{l&&(E(l),F(l.company||n.firm||""))}))},[n,t,d==null?void 0:d.uid]),r.useEffect(()=>{if(p.length>1&&!v){const l=setTimeout(()=>{d!=null&&d.uid&&W.searchContacts(d.uid,p,5).then(s=>{I(s),P(!0)})},300);return()=>clearTimeout(l)}else I([]),P(!1)},[p,v,d==null?void 0:d.uid]),r.useEffect(()=>{t||(j(""),E(null),L(""),F(""),$(void 0),T(""),o("30"),x("video"),_(""),h(""),I([]),P(!1))},[t]);const C=l=>{E(l),j(`${l.firstName} ${l.lastName}`.trim()||l.email),F(l.company||""),L(`Coffee Chat with ${l.firstName} ${l.lastName}`.trim()||l.email),P(!1)},B=()=>{E(null),j("")},V=async l=>{if(l.preventDefault(),!(d!=null&&d.uid)){b({title:"Error",description:"You must be logged in to schedule an event",variant:"destructive"});return}if(!A.trim()){b({title:"Validation Error",description:"Please enter an event title",variant:"destructive"});return}if(!k.trim()){b({title:"Validation Error",description:"Please enter a firm name",variant:"destructive"});return}if(!D){b({title:"Validation Error",description:"Please select a date",variant:"destructive"});return}if(!O){b({title:"Validation Error",description:"Please select a time",variant:"destructive"});return}i(!0);try{const s=Fe(D),m=te(s,"yyyy-MM-dd"),y=s.getFullYear(),G=s.getMonth()+1,Y=s.getDate();console.log("ðŸ“… Creating event with date:",{inputDate:D,inputDateISO:D.toISOString(),inputDateLocal:D.toLocaleDateString(),normalizedDate:s.toISOString(),normalizedLocal:s.toLocaleDateString(),year:y,month:G,day:Y,formattedDate:m,formattedViaDateFns:te(s,"yyyy-MM-dd"),timezone:Intl.DateTimeFormat().resolvedOptions().timeZone});const z={title:A.trim(),contactId:v==null?void 0:v.id,contactName:v?`${v.firstName} ${v.lastName}`.trim()||v.email:p.trim()||"Unknown",firm:k.trim(),date:m,time:O,duration:parseInt(a,10),type:f,status:"pending",...w.trim()&&{meetingLink:w.trim()},...N.trim()&&{notes:N.trim()}};await W.createCalendarEvent(d.uid,z),b({title:"Event Scheduled",description:"Your calendar event has been created successfully"}),u(),c()}catch(s){console.error("Error creating calendar event:",s),b({title:"Error",description:"Failed to create calendar event. Please try again.",variant:"destructive"})}finally{i(!1)}};return e.jsx(bt,{open:t,onOpenChange:c,children:e.jsxs(yt,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[e.jsx(jt,{children:e.jsx(vt,{children:"Schedule New Event"})}),e.jsxs("form",{onSubmit:V,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{htmlFor:"contact",children:"Contact (Optional)"}),e.jsx("div",{className:"relative",children:v?e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded-lg border border-border bg-background",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium",children:`${v.firstName} ${v.lastName}`.trim()||v.email}),e.jsx("div",{className:"text-xs text-text-muted",children:v.company})]}),e.jsx(q,{type:"button",variant:"ghost",size:"sm",onClick:B,className:"h-6 w-6 p-0",children:e.jsx(Ie,{className:"h-4 w-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative",children:[e.jsx(ye,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted"}),e.jsx(re,{id:"contact",className:"pl-9",placeholder:"Search contacts...",value:p,onChange:l=>j(l.target.value),onFocus:()=>{R.length>0&&P(!0)}})]}),U&&R.length>0&&e.jsx("div",{className:"absolute z-50 w-full mt-1 bg-card border border-border rounded-lg shadow-lg max-h-60 overflow-y-auto",children:R.map(l=>e.jsxs("button",{type:"button",className:"w-full text-left px-4 py-2 hover:bg-background transition-colors",onClick:()=>C(l),children:[e.jsx("div",{className:"text-sm font-medium",children:`${l.firstName} ${l.lastName}`.trim()||l.email}),e.jsx("div",{className:"text-xs text-text-muted",children:l.company})]},l.id))})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{htmlFor:"title",children:"Event Title *"}),e.jsx(re,{id:"title",value:A,onChange:l=>L(l.target.value),placeholder:"Coffee Chat with...",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{htmlFor:"firm",children:"Firm *"}),e.jsx(re,{id:"firm",value:k,onChange:l=>F(l.target.value),placeholder:"Company name",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{children:"Date *"}),e.jsxs(Nt,{children:[e.jsx(wt,{asChild:!0,children:e.jsxs(q,{variant:"outline",className:ce("w-full justify-start text-left font-normal",!D&&"text-muted-foreground"),children:[e.jsx(Ne,{className:"mr-2 h-4 w-4"}),D?te(D,"PPP"):"Pick a date"]})}),e.jsx(St,{className:"w-auto p-0",align:"start",children:e.jsx(Ge,{mode:"single",selected:D,onSelect:l=>{if(l){const s=Fe(l);console.log("ðŸ“… Date selected from calendar:",{original:l,originalISO:l.toISOString(),originalLocal:l.toLocaleDateString(),originalUTC:{year:l.getUTCFullYear(),month:l.getUTCMonth()+1,day:l.getUTCDate()},originalLocalValues:{year:l.getFullYear(),month:l.getMonth()+1,day:l.getDate()},normalized:s,normalizedISO:s.toISOString(),normalizedLocal:s.toLocaleDateString(),normalizedValues:{year:s.getFullYear(),month:s.getMonth()+1,day:s.getDate()},formatted:te(s,"yyyy-MM-dd")}),$(s)}else $(void 0)},disabled:l=>{const s=new Date;return s.setHours(0,0,0,0),new Date(l.getFullYear(),l.getMonth(),l.getDate())<s},initialFocus:!0})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{htmlFor:"time",children:"Time *"}),e.jsxs(he,{value:O,onValueChange:T,required:!0,children:[e.jsx(xe,{id:"time",children:e.jsx(fe,{placeholder:"Select time"})}),e.jsx(ge,{children:g.map(l=>{const[s,m]=l.split(":"),y=parseInt(s,10),G=y>=12?"PM":"AM",z=`${y>12?y-12:y===0?12:y}:${m} ${G}`;return e.jsx(ee,{value:l,children:z},l)})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{htmlFor:"duration",children:"Duration (minutes) *"}),e.jsxs(he,{value:a,onValueChange:o,required:!0,children:[e.jsx(xe,{id:"duration",children:e.jsx(fe,{})}),e.jsxs(ge,{children:[e.jsx(ee,{value:"15",children:"15 minutes"}),e.jsx(ee,{value:"30",children:"30 minutes"}),e.jsx(ee,{value:"45",children:"45 minutes"}),e.jsx(ee,{value:"60",children:"60 minutes"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{htmlFor:"type",children:"Type *"}),e.jsxs(he,{value:f,onValueChange:l=>x(l),required:!0,children:[e.jsx(xe,{id:"type",children:e.jsx(fe,{})}),e.jsxs(ge,{children:[e.jsx(ee,{value:"video",children:"Video"}),e.jsx(ee,{value:"phone",children:"Phone"}),e.jsx(ee,{value:"in-person",children:"In-Person"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{htmlFor:"meetingLink",children:"Meeting Link (Optional)"}),e.jsx(re,{id:"meetingLink",type:"url",value:w,onChange:l=>_(l.target.value),placeholder:"https://meet.google.com/..."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(J,{htmlFor:"notes",children:"Notes (Optional)"}),e.jsx(de,{id:"notes",value:N,onChange:l=>h(l.target.value),placeholder:"Additional notes about this meeting...",rows:3})]}),e.jsxs(Dt,{children:[e.jsx(q,{type:"button",variant:"outline",onClick:c,disabled:S,children:"Cancel"}),e.jsx(q,{type:"submit",disabled:S,className:"gradient-bg",children:S?"Scheduling...":"Schedule Event"})]})]})]})})}function Vt(t){const[c,u,n]=t.date.split("-").map(Number),[d,b]=t.time.split(":").map(Number),S=new Date(c,u-1,n,d,b),i=new Date(S.getTime()+t.duration*60*1e3),p=I=>I.toISOString().replace(/[-:]/g,"").split(".")[0]+"Z",j=p(S),v=p(i),E=`Coffee chat with ${t.contactName} at ${t.firm}${t.notes?`

Notes: ${t.notes}`:""}`;return`https://calendar.google.com/calendar/render?${new URLSearchParams({action:"TEMPLATE",text:t.title,dates:`${j}/${v}`,details:E,location:t.meetingLink||(t.type==="in-person"?"TBD":"")}).toString()}`}function Ht(t){const[c,u,n]=t.date.split("-").map(Number),[d,b]=t.time.split(":").map(Number),S=new Date(c,u-1,n,d,b),i=new Date(S.getTime()+t.duration*60*1e3),p=L=>{const k=L.getUTCFullYear(),F=String(L.getUTCMonth()+1).padStart(2,"0"),D=String(L.getUTCDate()).padStart(2,"0"),$=String(L.getUTCHours()).padStart(2,"0"),O=String(L.getUTCMinutes()).padStart(2,"0"),T=String(L.getUTCSeconds()).padStart(2,"0");return`${k}${F}${D}T${$}${O}${T}Z`},j=p(S),v=p(i),E=p(new Date),R=`Coffee chat with ${t.contactName} at ${t.firm}${t.notes?`\\n\\nNotes: ${t.notes}`:""}`,I=["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//Offerloop//Calendar//EN","BEGIN:VEVENT",`UID:${t.id||Date.now()}@offerloop.ai`,`DTSTAMP:${E}`,`DTSTART:${j}`,`DTEND:${v}`,`SUMMARY:${t.title}`,`DESCRIPTION:${R.replace(/\n/g,"\\n")}`,`LOCATION:${t.meetingLink||(t.type==="in-person"?"TBD":"")}`,`STATUS:${t.status.toUpperCase()}`,"END:VEVENT","END:VCALENDAR"].join(`\r
`),U=new Blob([I],{type:"text/calendar;charset=utf-8"}),P=window.URL.createObjectURL(U),A=document.createElement("a");A.href=P,A.download=`${t.title.replace(/[^a-z0-9]/gi,"_")}.ics`,document.body.appendChild(A),A.click(),document.body.removeChild(A),window.URL.revokeObjectURL(P)}const qt=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];function Jt(){const{user:t}=oe(),[c,u]=r.useState(new Date),[n,d]=r.useState([]),[b,S]=r.useState([]),[i,p]=r.useState(!0),[j,v]=r.useState(null),[E,R]=r.useState(!1);r.useEffect(()=>{(async()=>{if(!(t!=null&&t.uid)){p(!1);return}try{p(!0);const o=c.getMonth(),f=c.getFullYear();console.log(`ðŸ“… Fetching calendar events for month ${o+1}/${f}`);const[x,w]=await Promise.all([W.getCalendarEvents(t.uid,o,f),W.getFollowUpReminders(t.uid)]);console.log(`âœ… Fetched ${x.length} events:`,x),d(x),S(w)}catch(o){console.error("Error fetching calendar data:",o)}finally{p(!1)}})()},[t==null?void 0:t.uid,c]),r.useEffect(()=>{(async()=>{if(!(t!=null&&t.uid)||n.length===0)return;const o=new Date,f=[];n.forEach(x=>{const[w,_,N]=x.date.split("-").map(Number),[h,g]=x.time.split(":").map(Number);new Date(w,_-1,N,h,g)<o&&x.status!=="completed"&&x.status!=="cancelled"&&f.push({id:x.id,updates:{status:"completed"}})}),f.length>0&&Promise.all(f.map(({id:x,updates:w})=>W.updateCalendarEvent(t.uid,x,w))).then(()=>{const x=c.getMonth(),w=c.getFullYear();W.getCalendarEvents(t.uid,x,w).then(d)})})()},[n,t==null?void 0:t.uid,c]);const I=r.useMemo(()=>{const a=Ct(c),o=Mt(c),f=kt(a),x=c.getFullYear(),w=c.getMonth()+1,_=o.getDate(),N=[];for(let g=0;g<f;g++)N.push({date:0,hasEvent:!1,isCurrentMonth:!1,isToday:!1});console.log(`ðŸ“… Generating calendar days for ${te(c,"MMMM yyyy")} with ${n.length} events`),console.log("ðŸ“… Events:",n.map(g=>({title:g.title,date:g.date})));for(let g=1;g<=_;g++){const C=`${x}-${String(w).padStart(2,"0")}-${String(g).padStart(2,"0")}`,B=n.some(s=>{if(!s.date)return!1;const m=s.date===C;return m&&console.log(`âœ… Event found on day ${g} (${C}):`,s.title,`event.date=${s.date}`),m}),V=new Date,l=V.getFullYear()===x&&V.getMonth()+1===w&&V.getDate()===g;N.push({date:g,hasEvent:B,isCurrentMonth:!0,isToday:l})}const h=N.filter(g=>g.hasEvent).length;return console.log(`ðŸ“… Calendar generated: ${h} days with events`),N},[c,n]),U=a=>{if(a===0)return[];const o=c.getFullYear(),f=c.getMonth()+1,x=`${o}-${String(f).padStart(2,"0")}-${String(a).padStart(2,"0")}`;return n.filter(w=>w.date?w.date===x:!1)},P=(a,o)=>{const[f,x,w]=a.split("-").map(Number),[_,N]=o.split(":").map(Number);return new Date(f,x-1,w,_,N)},A=n.filter(a=>P(a.date,a.time)>=new Date&&a.status!=="cancelled").sort((a,o)=>{const f=P(a.date,a.time),x=P(o.date,o.time);return f.getTime()-x.getTime()}).slice(0,10),L=a=>{const[o,f]=a.split(":").map(Number),x=o>12?o-12:o===0?12:o,w=o>=12?"PM":"AM";return`${x}:${f.toString().padStart(2,"0")} ${w}`},k=a=>{const[o,f,x]=a.split("-").map(Number),w=new Date(o,f-1,x);return te(w,"MMM d, yyyy")},F=()=>{u(Tt(c))},D=()=>{u(Ft(c,1))},$=a=>{a!==0&&v(j===a?null:a)},O=async()=>{if(!(t!=null&&t.uid))return;const a=c.getMonth(),o=c.getFullYear();console.log("ðŸ”„ Refreshing calendar after event creation...");const[f,x]=await Promise.all([W.getCalendarEvents(t.uid,a,o),W.getFollowUpReminders(t.uid)]);console.log(`âœ… Refreshed: ${f.length} events`),d(f),S(x)},T=async(a,o)=>{if(t!=null&&t.uid&&confirm(`Are you sure you want to delete "${o}"?`))try{await W.deleteCalendarEvent(t.uid,a);const f=c.getMonth(),x=c.getFullYear(),[w,_]=await Promise.all([W.getCalendarEvents(t.uid,f,x),W.getFollowUpReminders(t.uid)]);d(w),S(_),console.log(`âœ… Event deleted: ${o}`)}catch(f){console.error("Error deleting event:",f),alert("Failed to delete event. Please try again.")}};return e.jsxs("div",{className:"grid grid-cols-12 gap-6",children:[e.jsxs("div",{className:"col-span-8 bg-card border border-border rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-border flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:te(c,"MMMM yyyy")}),e.jsx("div",{className:"flex items-center gap-1 bg-background rounded-lg p-1",children:e.jsx("button",{onClick:()=>u(new Date),className:"px-3 py-1 text-sm rounded-md transition-all text-text-secondary hover:text-text-primary",children:"Today"})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:F,className:"w-8 h-8 rounded-lg hover:bg-background flex items-center justify-center text-text-secondary hover:text-text-primary transition-colors",children:e.jsx(Le,{size:18})}),e.jsx("button",{onClick:D,className:"w-8 h-8 rounded-lg hover:bg-background flex items-center justify-center text-text-secondary hover:text-text-primary transition-colors",children:e.jsx(Oe,{size:18})})]})]}),e.jsx("div",{className:"p-6",children:i?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(se,{className:"h-6 w-6 animate-spin text-blue-600"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-7 gap-2 mb-2",children:qt.map(a=>e.jsx("div",{className:"text-center text-xs text-text-muted font-medium py-2",children:a},a))}),e.jsx("div",{className:"grid grid-cols-7 gap-2",children:I.map((a,o)=>{if(a.date===0)return e.jsx("div",{className:"aspect-square"},o);const f=U(a.date),x=j===a.date;return e.jsxs("div",{onClick:()=>$(a.date),className:`aspect-square p-2 rounded-lg border transition-all cursor-pointer ${a.isToday||x?"border-purple bg-purple-soft":a.hasEvent?"border-border hover:border-purple bg-background":"border-border-subtle hover:border-border bg-card"}`,children:[e.jsx("div",{className:`text-sm ${a.isToday||x?"text-blue-600 font-medium":"text-text-primary"}`,children:a.date}),a.hasEvent&&e.jsx("div",{className:"mt-1.5 flex items-center justify-center",children:e.jsx(ve,{className:"w-5 h-5 text-red-500"})}),x&&f.length>0&&e.jsxs("div",{className:"mt-1 text-[10px] text-blue-600 font-medium",children:[f.length," event",f.length>1?"s":""]})]},o)})})]})})]}),e.jsxs("div",{className:"col-span-4 space-y-6",children:[e.jsxs("div",{className:"bg-card border border-border rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(Ne,{size:18,className:"text-blue-600"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Upcoming Events"})]}),i?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(se,{className:"h-5 w-5 animate-spin text-blue-600"})}):A.length===0?e.jsx("div",{className:"text-center py-8 text-text-muted text-sm",children:"No upcoming events. Schedule your first chat!"}):e.jsx("div",{className:"space-y-3",children:A.map(a=>e.jsxs("div",{className:"p-3 rounded-lg bg-background border border-border-subtle hover:border-purple transition-all",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("div",{className:"font-medium text-sm flex-1",children:a.title}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs ml-2 ${a.status==="confirmed"?"bg-blue-500/10 text-blue-500":a.status==="pending"?"bg-yellow-500/10 text-yellow-500":"bg-gray-500/10 text-gray-500"}`,children:a.status})]}),e.jsx("div",{className:"text-xs text-text-muted mb-2",children:a.firm}),e.jsxs("div",{className:"flex items-center gap-3 text-xs text-text-secondary mb-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(me,{size:12}),e.jsxs("span",{children:[k(a.date)," â€¢ ",L(a.time)]})]}),a.type==="video"&&e.jsx(at,{size:12,className:"text-blue-600"}),a.type==="phone"&&e.jsx(rt,{size:12,className:"text-blue-600"}),a.type==="in-person"&&e.jsx(nt,{size:12,className:"text-blue-600"})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsxs("button",{onClick:()=>window.open(Vt(a),"_blank"),className:"flex items-center gap-1 text-xs bg-white border border-gray-200 text-gray-700 hover:bg-gray-50 px-2 py-1 rounded transition-colors",children:[e.jsx(Ae,{size:12}),"Add to Google"]}),e.jsxs("button",{onClick:()=>Ht(a),className:"flex items-center gap-1 text-xs bg-white border border-gray-200 text-gray-700 hover:bg-gray-50 px-2 py-1 rounded transition-colors",children:[e.jsx(ot,{size:12}),"Download .ics"]}),e.jsxs("button",{onClick:()=>a.id&&T(a.id,a.title),className:"flex items-center gap-1 text-xs text-red-500 hover:text-red-600 transition-colors ml-auto",title:"Delete event",children:[e.jsx(it,{size:12}),"Delete"]})]})]},a.id))}),e.jsx("button",{onClick:()=>R(!0),className:"w-full mt-4 text-white px-4 py-2 rounded-lg font-medium text-sm shadow-sm transition-all hover:opacity-90",style:{background:"linear-gradient(135deg, #3B82F6, #60A5FA)"},children:"Schedule New Chat"})]}),e.jsxs("div",{className:"bg-card border border-border rounded-xl p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Follow-Up Reminders"}),i?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(se,{className:"h-5 w-5 animate-spin text-blue-600"})}):b.length===0?e.jsx("div",{className:"text-center py-8 text-text-muted text-sm",children:"No follow-ups needed. Great job staying on top of your network!"}):e.jsx("div",{className:"space-y-3",children:b.map(a=>e.jsx("div",{className:"p-3 rounded-lg bg-background",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-purple-500 mt-1.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm mb-1",children:["Follow up with ",a.contactName]}),e.jsxs("div",{className:"text-xs text-text-muted",children:[a.firm," â€¢ No response after ",a.daysSinceContact," day",a.daysSinceContact>1?"s":""]})]})]})},a.id))})]})]}),e.jsx(Bt,{isOpen:E,onClose:()=>R(!1),onEventCreated:O})]})}function ds(){console.log("ðŸ“Š [DASHBOARD PAGE] Component rendering");const[t]=lt(),c=t.get("tab"),[u,n]=r.useState(c&&["dashboard","outbox","calendar"].includes(c)?c:"dashboard");r.useEffect(()=>{c&&["dashboard","outbox","calendar"].includes(c)&&n(c)},[c]);const d=()=>{switch(u){case"dashboard":return"4px";case"outbox":return"calc(33.33% + 2px)";case"calendar":return"calc(66.66% + 1px)";default:return"4px"}};return e.jsx(dt,{children:e.jsxs("div",{className:"min-h-screen flex w-full bg-transparent",children:[e.jsx(mt,{}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsxs("header",{className:"h-16 flex items-center justify-between border-b border-gray-100/30 px-6 bg-transparent shadow-sm flex-shrink-0 relative z-20",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(ut,{className:"text-foreground hover:bg-secondary"}),e.jsx("h1",{className:"text-xl font-semibold",children:"Home"})]}),e.jsx($t,{})]}),e.jsx("main",{className:"flex-1 overflow-y-auto p-6 bg-transparent",children:e.jsx("div",{style:{width:"100%",minWidth:"fit-content"},children:e.jsxs("div",{style:{maxWidth:"1280px",margin:"0 auto",width:"100%"},children:[e.jsx("div",{className:"flex justify-center mb-8",children:e.jsxs("div",{className:"relative grid w-full grid-cols-3 max-w-lg border border-border p-1 rounded-xl h-14 overflow-hidden tabs-container-gradient bg-card",children:[e.jsx(Z.div,{className:"absolute rounded-lg h-12",style:{background:"linear-gradient(135deg, #3B82F6, #60A5FA)",top:"4px"},initial:!1,animate:{left:d(),width:"calc(33.33% - 4px)"},transition:{type:"spring",stiffness:400,damping:30}}),e.jsx("button",{onClick:()=>n("dashboard"),className:`relative z-10 gap-2 h-12 font-medium transition-all flex items-center justify-center ${u==="dashboard"?"text-white":"text-text-muted hover:text-text-primary"}`,children:e.jsxs(Z.div,{whileHover:{y:u==="dashboard"?0:-1},className:"flex items-center gap-2",children:[e.jsx(ct,{className:"h-5 w-5"}),"Dashboard"]})}),e.jsx("button",{onClick:()=>n("outbox"),className:`relative z-10 gap-2 h-12 font-medium transition-all flex items-center justify-center ${u==="outbox"?"text-white":"text-text-muted hover:text-text-primary"}`,children:e.jsxs(Z.div,{whileHover:{y:u==="outbox"?0:-1},className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-5 w-5"}),"Outbox"]})}),e.jsx("button",{onClick:()=>n("calendar"),className:`relative z-10 gap-2 h-12 font-medium transition-all flex items-center justify-center ${u==="calendar"?"text-white":"text-text-muted hover:text-text-primary"}`,children:e.jsxs(Z.div,{whileHover:{y:u==="calendar"?0:-1},className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"h-5 w-5"}),"Calendar"]})})]})}),u==="dashboard"&&e.jsx(Ot,{}),u==="outbox"&&e.jsx(Ut,{}),u==="calendar"&&e.jsx(Jt,{})]})})})]})]})})}export{ds as default};
