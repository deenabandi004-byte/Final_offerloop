import{r as x,j as e,ae as $e,l as me,X as Te,b5 as De,F as Me,ab as Ue,a1 as Oe,aA as de,b2 as ue,aH as he,k as Fe,aM as ze,aN as Ee,O as se,b6 as Be,K as je,b4 as pe,a0 as ve,b3 as Ie,as as ge,M as Je,at as we,ao as qe,u as Ge,aO as He,Y as Xe}from"./vendor-react-Bye97upB.js";import{d as ae,a as be,b as te,B as fe}from"./index-DlXH6OO2.js";import{I as Ye}from"./input-BsyuEDo1.js";import{p as We,q as Ke,w as Ve,t as Qe,v as Ze,z as et,d as ie,T as Ne,u as Pe,A as tt,B as xe,C as st,e as Re,n as at}from"./vendor-firebase-Bz1e_Tmy.js";const Le=s=>We(ae,"users",s,"scoutConversations"),nt=s=>{const o=s.replace(/https?:\/\/[^\s]+/g,"[Job Link]"),b=o.slice(0,50).trim();return b.length<o.length?b+"...":b||"New Conversation"},_e=()=>`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,rt=(s,o)=>s.length<=o?s:s.slice(0,o).trim()+"...",Ce=async(s,o)=>{const b=Le(s),u={title:nt(o),createdAt:xe(),updatedAt:xe(),messageCount:0,lastMessage:"",messages:[],metadata:{topics:[],jobsDiscussed:[],companiesDiscussed:[]}};return(await et(b,u)).id},it=async(s,o=50)=>{const b=Le(s),u=Ke(b,Qe("updatedAt","desc"),Ve(o));return(await Ze(u)).docs.map(h=>({id:h.id,...h.data()}))},ke=async(s,o)=>{const b=ie(ae,"users",s,"scoutConversations",o),u=await Re(b);return u.exists()?{id:u.id,...u.data()}:null},Se=async(s,o,b,u,i)=>{const h=ie(ae,"users",s,"scoutConversations",o),m=Ne.now(),B={id:_e(),role:"user",content:b,timestamp:m},K={id:_e(),role:"assistant",content:u,timestamp:Ne.fromMillis(m.toMillis()+1),metadata:i};await Pe(h,{messages:st(B,K),updatedAt:xe(),messageCount:tt(2),lastMessage:rt(u,100)})},ot=async(s,o,b)=>{const u=ie(ae,"users",s,"scoutConversations",o);await Pe(u,{title:b.trim(),updatedAt:xe()})},lt=async(s,o)=>{const b=ie(ae,"users",s,"scoutConversations",o);await at(b)},ct=({currentConversationId:s,onSelectConversation:o,onNewConversation:b,refreshTrigger:u})=>{const{user:i}=be(),[h,m]=x.useState([]),[B,K]=x.useState(!0),[J,F]=x.useState(null),[S,D]=x.useState(""),[M,E]=x.useState(null);x.useEffect(()=>{i!=null&&i.uid&&V()},[i==null?void 0:i.uid,u]);const V=async()=>{if(i!=null&&i.uid)try{K(!0);const c=await it(i.uid);m(c)}catch(c){console.error("[ScoutConversationList] Failed to load conversations:",c)}finally{K(!1)}},z=async c=>{if(i!=null&&i.uid)try{await lt(i.uid,c),m(y=>y.filter(I=>I.id!==c)),E(null),c===s&&b()}catch(y){console.error("[ScoutConversationList] Failed to delete conversation:",y)}},G=async c=>{if(!(!(i!=null&&i.uid)||!S.trim()))try{await ot(i.uid,c,S.trim()),m(y=>y.map(I=>I.id===c?{...I,title:S.trim()}:I)),F(null)}catch(y){console.error("[ScoutConversationList] Failed to update title:",y)}},H=c=>{var n;const y=((n=c==null?void 0:c.toDate)==null?void 0:n.call(c))||new Date(c),t=new Date().getTime()-y.getTime();return t<6e4?"Just now":t<36e5?`${Math.floor(t/6e4)}m ago`:t<864e5?`${Math.floor(t/36e5)}h ago`:t<6048e5?`${Math.floor(t/864e5)}d ago`:y.toLocaleDateString()};return e.jsxs("div",{className:"flex flex-col h-full bg-gray-50 border-r border-gray-200",children:[e.jsx("div",{className:"p-5 border-b border-gray-200",children:e.jsxs("button",{onClick:b,className:`w-full flex items-center justify-center gap-2 px-5 py-3 
                     bg-blue-600 text-white rounded-lg hover:bg-blue-700 
                     transition-colors text-base font-medium`,children:[e.jsx($e,{size:20}),"New Chat"]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:B?e.jsx("div",{className:"p-6 text-center text-gray-500 text-base",children:"Loading conversations..."}):h.length===0?e.jsx("div",{className:"p-6 text-center text-gray-500 text-base",children:"No conversations yet. Start a new chat!"}):e.jsx("div",{className:"py-3",children:h.map(c=>e.jsx("div",{className:`group relative px-4 py-3 mx-3 rounded-lg cursor-pointer
                           transition-colors ${c.id===s?"bg-blue-100 border border-blue-200":"hover:bg-gray-100"}`,onClick:()=>o(c),children:J===c.id?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:S,onChange:y=>D(y.target.value),className:"flex-1 px-2 py-1 text-sm border rounded",autoFocus:!0,onKeyDown:y=>{y.key==="Enter"&&G(c.id),y.key==="Escape"&&F(null)},onClick:y=>y.stopPropagation()}),e.jsx("button",{onClick:y=>{y.stopPropagation(),G(c.id)},className:"p-1 text-green-600 hover:bg-green-100 rounded",children:e.jsx(me,{size:16})}),e.jsx("button",{onClick:y=>{y.stopPropagation(),F(null)},className:"p-1 text-gray-500 hover:bg-gray-200 rounded",children:e.jsx(Te,{size:16})})]}):M===c.id?e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-red-600",children:"Delete?"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:y=>{y.stopPropagation(),z(c.id)},className:"px-2 py-1 text-xs bg-red-600 text-white rounded",children:"Yes"}),e.jsx("button",{onClick:y=>{y.stopPropagation(),E(null)},className:"px-2 py-1 text-xs bg-gray-300 rounded",children:"No"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(De,{size:18,className:"mt-1 text-gray-400 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-base text-gray-900 truncate",children:c.title}),e.jsx("div",{className:"text-sm text-gray-500 truncate mt-1",children:c.lastMessage||"No messages"}),e.jsxs("div",{className:"flex items-center gap-1 mt-1.5 text-xs text-gray-400",children:[e.jsx(Me,{size:13}),H(c.updatedAt)]})]})]}),e.jsxs("div",{className:"absolute right-2 top-2 hidden group-hover:flex gap-1",children:[e.jsx("button",{onClick:y=>{y.stopPropagation(),D(c.title),F(c.id)},className:"p-1 text-gray-500 hover:bg-gray-200 rounded",title:"Edit title",children:e.jsx(Ue,{size:14})}),e.jsx("button",{onClick:y=>{y.stopPropagation(),E(c.id)},className:"p-1 text-gray-500 hover:bg-red-100 hover:text-red-600 rounded",title:"Delete",children:e.jsx(Oe,{size:14})})]})]})},c.id))})})]})},Ae=({analysis:s,job:o,onGenerateCoverLetter:b,isGeneratingCoverLetter:u,userResume:i})=>{var I;const[h,m]=x.useState("overview"),[B,K]=x.useState(new Set),[J,F]=x.useState(null),[S,D]=x.useState(null),[M,E]=x.useState(!1),[V,z]=x.useState(!1),G=async(t,n)=>{await navigator.clipboard.writeText(t),F(n),setTimeout(()=>F(null),2e3)},H=t=>{const n=new Set(B);n.has(t)?n.delete(t):n.add(t),K(n)},c=t=>{switch(t){case"strong":return e.jsx(de,{className:"text-green-500",size:16});case"partial":return e.jsx(ue,{className:"text-yellow-500 fill-yellow-200",size:16});case"weak":return e.jsx(ue,{className:"text-orange-400",size:16});default:return e.jsx(he,{className:"text-red-400",size:16})}},y=t=>{switch(t){case"high":return"bg-red-100 text-red-700 border-red-200";case"medium":return"bg-yellow-100 text-yellow-700 border-yellow-200";default:return"bg-gray-100 text-gray-600 border-gray-200"}};return e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 p-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-gray-900",children:["Fit Analysis: ",o.title]}),e.jsx("p",{className:"text-sm text-gray-600",children:o.company})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:`text-3xl font-bold ${s.score>=80?"text-green-600":s.score>=60?"text-blue-600":s.score>=40?"text-yellow-600":"text-red-600"}`,children:[s.score,"%"]}),e.jsxs("div",{className:"text-sm text-gray-500 capitalize",children:[s.match_level," match"]})]})]}),e.jsxs("div",{className:"flex gap-4 mt-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(de,{size:14,className:"text-green-500"}),e.jsxs("span",{children:[s.requirements_summary.matched," matched"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ue,{size:14,className:"text-yellow-500 fill-yellow-200"}),e.jsxs("span",{children:[s.requirements_summary.partial," partial"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(he,{size:14,className:"text-red-400"}),e.jsxs("span",{children:[s.requirements_summary.missing," missing"]})]})]})]}),e.jsx("div",{className:"flex border-b border-gray-200",children:[{id:"overview",label:"Overview"},{id:"requirements",label:`Requirements (${((I=s.job_requirements)==null?void 0:I.length)||0})`},{id:"edits",label:`Resume Edits (${s.resume_edits.length})`},{id:"cover_letter",label:"Cover Letter"}].map(t=>e.jsx("button",{onClick:()=>m(t.id),className:`flex-1 px-4 py-2 text-sm font-medium transition-colors ${h===t.id?"border-b-2 border-blue-600 text-blue-600 bg-blue-50":"text-gray-600 hover:bg-gray-50"}`,children:t.label},t.id))}),e.jsxs("div",{className:"p-4 max-h-[500px] overflow-y-auto",children:[h==="overview"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-1",children:"Your Pitch"}),e.jsx("p",{className:"text-blue-800 text-sm",children:s.pitch})]}),s.strengths.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-green-700 mb-2 flex items-center gap-1",children:[e.jsx(de,{size:16})," Strengths"]}),e.jsx("ul",{className:"space-y-2",children:s.strengths.map((t,n)=>e.jsxs("li",{className:"bg-green-50 rounded p-2 text-sm",children:[e.jsx("span",{className:"font-medium text-green-800",children:t.point}),t.evidence&&e.jsxs("span",{className:"text-green-600",children:[" â€” ",t.evidence]})]},n))})]}),s.gaps.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-orange-700 mb-2 flex items-center gap-1",children:[e.jsx(he,{size:16})," Gaps to Address"]}),e.jsx("ul",{className:"space-y-2",children:s.gaps.map((t,n)=>e.jsxs("li",{className:"bg-orange-50 rounded p-2 text-sm",children:[e.jsx("span",{className:"font-medium text-orange-800",children:t.gap}),t.mitigation&&e.jsxs("span",{className:"text-orange-600 block mt-1",children:["â†’ ",t.mitigation]})]},n))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-700 mb-2",children:"Keywords to Use"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.keywords_to_use.map((t,n)=>e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-700 rounded text-sm",children:t},n))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-700 mb-2",children:"Talking Points"}),e.jsx("ul",{className:"space-y-1",children:s.talking_points.map((t,n)=>e.jsxs("li",{className:"text-sm text-gray-600 flex items-start gap-2",children:[e.jsx(Fe,{size:14,className:"mt-0.5 text-blue-500 flex-shrink-0"}),t]},n))})]})]}),h==="requirements"&&e.jsx("div",{className:"space-y-2",children:s.job_requirements&&s.job_requirements.length>0?s.job_requirements.map((t,n)=>e.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>H(n),className:"w-full flex items-center gap-3 p-3 hover:bg-gray-50 text-left",children:[c(t.match_strength),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:t.requirement}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[e.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded ${t.requirement_type==="required"?"bg-red-100 text-red-700":t.requirement_type==="preferred"?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-600"}`,children:t.requirement_type}),e.jsxs("span",{className:"text-xs text-gray-500",children:[t.importance," priority"]})]})]}),B.has(n)?e.jsx(ze,{size:16,className:"text-gray-400"}):e.jsx(Ee,{size:16,className:"text-gray-400"})]}),B.has(n)&&e.jsxs("div",{className:"px-3 pb-3 border-t border-gray-100 bg-gray-50",children:[e.jsx("p",{className:"text-sm text-gray-600 mt-2 mb-2",children:t.explanation}),t.resume_matches.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 mb-1",children:"Matching Resume Content:"}),t.resume_matches.map((p,v)=>e.jsxs("div",{className:"bg-white rounded p-2 mt-1 border border-gray-200 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500 mb-1",children:[e.jsx("span",{className:"font-medium",children:p.section}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:p.company_or_context}),e.jsx("span",{className:`ml-auto px-1.5 py-0.5 rounded ${p.relevance==="direct"?"bg-green-100 text-green-700":p.relevance==="partial"?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-600"}`,children:p.relevance})]}),e.jsx("p",{className:"text-gray-700",children:p.bullet})]},v))]}),!t.is_matched&&t.suggestion_if_missing&&e.jsxs("div",{className:"mt-2 p-2 bg-yellow-50 rounded border border-yellow-200",children:[e.jsx("p",{className:"text-xs font-medium text-yellow-800 mb-1",children:"How to address:"}),e.jsx("p",{className:"text-sm text-yellow-700",children:t.suggestion_if_missing})]})]})]},n)):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("p",{children:"No requirements data available"}),e.jsx("p",{className:"text-sm mt-2",children:"Requirements matching may not have completed successfully."})]})}),h==="edits"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg p-3 mb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-green-800",children:"Potential score after edits:"}),e.jsxs("span",{className:"text-xl font-bold text-green-600",children:[s.potential_score_after_edits,"%",e.jsxs("span",{className:"text-sm font-normal text-green-500 ml-1",children:["(+",s.potential_score_after_edits-s.score,")"]})]})]})}),s.resume_edits.length>0&&e.jsx("div",{className:"bg-blue-50 rounded-lg p-4 mb-4 border border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-1",children:"Generate Complete Edited Resume"}),e.jsxs("p",{className:"text-sm text-blue-700",children:["Apply all ",s.resume_edits.length," edits and get a formatted resume ready to use"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:async()=>{if(!i){alert("Resume data not available. Please try analyzing the job again.");return}E(!0);try{const t=window.location.hostname==="localhost"?"http://localhost:5001":"https://www.offerloop.ai",n=te.currentUser,p=n?await n.getIdToken():null,v={"Content-Type":"application/json"};p&&(v.Authorization=`Bearer ${p}`);const k=await(await fetch(`${t}/api/scout/generate-edited-resume`,{method:"POST",headers:v,body:JSON.stringify({user_resume:i,resume_edits:s.resume_edits,format:"pdf"})})).json();if(k.status==="ok"&&k.edited_resume){const A=k.edited_resume.pdf_base64,q=k.edited_resume.formatted_text;if(A){const Q=Uint8Array.from(atob(A),ee=>ee.charCodeAt(0)),U=new Blob([Q],{type:"application/pdf"}),R=URL.createObjectURL(U),O=document.createElement("a");O.href=R;const Y=ee=>ee.replace(/[^a-z0-9-]/gi,"-").replace(/-+/g,"-").toLowerCase(),Z=Y(o.company||"company"),W=Y(o.title||"position");O.download=`resume-${Z}-${W}.pdf`,O.style.display="none",document.body.appendChild(O),O.click(),setTimeout(()=>{document.body.removeChild(O),URL.revokeObjectURL(R)},100),q&&(D(q),z(!0))}else alert("PDF generation failed. Please try again.")}else alert(k.message||"Failed to generate edited resume")}catch(t){console.error("[Scout] Failed to generate edited resume:",t),alert("Failed to generate edited resume. Please try again.")}finally{E(!1)}},disabled:M||!i,className:`flex items-center gap-2 px-4 py-2 bg-blue-600 text-white 
                                 rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors`,children:M?e.jsxs(e.Fragment,{children:[e.jsx(se,{size:16,className:"animate-spin"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Be,{size:16}),"Generate PDF"]})}),e.jsx("button",{onClick:async()=>{if(!i){alert("Resume data not available. Please try analyzing the job again.");return}E(!0);try{const t=window.location.hostname==="localhost"?"http://localhost:5001":"https://www.offerloop.ai",n=te.currentUser,p=n?await n.getIdToken():null,v={"Content-Type":"application/json"};p&&(v.Authorization=`Bearer ${p}`);const k=await(await fetch(`${t}/api/scout/generate-edited-resume`,{method:"POST",headers:v,body:JSON.stringify({user_resume:i,resume_edits:s.resume_edits,format:"plain"})})).json();if(k.status==="ok"&&k.edited_resume){const A=k.edited_resume.formatted_text;if(!A||!A.trim()){console.error("[Scout] Empty formatted resume received"),alert("Generated resume is empty. Please check your resume data.");return}D(A),z(!0);try{const q=new Blob([A],{type:"text/plain"}),Q=URL.createObjectURL(q),U=document.createElement("a");U.href=Q;const R=Z=>Z.replace(/[^a-z0-9-]/gi,"-").replace(/-+/g,"-").toLowerCase(),O=R(o.company||"company"),Y=R(o.title||"position");U.download=`resume-${O}-${Y}.txt`,U.style.display="none",document.body.appendChild(U),U.click(),setTimeout(()=>{document.body.removeChild(U),URL.revokeObjectURL(Q)},100)}catch(q){console.error("[Scout] Download failed:",q),alert('Resume generated successfully! The download may have been blocked by your browser. Please use the "Download Again" button or copy the text.')}}else alert(k.message||"Failed to generate edited resume")}catch(t){console.error("[Scout] Failed to generate edited resume:",t),alert("Failed to generate edited resume. Please try again.")}finally{E(!1)}},disabled:M||!i,className:`flex items-center gap-2 px-4 py-2 bg-gray-600 text-white 
                                 rounded-lg hover:bg-gray-700 disabled:opacity-50 transition-colors`,children:M?e.jsxs(e.Fragment,{children:[e.jsx(se,{size:16,className:"animate-spin"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(je,{size:16}),"Generate TXT"]})})]})]})}),V&&S&&e.jsxs("div",{className:"bg-white rounded-lg border-2 border-blue-200 p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:"Complete Edited Resume"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{G(S,"full_resume")},className:`flex items-center gap-1 px-3 py-1.5 text-sm bg-gray-100 text-gray-700 
                                 rounded hover:bg-gray-200 transition-colors`,children:J==="full_resume"?e.jsxs(e.Fragment,{children:[e.jsx(me,{size:14}),"Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(pe,{size:14}),"Copy"]})}),e.jsxs("button",{onClick:()=>{try{if(!S){alert("No resume to download");return}const t=new Blob([S],{type:"text/plain"}),n=URL.createObjectURL(t),p=document.createElement("a");p.href=n;const v=A=>A.replace(/[^a-z0-9-]/gi,"-").replace(/-+/g,"-").toLowerCase(),P=v(o.company||"company"),k=v(o.title||"position");p.download=`resume-${P}-${k}.txt`,p.style.display="none",document.body.appendChild(p),p.click(),setTimeout(()=>{document.body.removeChild(p),URL.revokeObjectURL(n)},100)}catch(t){console.error("[Scout] Download error:",t),alert("Failed to download resume. Please try copying it instead.")}},className:`flex items-center gap-1 px-3 py-1.5 text-sm bg-gray-600 text-white 
                                 rounded hover:bg-gray-700 transition-colors`,children:[e.jsx(ve,{size:14}),"Download TXT"]}),e.jsxs("button",{onClick:async()=>{var t;if(!i){alert("Resume data not available");return}try{const n=window.location.hostname==="localhost"?"http://localhost:5001":"https://www.offerloop.ai",p=te.currentUser,v=p?await p.getIdToken():null,P={"Content-Type":"application/json"};v&&(P.Authorization=`Bearer ${v}`);const A=await(await fetch(`${n}/api/scout/generate-edited-resume`,{method:"POST",headers:P,body:JSON.stringify({user_resume:i,resume_edits:s.resume_edits,format:"pdf"})})).json();if(A.status==="ok"&&((t=A.edited_resume)!=null&&t.pdf_base64)){const q=Uint8Array.from(atob(A.edited_resume.pdf_base64),W=>W.charCodeAt(0)),Q=new Blob([q],{type:"application/pdf"}),U=URL.createObjectURL(Q),R=document.createElement("a");R.href=U;const O=W=>W.replace(/[^a-z0-9-]/gi,"-").replace(/-+/g,"-").toLowerCase(),Y=O(o.company||"company"),Z=O(o.title||"position");R.download=`resume-${Y}-${Z}.pdf`,R.style.display="none",document.body.appendChild(R),R.click(),setTimeout(()=>{document.body.removeChild(R),URL.revokeObjectURL(U)},100)}else alert("Failed to generate PDF")}catch(n){console.error("[Scout] PDF download error:",n),alert("Failed to download PDF. Please try again.")}},className:`flex items-center gap-1 px-3 py-1.5 text-sm bg-blue-600 text-white 
                                 rounded hover:bg-blue-700 transition-colors`,children:[e.jsx(ve,{size:14}),"Download PDF"]})]})]}),e.jsx("div",{className:"bg-gray-50 rounded p-4 border border-gray-200 max-h-96 overflow-y-auto",children:e.jsx("pre",{className:"whitespace-pre-wrap text-sm text-gray-800 font-mono",children:S})})]}),s.resume_edits.map((t,n)=>e.jsx("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:e.jsxs("div",{className:"p-3",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ie,{size:16,className:"text-blue-500"}),e.jsxs("span",{className:"font-medium text-gray-900",children:[t.section,t.subsection&&e.jsxs("span",{className:"text-gray-500",children:[" â€¢ ",t.subsection]})]})]}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded border ${y(t.priority)}`,children:[t.priority," priority"]})]}),e.jsx("p",{className:"text-sm text-blue-600 mb-2",children:t.impact}),t.before_after_preview&&e.jsxs("div",{className:"space-y-2 mb-2",children:[t.before_after_preview.before&&e.jsxs("div",{className:"bg-red-50 rounded p-2 border border-red-100",children:[e.jsx("p",{className:"text-xs text-red-500 font-medium mb-1",children:"Before:"}),e.jsx("p",{className:"text-sm text-red-700 line-through",children:t.before_after_preview.before})]}),e.jsxs("div",{className:"bg-green-50 rounded p-2 border border-green-100",children:[e.jsx("p",{className:"text-xs text-green-600 font-medium mb-1",children:t.current_content?"After:":"Add:"}),e.jsx("p",{className:"text-sm text-green-800",children:t.before_after_preview.after||t.suggested_content})]})]}),!t.before_after_preview&&e.jsxs("div",{className:"bg-blue-50 rounded p-2 border border-blue-100 mb-2",children:[e.jsx("p",{className:"text-xs text-blue-600 font-medium mb-1",children:"Suggestion:"}),e.jsx("p",{className:"text-sm text-blue-800",children:t.suggested_content})]}),e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:t.rationale}),t.keywords_added.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1",children:t.keywords_added.map((p,v)=>e.jsxs("span",{className:"text-xs px-1.5 py-0.5 bg-purple-100 text-purple-700 rounded",children:["+",p]},v))}),e.jsx("button",{onClick:()=>G(t.suggested_content,t.id),className:"mt-2 flex items-center gap-1 text-xs text-gray-500 hover:text-gray-700",children:J===t.id?e.jsxs(e.Fragment,{children:[e.jsx(me,{size:12,className:"text-green-500"}),"Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(pe,{size:12}),"Copy suggestion"]})})]})},t.id))]}),h==="cover_letter"&&e.jsx("div",{children:s.cover_letter?e.jsx(dt,{coverLetter:s.cover_letter,onCopy:(t,n)=>G(t,n),copiedText:J}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(je,{size:48,className:"mx-auto text-gray-300 mb-4"}),e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Generate a Tailored Cover Letter"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Based on your fit analysis, we'll create a personalized cover letter that highlights your strengths and addresses key requirements."}),e.jsx("button",{onClick:b,disabled:u,className:`inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white 
                             rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors`,children:u?e.jsxs(e.Fragment,{children:[e.jsx(se,{size:16,className:"animate-spin"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ge,{size:16}),"Generate Cover Letter"]})})]})})]})]})},dt=({coverLetter:s,onCopy:o,copiedText:b})=>{const[u,i]=x.useState(!1);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("span",{className:`text-xs px-2 py-1 rounded ${s.tone==="formal"?"bg-gray-100 text-gray-700":s.tone==="enthusiastic"?"bg-orange-100 text-orange-700":"bg-blue-100 text-blue-700"}`,children:[s.tone," tone"]}),e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:[s.word_count," words"]})]}),e.jsx("button",{onClick:()=>o(s.full_text,"full_letter"),className:`flex items-center gap-1 px-3 py-1.5 bg-blue-600 text-white 
                     rounded hover:bg-blue-700 text-sm`,children:b==="full_letter"?e.jsxs(e.Fragment,{children:[e.jsx(me,{size:14}),"Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(pe,{size:14}),"Copy Full Letter"]})})]}),e.jsxs("div",{className:"bg-purple-50 rounded-lg p-3 text-sm",children:[e.jsx("span",{className:"font-medium text-purple-800",children:"Customization: "}),e.jsx("span",{className:"text-purple-700",children:s.customization_summary})]}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:e.jsx("div",{className:"prose prose-sm max-w-none",children:s.full_text.split(`

`).map((h,m)=>e.jsx("p",{className:"text-gray-800 mb-3 last:mb-0",children:h},m))})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-gray-700 mb-2",children:"Requirements Addressed:"}),e.jsx("ul",{className:"space-y-1",children:s.key_requirements_addressed.map((h,m)=>e.jsxs("li",{className:"flex items-center gap-1 text-gray-600",children:[e.jsx(de,{size:12,className:"text-green-500"}),h]},m))})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-gray-700 mb-2",children:"Resume Points Used:"}),e.jsx("ul",{className:"space-y-1",children:s.key_resume_points_used.map((h,m)=>e.jsxs("li",{className:"flex items-center gap-1 text-gray-600",children:[e.jsx(Fe,{size:12,className:"text-blue-500"}),h]},m))})]})]}),e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>i(!u),className:"text-sm text-blue-600 hover:underline flex items-center gap-1",children:[u?e.jsx(ze,{size:14}):e.jsx(Ee,{size:14}),u?"Hide":"Show"," alternate openings & closings"]}),u&&e.jsxs("div",{className:"mt-3 grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"text-xs font-medium text-gray-500 mb-2",children:"Alternate Openings:"}),s.alternate_openings.map((h,m)=>e.jsxs("div",{className:"bg-white rounded p-2 border border-gray-200 mb-2 text-sm",children:[e.jsx("p",{className:"text-gray-700",children:h}),e.jsx("button",{onClick:()=>o(h,`opening_${m}`),className:"text-xs text-gray-400 hover:text-gray-600 mt-1",children:b===`opening_${m}`?"Copied!":"Copy"})]},m))]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-xs font-medium text-gray-500 mb-2",children:"Alternate Closings:"}),s.alternate_closings.map((h,m)=>e.jsxs("div",{className:"bg-white rounded p-2 border border-gray-200 mb-2 text-sm",children:[e.jsx("p",{className:"text-gray-700",children:h}),e.jsx("button",{onClick:()=>o(h,`closing_${m}`),className:"text-xs text-gray-400 hover:text-gray-600 mt-1",children:b===`closing_${m}`?"Copied!":"Copy"})]},m))]})]})]})]})},ce=window.location.hostname==="localhost"?"http://localhost:5001":"https://www.offerloop.ai",mt=s=>{if(!s)return s;const o=["Software Engineer","Software Developer","Engineer","Product Manager","Program Manager","Project Manager","Data Scientist","Data Analyst","Data Engineer","Investment Banking Analyst","Investment Banker","Financial Analyst","Business Analyst","Analyst","Consultant","Associate","Manager","Director","Designer","Researcher","Scientist","Account Executive","Sales Representative","Marketing Manager","Marketing Specialist","Operations Manager","Operations Analyst","HR Manager","Recruiter","Talent Acquisition","Attorney","Lawyer","Counsel","Accountant","Controller","Auditor"],b=["Senior","Staff","Principal","Lead","Junior","Associate","Vice President","VP"],u=s.toLowerCase();let i="";for(const m of o)if(u.includes(m.toLowerCase())){i=m;break}if(!i){if(s.length>40){const m=s.split(/[-â€“â€”,&]/),B=m[m.length-1].trim();if(B.length>3)return B}return s}let h="";for(const m of b)if(u.includes(m.toLowerCase())){h=m;break}return h&&!i.toLowerCase().includes(h.toLowerCase())?`${h} ${i}`:i},xt=({onJobTitleSuggestion:s,userResume:o,showSidebar:b=!0})=>{const{user:u}=be(),[i,h]=x.useState(null),[m,B]=x.useState(b),[K,J]=x.useState(0),[F,S]=x.useState([]),[D,M]=x.useState(""),[E,V]=x.useState(!1),[z,G]=x.useState({}),H=x.useRef(null),c=x.useRef(null),[y,I]=x.useState(null),[t,n]=x.useState({}),[p,v]=x.useState({}),[P,k]=x.useState(null),[A,q]=x.useState(null);x.useEffect(()=>{var a;(a=H.current)==null||a.scrollIntoView({behavior:"smooth"})},[F]);const Q=async a=>{h(a);const N=(a.messages||[]).map(w=>{var g,j,_,l,L,C;return{id:w.id,role:w.role,content:w.content,fields:(g=w.metadata)==null?void 0:g.fields,jobListings:(j=w.metadata)==null?void 0:j.jobListings,fitAnalysis:(_=w.metadata)!=null&&_.fitAnalysis?{overall_score:w.metadata.fitAnalysis.score,strengths:((l=w.metadata.fitAnalysis.strengths)==null?void 0:l.map(f=>f.point))||[],gaps:((L=w.metadata.fitAnalysis.gaps)==null?void 0:L.map(f=>f.gap))||[],angles:[],experience_match:w.metadata.fitAnalysis.matchLevel}:void 0,timestamp:(C=w.timestamp)!=null&&C.toDate?w.timestamp.toDate():new Date(w.timestamp)}});S(N),n({}),k(null)},U=()=>{var a;h(null),S([]),n({}),k(null),G({}),J(N=>N+1),(a=c.current)==null||a.focus()},R=async()=>{var w,g;if(!D.trim()||E||!(u!=null&&u.uid))return;const a=D.trim();M(""),V(!0);const N={id:`temp_${Date.now()}`,role:"user",content:a,timestamp:new Date};S(j=>[...j,N]);try{let j=i==null?void 0:i.id;j||(j=await Ce(u.uid,a));const _=F.slice(-15).map(d=>({role:d.role,content:d.content})),l=te.currentUser,L=l?await l.getIdToken():null,C={"Content-Type":"application/json"};L&&(C.Authorization=`Bearer ${L}`);const f=await fetch(`${ce}/api/scout/chat`,{method:"POST",headers:C,body:JSON.stringify({message:a,conversation_id:j,conversation_history:_,context:{...z,user_resume:o}})});if(!f.ok){const d=await f.text();throw console.error("[Scout] API error:",f.status,d),new Error(`API returned ${f.status}: ${d}`)}const r=await f.json();console.log("[Scout] Response received:",{status:r.status,hasMessage:!!r.message,hasFields:!!r.fields,hasFitAnalysis:!!r.fit_analysis,hasEnhancedAnalysis:!!r.enhanced_analysis,messageLength:(w=r.message)==null?void 0:w.length}),r.context&&G(r.context);const X={id:`assistant-${Date.now()}`,role:"assistant",content:r.message||"I received your message but had trouble processing it. Please try again.",fields:r.fields,jobListings:r.job_listings,fitAnalysis:r.fit_analysis,enhancedAnalysis:r.enhanced_analysis,timestamp:new Date};r.job_listings&&r.job_listings.length>0&&console.log("[Scout] Job listings received:",r.job_listings.map(d=>({title:d.title,company:d.company,url:d.url,hasUrl:!!d.url}))),S(d=>[...d.slice(0,-1),N,X]);try{await Se(u.uid,j,a,X.content,{intent:r.intent,fields:r.fields,jobListings:r.job_listings,fitAnalysis:r.fit_analysis,enhancedAnalysis:r.enhanced_analysis})}catch(d){console.error("[Scout] Failed to save to Firestore:",d)}try{if(i)J(d=>d+1);else{const d=await ke(u.uid,j);d&&(h(d),J(re=>re+1))}}catch(d){console.error("[Scout] Failed to update conversation:",d)}if(r.fields){const{job_title:d,company:re,location:$}=r.fields;if((d||re||$)&&s)try{s(d||"",re||void 0,$||void 0)}catch(oe){console.error("[Scout] Failed to populate fields:",oe)}}}catch(j){console.error("[Scout] Error:",j);const _=j instanceof Error?`I ran into an issue: ${j.message}. Please try again.`:"Oops! I ran into an issue. Please try again or rephrase your message.";S(l=>[...l.slice(0,-1),N,{id:`error-${Date.now()}`,role:"assistant",content:_,timestamp:new Date}])}finally{V(!1),(g=c.current)==null||g.focus()}},O=a=>{a.key==="Enter"&&!a.shiftKey&&(a.preventDefault(),R())},Y=a=>{if(s){const N=mt(a.title);console.log("[Scout] Simplified job title:",a.title,"â†’",N),s(N,a.company,a.location||void 0)}},Z=async(a,N)=>{if(console.log("[Scout] analyzeJob called",{jobId:N,job:a,hasResume:!!o}),p[N]||t[N]){console.log("[Scout] Analysis already exists, toggling expand"),k(P===N?null:N);return}if(!o){console.warn("[Scout] Cannot analyze job without resume"),alert("Please upload your resume in Account Settings to use job fit analysis.");return}I(N),console.log("[Scout] Starting enhanced analysis for job:",a.title);try{const w=te.currentUser,g=w?await w.getIdToken():null,j={"Content-Type":"application/json"};g&&(j.Authorization=`Bearer ${g}`);const _=!1;let l;const L=new AbortController,C=setTimeout(()=>L.abort(),15e4);try{l=await fetch(`${ce}/api/scout/analyze-job`,{method:"POST",headers:j,body:JSON.stringify({job:a,user_resume:o,options:{include_requirement_mapping:!0,include_resume_edits:!0,include_cover_letter:!1}}),signal:L.signal}),clearTimeout(C)}catch(r){throw clearTimeout(C),r.name==="AbortError"?(console.error("[Scout] Analysis request timed out"),new Error("Analysis timed out. The job posting might be too complex. Please try again.")):(console.error("[Scout] Fetch error:",r),new Error(`Network error: ${r.message}`))}if(console.log("[Scout] Analysis response status:",l.status),!l.ok){let r="Unknown error";try{r=await l.text()}catch{r=l.statusText||`HTTP ${l.status}`}throw console.error("[Scout] Analysis failed with status:",l.status,r),new Error(`Analysis failed: ${l.status} ${r}`)}let f;try{f=await l.json()}catch(r){console.error("[Scout] Failed to parse JSON response:",r);const X=await l.text();throw console.error("[Scout] Response text:",X.substring(0,500)),new Error("Invalid response from server. Please try again.")}if(console.log("[Scout] Analysis response:",f),f.status==="ok"&&f.analysis){const r=f.analysis;if(r.job_requirements)v(X=>({...X,[N]:r}));else{const X={score:typeof r.score=="number"?r.score:50,match_level:r.match_level||"moderate",strengths:Array.isArray(r.strengths)?r.strengths.map(d=>({point:typeof d=="string"?d:d.point||d.strength||String(d),evidence:typeof d=="object"&&(d.evidence||d.proof)||""})):[],gaps:Array.isArray(r.gaps)?r.gaps.map(d=>({gap:typeof d=="string"?d:d.gap||d.weakness||String(d),mitigation:typeof d=="object"&&(d.mitigation||d.solution)||""})):[],pitch:r.pitch||"",talking_points:Array.isArray(r.talking_points)?r.talking_points:[],keywords_to_use:Array.isArray(r.keywords_to_use)?r.keywords_to_use:[]};n(d=>({...d,[N]:X}))}k(N),console.log("[Scout] Analysis saved and expanded")}else{console.error("[Scout] Analysis response missing data:",f);const r=f.message||"Unknown error";alert(`Failed to analyze job fit: ${r}`)}}catch(w){console.error("[Scout] Analysis failed:",w),alert("Failed to analyze job fit. Please try again.")}finally{I(null)}},W=async(a,N)=>{if(!A){q(a);try{const w=p[a],g=te.currentUser,j=g?await g.getIdToken():null,_={"Content-Type":"application/json"};j&&(_.Authorization=`Bearer ${j}`);const L=await(await fetch(`${ce}/api/scout/generate-cover-letter`,{method:"POST",headers:_,body:JSON.stringify({job:N,user_resume:o,fit_analysis:w,options:{tone:"conversational",length:"medium"}})})).json();L.status==="ok"&&L.cover_letter&&v(C=>({...C,[a]:{...C[a],cover_letter:L.cover_letter}}))}catch(w){console.error("[Scout] Cover letter generation error:",w),alert("Failed to generate cover letter. Please try again.")}finally{q(null)}}},ee=a=>a?a.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>").replace(/\n/g,"<br />"):"",ne=async a=>{var N,w,g,j,_;if(a==="paste-url")M("Paste job URL here..."),(N=c.current)==null||N.focus(),(w=c.current)==null||w.select();else if(a==="find-jobs-resume"){const l="Find jobs that fit my resume";if(!(u!=null&&u.uid)){alert("Please log in to use Scout");return}const L={id:`user-${Date.now()}`,role:"user",content:l,timestamp:new Date};S(C=>[...C,L]),M(""),V(!0);try{let C=i==null?void 0:i.id;C||(C=await Ce(u.uid,l));const f=F.slice(-15).map(T=>({role:T.role,content:T.content})),r=te.currentUser,X=r?await r.getIdToken():null,d={"Content-Type":"application/json"};X&&(d.Authorization=`Bearer ${X}`);const $=await(await fetch(`${ce}/api/scout/chat`,{method:"POST",headers:d,body:JSON.stringify({message:l,conversation_id:C,conversation_history:f,context:{...z,user_resume:o}})})).json();$.context&&G($.context);const oe={id:`assistant-${Date.now()}`,role:"assistant",content:$.message||"I received your message but had trouble processing it. Please try again.",fields:$.fields,jobListings:$.job_listings,fitAnalysis:$.fit_analysis,timestamp:new Date};if($.job_listings&&$.job_listings.length>0&&console.log("[Scout] Job listings received:",$.job_listings.map(T=>({title:T.title,company:T.company,url:T.url,hasUrl:!!T.url}))),S(T=>[...T,oe]),await Se(u.uid,C,l,oe.content,{intent:$.intent,fields:$.fields,jobListings:$.job_listings}),i)J(T=>T+1);else{const T=await ke(u.uid,C);T&&(h(T),J(le=>le+1))}if($.fields){const{job_title:T,company:le,location:ye}=$.fields;(T||le||ye)&&s&&s(T||"",le||void 0,ye||void 0)}}catch(C){console.error("[Scout] Error:",C),S(f=>[...f,{id:`error-${Date.now()}`,role:"assistant",content:"Oops! I ran into an issue. Please try again or rephrase your message.",timestamp:new Date}])}finally{V(!1),(g=c.current)==null||g.focus()}}else a==="ask-company"&&(M("Ask about a company..."),(j=c.current)==null||j.focus(),(_=c.current)==null||_.select())};return e.jsxs("div",{className:"flex h-full bg-white rounded-lg shadow-lg overflow-hidden",children:[m&&e.jsx("div",{className:"w-64 flex-shrink-0",children:e.jsx(ct,{currentConversationId:(i==null?void 0:i.id)||null,onSelectConversation:Q,onNewConversation:U,refreshTrigger:K})}),e.jsxs("div",{className:"flex-1 flex flex-col min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-4 px-6 py-4 border-b border-gray-200",children:[e.jsx("button",{onClick:()=>B(!m),className:"p-1 hover:bg-gray-100 rounded",children:e.jsx(Je,{size:20})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"text-blue-600",size:20}),e.jsx("span",{className:"font-semibold text-gray-900",children:"Scout"})]}),i&&e.jsx("span",{className:"text-sm text-gray-500 truncate",children:i.title})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[F.length===0&&e.jsx("div",{className:"mt-6 mx-6 p-4 rounded-2xl bg-[#F5F7FF]",children:e.jsx("p",{className:"text-base text-slate-800",children:"Hey! I'm Scout. Paste a job posting URL or describe a role and I'll fill in your search filters for you."})}),F.length===0&&e.jsxs("div",{className:"mt-4 flex flex-wrap gap-3 px-6",children:[e.jsx("button",{onClick:()=>ne("paste-url"),className:"inline-flex items-center px-4 py-2 rounded-full bg-white border border-slate-200 text-sm font-medium text-slate-700 hover:bg-slate-50 cursor-pointer transition-colors",children:"Paste job URL"}),e.jsx("button",{onClick:()=>ne("find-jobs-resume"),className:"inline-flex items-center px-4 py-2 rounded-full bg-white border border-slate-200 text-sm font-medium text-slate-700 hover:bg-slate-50 cursor-pointer transition-colors",children:"Find jobs that fit my resume"}),e.jsx("button",{onClick:()=>ne("ask-company"),className:"inline-flex items-center px-4 py-2 rounded-full bg-white border border-slate-200 text-sm font-medium text-slate-700 hover:bg-slate-50 cursor-pointer transition-colors",children:"Ask about a company"})]}),e.jsxs("div",{className:"px-6 py-6 space-y-5",children:[F.map(a=>{var N,w;return e.jsx("div",{className:`flex ${a.role==="user"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[80%] rounded-2xl p-4 ${a.role==="user"?"text-white":"bg-[#F5F7FF] text-slate-800"}`,style:a.role==="user"?{background:"linear-gradient(135deg, #3B82F6, #60A5FA)"}:void 0,children:[a.content&&e.jsx("div",{className:"text-base leading-relaxed",dangerouslySetInnerHTML:{__html:ee(a.content)}}),a.fields&&Object.keys(a.fields).length>0&&e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-blue-700 text-sm font-medium",children:[e.jsx(ge,{className:"h-4 w-4"}),"Search fields updated!"]}),e.jsx("div",{className:"text-xs text-blue-600 bg-blue-100 px-2 py-1 rounded",title:"Fields optimized for better search results",children:"âœ¨ Optimized"})]}),e.jsxs("div",{className:"text-sm text-blue-600 space-y-1",children:[a.fields.job_title&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-medium",children:"Title:"}),e.jsx("span",{children:a.fields.job_title})]}),a.fields.company&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-medium",children:"Company:"}),e.jsx("span",{children:a.fields.company})]}),a.fields.location&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-medium",children:"Location:"}),e.jsx("span",{children:a.fields.location})]})]})]}),a.enhancedAnalysis&&e.jsx("div",{className:"mt-4",children:e.jsx(Ae,{analysis:a.enhancedAnalysis,job:{title:((N=a.fields)==null?void 0:N.job_title)||"Job",company:((w=a.fields)==null?void 0:w.company)||"Company"},onGenerateCoverLetter:async()=>{if(!a.fields||!o)return;const g={title:a.fields.job_title||"",company:a.fields.company||"",location:a.fields.location||""},j=`${a.id}-analysis`;await W(j,g)},isGeneratingCoverLetter:A===`${a.id}-analysis`,userResume:o})}),!a.enhancedAnalysis&&a.fitAnalysis&&e.jsxs("div",{className:"mt-4 p-4 bg-amber-50 border border-amber-200 rounded-lg",children:[e.jsx("div",{className:"text-sm font-semibold text-amber-900 mb-3",children:"ðŸŽ¯ Job Fit Analysis"}),a.fitAnalysis.strengths&&a.fitAnalysis.strengths.length>0&&e.jsx("div",{className:"mb-3",children:a.fitAnalysis.strengths.map((g,j)=>e.jsxs("div",{className:"text-sm text-amber-800 mb-1.5",children:["âœ… ",g]},j))}),a.fitAnalysis.gaps&&a.fitAnalysis.gaps.length>0&&e.jsx("div",{className:"mb-3",children:a.fitAnalysis.gaps.map((g,j)=>e.jsxs("div",{className:"text-sm text-amber-700 mb-1.5",children:["âš ï¸ ",g]},j))}),a.fitAnalysis.angles&&a.fitAnalysis.angles.length>0&&e.jsxs("div",{className:"text-sm text-amber-800 font-medium mt-3",children:["ðŸ’¡ ",e.jsx("strong",{children:"Angle:"})," ",a.fitAnalysis.angles[0]]}),a.fitAnalysis.overall_score!==void 0&&e.jsxs("div",{className:"text-sm text-amber-900 font-medium mt-3",children:["Overall Fit: ",a.fitAnalysis.overall_score,"/100"]})]}),a.jobListings&&a.jobListings.length>0&&e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsx("div",{className:"text-sm text-slate-600 font-medium",children:"Click to use for search:"}),a.jobListings.slice(0,5).map((g,j)=>{const _=`${a.id}-job-${j}`,l=t[_],L=P===_,C=y===_;return e.jsxs("div",{className:"bg-white rounded-lg border border-slate-200 overflow-hidden",children:[e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{onClick:()=>Y(g),className:"flex-1 text-left min-w-0 cursor-pointer",children:[e.jsx("div",{className:"text-base font-medium text-slate-900",children:g.title}),e.jsxs("div",{className:"text-sm text-slate-500",children:[g.company,g.location&&` â€¢ ${g.location}`]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[o?e.jsx("button",{onClick:f=>{f.preventDefault(),f.stopPropagation(),console.log("[Scout] Analyze Fit button clicked",{jobId:_,job:g}),Z(g,_)},disabled:C,className:`px-4 py-2 text-sm font-medium rounded transition-all whitespace-nowrap cursor-pointer ${l?"bg-green-50 text-green-700 border border-green-200 hover:bg-green-100":"bg-slate-100 text-slate-600 hover:bg-slate-200"} ${C?"opacity-50 cursor-not-allowed":""}`,children:C?e.jsx(se,{className:"h-4 w-4 animate-spin inline"}):l?`${l.score}% Match`:"Analyze Fit"}):e.jsx("span",{className:"text-sm text-slate-400",children:"Upload resume to analyze"}),g.url&&g.url.trim()&&g.url.startsWith("http")?e.jsxs("a",{href:g.url,target:"_blank",rel:"noopener noreferrer",className:"flex-shrink-0 px-4 py-2 text-sm font-medium text-white rounded transition-all shadow-sm hover:shadow-md hover:opacity-90 flex items-center gap-1.5 whitespace-nowrap",style:{background:"linear-gradient(135deg, #3B82F6, #60A5FA)"},title:"View job posting",onClick:f=>{f.stopPropagation(),console.log("[Scout] Opening job URL:",g.url)},children:[e.jsx(we,{className:"h-4 w-4"}),e.jsx("span",{children:"View"})]}):e.jsxs("button",{disabled:!0,className:"flex-shrink-0 px-4 py-2 text-sm font-medium bg-slate-100 text-slate-400 rounded cursor-not-allowed flex items-center gap-1.5 whitespace-nowrap",title:"Job URL not available",children:[e.jsx(we,{className:"h-4 w-4"}),e.jsx("span",{children:"View"})]})]})]})}),L&&p[_]&&e.jsx("div",{className:"border-t border-slate-100 bg-slate-50 p-5",children:e.jsx(Ae,{analysis:p[_],job:{title:g.title,company:g.company},onGenerateCoverLetter:()=>W(_,g),isGeneratingCoverLetter:A===_,userResume:o})}),L&&!p[_]&&l&&e.jsxs("div",{className:"border-t border-slate-100 bg-slate-50 p-5",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsxs("div",{className:`text-2xl font-bold ${l.score>=70?"text-green-600":l.score>=50?"text-yellow-600":"text-orange-600"}`,children:[l.score,"%"]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-slate-900",children:[l.match_level==="strong"&&"ðŸŽ¯ Strong Match",l.match_level==="good"&&"ðŸ‘ Good Match",l.match_level==="moderate"&&"ðŸ¤” Moderate Match",l.match_level==="stretch"&&"ðŸŒ± Stretch Role"]}),e.jsx("div",{className:"text-xs text-slate-500",children:"Based on your resume"})]})]}),l.strengths&&l.strengths.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-xs font-medium text-slate-700 mb-2",children:"What aligns:"}),e.jsx("div",{className:"space-y-2",children:l.strengths.map((f,r)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-green-500 mt-0.5",children:"âœ“"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-slate-800",children:f.point}),e.jsxs("span",{className:"text-xs text-slate-500 ml-1",children:["â€” ",f.evidence]})]})]},r))})]}),l.gaps&&l.gaps.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-xs font-medium text-slate-700 mb-2",children:"Gaps to address:"}),e.jsx("div",{className:"space-y-2",children:l.gaps.map((f,r)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-orange-500 mt-0.5",children:"!"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-slate-800",children:f.gap}),e.jsxs("div",{className:"text-xs text-slate-600 mt-0.5",children:["ðŸ’¡ ",f.mitigation]})]})]},r))})]}),l.pitch&&e.jsxs("div",{className:"mb-4 p-3 bg-blue-50 rounded-lg border border-blue-100",children:[e.jsx("div",{className:"text-xs font-medium text-blue-800 mb-1",children:"ðŸ’¬ How to pitch yourself:"}),e.jsxs("div",{className:"text-sm text-blue-900 italic",children:['"',l.pitch,'"']})]}),l.talking_points&&l.talking_points.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-xs font-medium text-slate-700 mb-2",children:"Talking points for outreach:"}),e.jsx("ul",{className:"space-y-1",children:l.talking_points.map((f,r)=>e.jsxs("li",{className:"text-sm text-slate-700 flex gap-2",children:[e.jsx("span",{className:"text-slate-400",children:"â€¢"}),e.jsx("span",{children:f})]},r))})]}),l.keywords_to_use&&l.keywords_to_use.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mb-4",children:l.keywords_to_use.map((f,r)=>e.jsx("span",{className:"px-2 py-0.5 bg-slate-200 text-slate-700 text-xs rounded",children:f},r))}),e.jsxs("div",{className:"flex gap-2 mt-4 pt-3 border-t border-slate-200",children:[e.jsx("button",{onClick:()=>{if(l){const f={job_title:g.title,company:g.company,score:l.score,match_level:l.match_level,pitch:l.pitch,talking_points:l.talking_points,strengths:l.strengths,gaps:l.gaps,keywords:l.keywords_to_use};localStorage.setItem("scout_fit_context",JSON.stringify(f)),console.log("[Scout] Stored fit context for email generation:",f)}Y(g)},className:"flex-1 py-2 text-sm font-medium text-white rounded",style:{background:"linear-gradient(135deg, #3B82F6, #60A5FA)"},children:"Find Contacts in This Role"}),e.jsx("button",{onClick:()=>k(null),className:"px-4 py-2 text-sm text-slate-600 hover:bg-slate-100 rounded",children:"Collapse"})]})]})]},j)})]})]})},a.id)}),e.jsx("div",{ref:H}),E&&e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:"bg-slate-100 border border-slate-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center gap-2 text-slate-600",children:[e.jsx(se,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{className:"text-sm",children:"Scout is thinking..."})]})})})]})]}),e.jsx("div",{className:"px-6 py-4 border-t border-[#E3E8F0] bg-white",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(Ye,{ref:c,value:D,onChange:a=>M(a.target.value),onKeyPress:O,placeholder:"Paste a job URL or describe what you're looking for...",className:"flex-1 bg-white border-[#E3E8F0] text-slate-900 placeholder:text-slate-400 focus:border-blue-500 focus-visible:ring-2 focus-visible:ring-blue-500/20 rounded-md text-base py-3",disabled:E}),e.jsx(fe,{onClick:R,disabled:!D.trim()||E,className:"hover:opacity-90 rounded-md px-5 py-3",style:{background:"linear-gradient(135deg, #3B82F6, #60A5FA)"},children:E?e.jsx(se,{className:"h-5 w-5 animate-spin"}):e.jsx(qe,{className:"h-5 w-5"})})]})})]})]})},ut=({onJobTitleSuggestion:s})=>{const{user:o}=be(),[b,u]=x.useState(!1),[i,h]=x.useState({x:0,y:0}),[m,B]=x.useState({width:700,height:900}),[K,J]=x.useState(null);x.useEffect(()=>{b&&!c.current?(h({x:Math.max(16,window.innerWidth-m.width-16),y:16}),c.current=!0):b||(c.current=!1)},[b]),x.useEffect(()=>{const t=()=>{if(b){const n=window.innerWidth-m.width,p=window.innerHeight-m.height;h(v=>({x:Math.max(0,Math.min(v.x,n)),y:Math.max(0,Math.min(v.y,p))}))}};return window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[b,m]);const[F,S]=x.useState(!1),[D,M]=x.useState(!1),[E,V]=x.useState({x:0,y:0}),[z,G]=x.useState({x:0,y:0,width:0,height:0,posX:0,posY:0}),H=x.useRef(null),c=x.useRef(!1);x.useEffect(()=>{(async()=>{if(o!=null&&o.uid)try{const n=ie(ae,"users",o.uid),p=await Re(n);if(p.exists()){const v=p.data(),P={};v.resumeParsed&&Object.assign(P,v.resumeParsed),v.resumeText&&(P.rawText=v.resumeText),J(P)}}catch(n){console.error("[ScoutHeaderButton] Failed to load resume:",n)}})()},[o==null?void 0:o.uid]),x.useEffect(()=>{const t=`
      @keyframes wave {
        0%, 100% { transform: rotate(-8deg); }
        50% { transform: rotate(8deg); }
      }
      @keyframes ping-soft {
        0% { transform: scale(1); opacity: 1; }
        50% { transform: scale(1.25); opacity: 0.4; }
        100% { transform: scale(1); opacity: 1; }
      }
    `,n=document.createElement("style");return n.textContent=t,document.head.appendChild(n),()=>{document.head.contains(n)&&document.head.removeChild(n)}},[]);const y=t=>{if(H.current){S(!0);const n=H.current.getBoundingClientRect();V({x:t.clientX-n.left,y:t.clientY-n.top}),t.preventDefault()}},I=t=>{if(t.stopPropagation(),t.preventDefault(),H.current){M(!0);const n=H.current.getBoundingClientRect();G({x:t.clientX,y:t.clientY,width:n.width,height:n.height,posX:i.x,posY:i.y})}};return x.useEffect(()=>{const t=p=>{if(F){const v=p.clientX-E.x,P=p.clientY-E.y,k=window.innerWidth-m.width,A=window.innerHeight-m.height;h({x:Math.max(0,Math.min(v,k)),y:Math.max(0,Math.min(P,A))})}else if(D){const v=p.clientX-z.x,P=p.clientY-z.y,k=500,A=600,q=z.width-v,Q=z.height-P,U=z.posX+v,R=z.posY+P,O=window.innerWidth-U,Y=window.innerHeight-R,Z=Math.max(k,Math.min(q,O)),W=Math.max(A,Math.min(Q,Y)),ee=z.posX+(z.width-Z),ne=z.posY+(z.height-W);B({width:Z,height:W}),h({x:Math.max(0,ee),y:Math.max(0,ne)})}},n=()=>{S(!1),M(!1)};return(F||D)&&(document.addEventListener("mousemove",t),document.addEventListener("mouseup",n)),()=>{document.removeEventListener("mousemove",t),document.removeEventListener("mouseup",n)}},[F,D,E,z,m,i]),e.jsxs(e.Fragment,{children:[b&&e.jsxs("div",{ref:H,className:"fixed z-40 flex flex-col rounded-2xl border border-[#E3E8F0] bg-white shadow-lg overflow-hidden",style:{left:`${i.x}px`,top:`${i.y}px`,width:`${m.width}px`,height:`${m.height}px`,cursor:F?"grabbing":"default",userSelect:F||D?"none":"auto"},children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-[#E3E8F0] bg-white cursor-grab active:cursor-grabbing select-none",onMouseDown:y,children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center overflow-hidden",style:{backgroundColor:"#fff6e2"},children:e.jsx("img",{src:"/scout-mascot.png",alt:"Scout AI",className:"w-6 h-6 object-contain"})}),e.jsx("div",{children:e.jsx("h3",{className:"text-sm font-semibold text-slate-900",children:"Scout AI"})})]}),e.jsx("button",{onClick:()=>u(!1),className:"text-xs text-slate-500 hover:text-slate-700 transition-colors",children:"Close"})]}),e.jsx("div",{className:"flex-1 min-h-0 overflow-hidden",children:e.jsx(xt,{onJobTitleSuggestion:s,userResume:K||void 0})}),e.jsx("div",{className:"absolute top-0 left-0 w-6 h-6 cursor-nwse-resize z-10",onMouseDown:I,style:{background:"linear-gradient(to bottom right, transparent 0%, transparent 40%, #E3E8F0 40%, #E3E8F0 45%, transparent 45%, transparent 100%)"},children:e.jsx("div",{className:"absolute top-1 left-1 w-3 h-3 border-l-2 border-t-2 border-slate-400"})})]}),e.jsxs("button",{onClick:()=>u(!0),className:"inline-flex items-center gap-2 rounded-full border px-3 py-1.5 bg-[#ECF4FF] border-[#C7D8FF] text-sm font-medium text-[#111827] shadow-sm hover:shadow-md hover:scale-105 hover:bg-gradient-to-r hover:from-[#ECF4FF] hover:to-white cursor-pointer transition-all duration-150",children:[e.jsxs("div",{className:"relative flex items-center justify-center h-6 w-6 rounded-full bg-[#FFF7EA] flex-shrink-0",children:[e.jsx("img",{src:"/scout-mascot.png",alt:"Scout AI",className:"w-4 h-4 object-contain",style:{animation:"wave 2.5s ease-in-out infinite",transformOrigin:"center bottom"}}),e.jsx("span",{className:"absolute -top-0.5 -right-0.5 h-2.5 w-2.5 rounded-full bg-[#3B82F6]",style:{animation:"ping-soft 1.2s ease-in-out infinite"}})]}),e.jsx("span",{className:"whitespace-nowrap hidden sm:inline",children:"Ask Scout"})]})]})};function bt({onJobTitleSuggestion:s}){const o=Ge(),b=()=>{o("/home?tab=outbox")};return e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 flex-shrink-0",children:[e.jsx(fe,{variant:"ghost",size:"icon",onClick:b,className:"h-9 w-9 hover:bg-blue-100 hover:text-blue-600 flex-shrink-0","aria-label":"View outbox",children:e.jsx(He,{className:"h-5 w-5"})}),e.jsx(fe,{variant:"ghost",size:"icon",onClick:()=>o("/home?tab=calendar"),className:"h-9 w-9 hover:bg-blue-100 hover:text-blue-600 flex-shrink-0","aria-label":"View calendar",children:e.jsx(Xe,{className:"h-5 w-5"})}),e.jsx(ut,{onJobTitleSuggestion:s})]})}export{bt as P};
