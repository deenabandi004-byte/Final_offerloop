import{u as ge,r,j as e,J as U,K as je,O as B,a0 as ae,aC as D,aB as be,F as ye,W as Ne,Y as we,$ as Ce,a1 as ve,aD as Pe}from"./vendor-react-Bye97upB.js";import{a as De,B as S,f as Se,t as l}from"./index-DlXH6OO2.js";import{S as ke,A as Ee,a as Fe}from"./AppSidebar-BDehlPBm.js";import{C as se,a as Le,b as _e,c as re}from"./card-Oe13TMu0.js";import{I as Te}from"./input-BsyuEDo1.js";import{T as Ie,a as Re,b as oe,c as ne}from"./tabs-BKIyP4W7.js";import{B as Ae}from"./badge-2lG78ATG.js";import{u as Ue,g as Be,c as Ge,a as Me,B as qe,U as He}from"./featureAccess-DbHtdx9x.js";import{a as u}from"./api-Cs6ol7d5.js";import{C as p}from"./constants-BVoUACx7.js";import{d as Ye,l as ze}from"./activityLogger-DokJbVCc.js";import{P as Oe}from"./PageHeaderActions-Ci5Om_Q5.js";import{d as $e,a as G,t as M}from"./analytics-BfdMicsw.js";const it=()=>{var K,X,V,W,J,Q;ge();const{user:f,checkCredits:k}=De(),{subscription:c}=Ue(),g=f||{credits:0,tier:"free"},E=(c==null?void 0:c.coffeeChatPrepsUsed)||0,q=(c==null?void 0:c.tier)||g.tier||"free",ie=Be(q,"coffeeChatPreps"),F=c?Ge(c.tier,"coffeeChatPreps",E):g.tier==="elite",L=(g.credits??0)>=p,_=F&&L;c&&Me(c.tier,"coffeeChatPreps",E);const[j,ce]=r.useState(""),[y,T]=r.useState(!1),[le,N]=r.useState(""),[w,H]=r.useState(null),[o,Y]=r.useState(null),[x,I]=r.useState("idle"),[Ke,z]=r.useState(0),R=r.useRef(null),[C,A]=r.useState([]),[de,me]=r.useState(!0),[O,$]=r.useState(null);r.useEffect(()=>()=>{R.current&&(clearTimeout(R.current),R.current=null)},[]),r.useEffect(()=>{(async()=>{try{const a=await u.getAllCoffeeChatPreps();if("error"in a)throw new Error(a.error);A(a.preps||[])}catch(a){console.error("Failed to load coffee chat preps:",a),l({title:"Unable to load library",description:a instanceof Error?a.message:"Please try again.",variant:"destructive"})}finally{me(!1)}})()},[]),r.useEffect(()=>{x==="completed"&&w&&(async()=>{try{const a=await u.getAllCoffeeChatPreps();if("error"in a)return;A(a.preps||[])}catch{}})()},[x,w]);const fe=async()=>{if(!j.trim()){l({title:"Missing LinkedIn URL",description:"Please enter a LinkedIn profile URL.",variant:"destructive"});return}if(!f){l({title:"Authentication Required",description:"Please sign in to continue.",variant:"destructive"});return}if((g.credits??0)<p){l({title:"Insufficient Credits",description:`You need ${p} credits to generate a coffee chat prep.`,variant:"destructive"});return}T(!0),I("processing"),N("Starting Coffee Chat Prep..."),Y(null),z(t=>t+1);try{const t=await u.createCoffeeChatPrep({linkedinUrl:j});if("error"in t)throw new Error(t.error);const a=t.prepId;H(a);let n=0;const v=200;await new Promise((Z,s)=>{const d=setInterval(async()=>{n++;try{const i=await u.getCoffeeChatPrepStatus(a);if("error"in i&&!("status"in i)){clearInterval(d),s(new Error(i.error));return}if(i.pdfUrl){if(clearInterval(d),f!=null&&f.uid&&i.contactData)try{const m=i.contactData,ee=m.name||`${m.firstName||""} ${m.lastName||""}`.trim()||"",te=m.company||m.companyName||"",pe=Ye({contactName:ee||void 0,company:te||void 0});await ze(f.uid,"coffeePrep",pe,{prepId:a,linkedinUrl:j,contactName:ee||"",company:te||""})}catch(m){console.error("Failed to log coffee chat prep activity:",m)}Pe.flushSync(()=>{T(!1),I("completed"),N("Coffee Chat Prep ready!"),Y(i),H(i.id||a),z(m=>m+1)});const P=i.contactData||{};$e("coffee_chat_prep","generate",!0,{company:P.company||P.companyName||"",role:P.jobTitle||P.title||void 0}),l({title:"Coffee Chat Prep Ready!",description:"Your one-pager has been generated successfully.",duration:5e3}),k==null||k(),Z(i);return}"status"in i&&N("Processing your request..."),n>=v&&(clearInterval(d),s(new Error("Generation timed out")))}catch(i){clearInterval(d),s(i)}},3e3)})}catch(t){console.error("Coffee chat prep failed:",t),I("failed"),N("Generation failed"),G("coffee_chat_prep","generate","api_error",t.message),l({title:"Generation Failed",description:t.message||"Please try again.",variant:"destructive"})}finally{T(!1)}},xe=async t=>{const a=w;if(!(!a||!f))try{let h;l({title:"Preparing PDF",description:"Please wait while we prepare your Coffee Chat PDF...",duration:3e3});for(let s=0;s<20;s++){try{const d=await u.downloadCoffeeChatPDF(a);if(h=(d==null?void 0:d.pdfUrl)||void 0,h&&(await fetch(h,{method:"HEAD"})).ok)break}catch{}await new Promise(d=>setTimeout(d,1e3))}if(!h)throw new Error("PDF isn't ready yet. Please try again in a moment.");if(await new Promise(s=>setTimeout(s,500)),!window.open(h,"_blank","noopener,noreferrer")){const s=document.createElement("a");s.href=h,s.target="_blank",s.rel="noopener noreferrer",s.style.display="none",document.body.appendChild(s),s.click(),document.body.removeChild(s)}M("coffee_chat_prep","pdf"),l({title:"PDF Ready",description:"Opened your Coffee Chat one-pager in a new tab."})}catch(n){G("coffee_chat_prep","download","network_error",n instanceof Error?n.message:void 0),l({title:"Download Failed",description:n instanceof Error?n.message:"Could not download the PDF.",variant:"destructive"})}},he=async t=>{try{if(t.pdfUrl){window.open(t.pdfUrl,"_blank","noopener"),M("coffee_chat_prep","pdf",t.id);return}const{pdfUrl:a}=await u.downloadCoffeeChatPDF(t.id);if(a)window.open(a,"_blank","noopener"),M("coffee_chat_prep","pdf",t.id);else throw new Error("PDF URL not available yet")}catch(a){G("coffee_chat_prep","download","network_error",a instanceof Error?a.message:void 0),l({title:"Download failed",description:"Could not open the PDF. Please try again.",variant:"destructive"})}},ue=async t=>{$(t);try{const a=await u.deleteCoffeeChatPrep(t);if("error"in a)throw new Error(a.error);A(n=>n.filter(v=>v.id!==t)),l({title:"Prep deleted",description:"Removed from your Coffee Chat Library."})}catch(a){l({title:"Delete failed",description:a instanceof Error?a.message:"Please try again.",variant:"destructive"})}finally{$(null)}},b=r.useMemo(()=>{const t=C.filter(n=>n.status==="completed"),a=C.filter(n=>n.status!=="completed");return{completed:t,inProgress:a}},[C]);return e.jsx(ke,{children:e.jsxs("div",{className:"flex min-h-screen w-full bg-transparent text-foreground",children:[e.jsx(Ee,{}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("header",{className:"h-16 flex items-center justify-between border-b border-gray-100/30 px-6 bg-transparent shadow-sm relative z-20",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Fe,{className:"text-foreground hover:bg-secondary"}),e.jsx("h1",{className:"text-xl font-semibold",children:"Coffee Chat Prep"})]}),e.jsx(Oe,{})]}),e.jsx("main",{className:"p-8 bg-transparent",children:e.jsx("div",{className:"max-w-5xl mx-auto",children:e.jsxs(Ie,{defaultValue:"coffee-chat-prep",className:"w-full",children:[e.jsx("div",{className:"flex justify-center mb-8",children:e.jsxs(Re,{className:"h-14 tabs-container-gradient border border-border grid grid-cols-2 max-w-lg w-full rounded-xl p-1 bg-white",children:[e.jsxs(oe,{value:"coffee-chat-prep",className:"h-12 font-medium text-base data-[state=active] data-[state=active]:text-white data-[state=inactive]:text-muted-foreground transition-all",children:[e.jsx(U,{className:"h-5 w-5 mr-2"}),"Coffee Chat Prep"]}),e.jsxs(oe,{value:"coffee-library",className:"h-12 font-medium text-base data-[state=active] data-[state=active]:text-white data-[state=inactive]:text-muted-foreground transition-all",children:[e.jsx(je,{className:"h-5 w-5 mr-2"}),"Coffee Library"]})]})}),e.jsx(ne,{value:"coffee-chat-prep",className:"mt-6",children:e.jsxs(se,{className:"bg-white border-border rounded-2xl",children:[e.jsx(Le,{className:"border-b border-border",children:e.jsxs(_e,{className:"text-xl text-foreground flex items-center gap-2",children:["Coffee Chat Prep",e.jsx(qe,{size:"xs",variant:"glow"}),e.jsxs(Ae,{variant:"secondary",className:"ml-auto",children:[p," credits"]})]})}),e.jsxs(re,{className:"p-6 space-y-8",children:[!_&&e.jsx(He,{hasExhaustedLimit:!F,hasEnoughCredits:L,currentUsage:E,limit:ie,tier:q,requiredCredits:p,currentCredits:g.credits??0,featureName:"Coffee Chat Preps",nextTier:(c==null?void 0:c.tier)==="free"?"Pro":"Elite",showUpgradeButton:!F||!L}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-foreground",children:"LinkedIn Profile URL"}),e.jsx(Te,{value:j,onChange:t=>ce(t.target.value),placeholder:"https://linkedin.com/in/username",className:"bg-white border-input text-foreground placeholder:text-muted-foreground",disabled:y||!_}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Uses ",p," credits. Generates a PDF with recent division news, talking points, and similarities."]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx(S,{onClick:fe,disabled:y||!j.trim()||(g.credits??0)<p||!_,className:"",children:y?e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"h-4 w-4 mr-2 animate-spin"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Generate Prep"]})}),x==="completed"&&(w||o)&&e.jsxs(S,{variant:"outline",onClick:()=>xe(),className:"border-green-500/60 text-green-300 hover:bg-green-500/10",children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Download PDF"]})]}),x!=="idle"&&e.jsx("div",{className:"rounded-lg border border-border bg-muted/50 p-4 shadow-inner text-sm text-foreground",children:e.jsxs("div",{className:"flex items-center gap-2",children:[y?e.jsx(B,{className:"h-4 w-4 animate-spin text-primary"}):x==="completed"?e.jsx(D,{className:"h-4 w-4 text-blue-600"}):x==="failed"?e.jsx(be,{className:"h-4 w-4 text-destructive"}):e.jsx(ye,{className:"h-4 w-4 text-primary"}),e.jsx("span",{children:le})]})})]}),e.jsx("div",{className:"space-y-4",children:x==="completed"&&o?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"rounded-xl border border-green-500/40 bg-green-500/10 p-5 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-semibold text-green-700 uppercase tracking-wide",children:"Contact Snapshot"}),e.jsx("span",{className:"text-xs text-blue-600/80",children:"Ready for coffee chat"})]}),e.jsxs("div",{className:"space-y-1 text-sm text-foreground",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Name:"})," ",(K=o.contactData)==null?void 0:K.firstName," ",(X=o.contactData)==null?void 0:X.lastName]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Role:"})," ",(V=o.contactData)==null?void 0:V.jobTitle]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Company:"})," ",(W=o.contactData)==null?void 0:W.company]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Office:"})," ",((J=o.contactData)==null?void 0:J.location)||((Q=o.context)==null?void 0:Q.office)]}),o.hometown&&e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Hometown:"})," ",o.hometown]})]})]}),o.similaritySummary&&e.jsxs("div",{className:"rounded-xl border border-blue-500/40 bg-blue-500/10 p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-blue-700 uppercase tracking-wide mb-2",children:"Common Ground"}),e.jsx("p",{className:"text-sm text-foreground leading-relaxed",children:o.similaritySummary})]}),o.industrySummary&&e.jsxs("div",{className:"rounded-xl border border-purple-500/40 bg-purple-500/10 p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-purple-700 uppercase tracking-wide mb-2",children:"Industry Pulse"}),e.jsx("p",{className:"text-sm text-foreground leading-relaxed",children:o.industrySummary})]})]}):e.jsxs("div",{className:"rounded-xl border border-border bg-muted/30 p-5 text-sm text-foreground space-y-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-foreground uppercase tracking-wide",children:"What you'll receive"}),e.jsxs("ul",{className:"space-y-2 text-foreground",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(D,{className:"h-4 w-4 text-blue-600 mt-0.5"}),"Curated headlines tied to the division and office"]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(D,{className:"h-4 w-4 text-blue-600 mt-0.5"}),"40-second similarity summary & coffee chat questions"]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(D,{className:"h-4 w-4 text-blue-600 mt-0.5"}),"PDF saved to your Coffee Chat Library"]})]})]})})]})]})]})}),e.jsx(ne,{value:"coffee-library",className:"mt-6",children:e.jsx("div",{className:"space-y-6",children:de?e.jsx(se,{className:"bg-white border-border",children:e.jsx(re,{className:"p-6",children:e.jsx(Se,{variant:"card",count:3})})}):C.length===0?e.jsxs("div",{className:"rounded-xl border border-border bg-white p-10 text-center space-y-4",children:[e.jsx(U,{className:"h-10 w-10 mx-auto text-primary"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"No preps yet"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Generate your first coffee chat prep to see it appear here."})]}):e.jsxs("div",{className:"space-y-6",children:[b.inProgress.length>0&&e.jsxs("section",{children:[e.jsx("h3",{className:"text-sm font-semibold text-muted-foreground uppercase mb-3",children:"In Progress"}),e.jsx("div",{className:"grid gap-4",children:b.inProgress.map(t=>e.jsxs("div",{className:"rounded-lg border border-yellow-500/40 bg-yellow-500/10 px-5 py-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-foreground font-medium",children:t.contactName}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[t.jobTitle," @ ",t.company]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Requested ",t.createdAt?new Date(t.createdAt).toLocaleString():""]})]}),e.jsx("div",{className:"text-xs uppercase text-yellow-600",children:"Processing..."})]},t.id))})]}),b.completed.length>0&&e.jsxs("section",{className:"space-y-3",children:[e.jsxs("h3",{className:"text-sm font-semibold text-muted-foreground uppercase",children:["Completed (",b.completed.length,")"]}),e.jsx("div",{className:"grid gap-4",children:b.completed.map(t=>e.jsxs("div",{className:"rounded-xl border border-border bg-white p-5 flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-foreground font-medium",children:[e.jsx(Ne,{className:"h-4 w-4 text-blue-600"}),t.contactName]}),e.jsxs("div",{className:"text-sm text-foreground",children:[t.jobTitle," @ ",t.company]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(we,{className:"h-3 w-3"}),t.createdAt?new Date(t.createdAt).toLocaleDateString():"â€”"]}),t.hometown&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ce,{className:"h-3 w-3"}),t.hometown]})]}),t.industrySummary&&e.jsx("p",{className:"text-xs text-muted-foreground",children:t.industrySummary})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(S,{size:"sm",variant:"outline",className:"border-primary text-primary hover:bg-primary/10",onClick:()=>he(t),children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"PDF"]}),e.jsx(S,{size:"sm",variant:"ghost",className:"text-destructive hover:text-destructive/80",disabled:O===t.id,onClick:()=>ue(t.id),children:O===t.id?e.jsx(B,{className:"h-4 w-4 animate-spin"}):e.jsx(ve,{className:"h-4 w-4"})})]})]},t.id))})]})]})})})]})})})]})]})})};export{it as default};
