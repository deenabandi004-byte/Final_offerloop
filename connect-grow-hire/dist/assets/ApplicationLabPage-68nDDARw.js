const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DlXH6OO2.js","assets/vendor-react-Bye97upB.js","assets/vendor-utils-B2rm_Apj.js","assets/vendor-dates-CPvpAlHY.js","assets/vendor-firebase-Bz1e_Tmy.js","assets/vendor-animations-CH_iu5NA.js","assets/index-BSrx6Tbf.css"])))=>i.map(i=>d[i]);
import{b as O,u as ae,B as A,a as ne,_ as B}from"./index-DlXH6OO2.js";import{r as p,j as e,aA as Y,b2 as K,aH as M,aM as ie,aN as le,O as U,a0 as oe,K as X,b3 as ce,l as Z,b4 as ee,u as de,ay as me,as as V}from"./vendor-react-Bye97upB.js";import{I as ue}from"./input-BsyuEDo1.js";import{T as xe}from"./textarea-DJfZuYne.js";import{C as W,a as te,b as se,c as H}from"./card-Oe13TMu0.js";import{S as pe,A as ge,a as he}from"./AppSidebar-BDehlPBm.js";import{P as be}from"./PageHeaderActions-Ci5Om_Q5.js";const $=window.location.hostname==="localhost"?"http://localhost:5001":"https://www.offerloop.ai";async function re(s,u){const b=O.currentUser,l=b?await b.getIdToken():null,o={"Content-Type":"application/json"};l&&(o.Authorization=`Bearer ${l}`);const c=new AbortController,d=setTimeout(()=>c.abort(),15e4);try{const n=await fetch(`${$}/api/application-lab/analyze`,{method:"POST",headers:o,body:JSON.stringify({job:s,user_resume:u}),signal:c.signal});if(clearTimeout(d),!n.ok){const f=await n.text();try{return{status:"error",message:JSON.parse(f).message||"Analysis failed"}}catch{return{status:"error",message:f||`HTTP ${n.status}`}}}return await n.json()}catch(n){if(clearTimeout(d),n.name==="AbortError")return{status:"error",message:"Request timed out. Please try again."};throw n}}async function fe(s){const u=O.currentUser,b=u?await u.getIdToken():null,l={};b&&(l.Authorization=`Bearer ${b}`);const o=new AbortController,c=setTimeout(()=>o.abort(),3e4);try{const d=await fetch(`${$}/api/application-lab/analysis/${s}`,{method:"GET",headers:l,signal:o.signal});if(clearTimeout(c),!d.ok){const n=await d.text();try{return{status:"error",message:JSON.parse(n).message||"Failed to retrieve analysis"}}catch{return{status:"error",message:n||`HTTP ${d.status}`}}}return await d.json()}catch(d){if(clearTimeout(c),d.name==="AbortError")return{status:"error",message:"Request timed out. Please try again."};throw d}}async function je(s,u,b,l){const o=O.currentUser,c=o?await o.getIdToken():null,d={"Content-Type":"application/json"};c&&(d.Authorization=`Bearer ${c}`);const n=new AbortController,f=setTimeout(()=>n.abort(),3e4);try{const x=await fetch(`${$}/api/application-lab/generate-cover-letter`,{method:"POST",headers:d,body:JSON.stringify({job:s,user_resume:u,fit_analysis:b,options:l||{}}),signal:n.signal});if(clearTimeout(f),!x.ok){const w=await x.text();try{return{status:"error",message:JSON.parse(w).message||"Cover letter generation failed"}}catch{return{status:"error",message:w||`HTTP ${x.status}`}}}return await x.json()}catch(x){if(clearTimeout(f),x.name==="AbortError")return{status:"error",message:"Request timed out. Please try again."};throw x}}async function ye(s,u,b="plain"){const l=O.currentUser,o=l?await l.getIdToken():null,c={"Content-Type":"application/json"};o&&(c.Authorization=`Bearer ${o}`);const d=new AbortController,n=setTimeout(()=>d.abort(),3e4);try{const f=await fetch(`${$}/api/application-lab/generate-edited-resume`,{method:"POST",headers:c,body:JSON.stringify({user_resume:s,resume_edits:u,format:b}),signal:d.signal});if(clearTimeout(n),!f.ok){const x=await f.text();try{return{status:"error",message:JSON.parse(x).message||"Resume generation failed"}}catch{return{status:"error",message:x||`HTTP ${f.status}`}}}return await f.json()}catch(f){if(clearTimeout(n),f.name==="AbortError")return{status:"error",message:"Request timed out. Please try again."};throw f}}async function Ne(){const s=O.currentUser,u=s?await s.getIdToken():null,b={"Content-Type":"application/json"};u&&(b.Authorization=`Bearer ${u}`);const l=new AbortController,o=setTimeout(()=>l.abort(),3e4);try{const c=await fetch(`${$}/api/application-lab/repair-resume`,{method:"POST",headers:b,signal:l.signal});if(clearTimeout(o),!c.ok){const d=await c.text();try{return{status:"error",message:JSON.parse(d).message||"Resume repair failed"}}catch{return{status:"error",message:d||`HTTP ${c.status}`}}}return await c.json()}catch(c){if(clearTimeout(o),c.name==="AbortError")return{status:"error",message:"Request timed out. Please try again."};throw c}}const ve=({analysis:s,job:u,userResume:b,onCoverLetterGenerated:l})=>{var G;const{toast:o}=ae(),[c,d]=p.useState("overview"),[n,f]=p.useState(new Set),[x,w]=p.useState(null),[_,R]=p.useState(null),[P,m]=p.useState(!1),[S,L]=p.useState(!1),[T,z]=p.useState(s.cover_letter),j=p.useRef(null);p.useEffect(()=>()=>{j.current&&(clearTimeout(j.current),j.current=null)},[]);const k=async(t,a)=>{await navigator.clipboard.writeText(t),w(a),j.current&&clearTimeout(j.current),j.current=setTimeout(()=>{w(null),j.current=null},2e3)},Q=t=>{const a=new Set(n);a.has(t)?a.delete(t):a.add(t),f(a)},E=t=>{switch(t){case"strong":return e.jsx(Y,{className:"text-green-500",size:16});case"partial":return e.jsx(K,{className:"text-yellow-500 fill-yellow-200",size:16});case"weak":return e.jsx(K,{className:"text-orange-400",size:16});default:return e.jsx(M,{className:"text-red-400",size:16})}},q=t=>{switch(t){case"high":return"bg-red-100 text-red-700 border-red-200";case"medium":return"bg-yellow-100 text-yellow-700 border-yellow-200";default:return"bg-gray-100 text-gray-600 border-gray-200"}},J=async()=>{if(!b){console.error("[ApplicationLab] Resume data not available for cover letter generation"),o({title:"Resume Required",description:"Please upload your resume to generate a cover letter.",variant:"destructive"});return}L(!0);try{const t=await je(u,b,s);if(t.status==="ok"&&t.cover_letter)z(t.cover_letter),l&&l(t.cover_letter),o({title:"Cover Letter Generated",description:"Your personalized cover letter is ready!"});else{const a=t.message||"Failed to generate cover letter";console.error("[ApplicationLab] Cover letter generation failed:",a),o({title:"Generation Failed",description:"We couldn't generate your cover letter. Please try again.",variant:"destructive"})}}catch(t){console.error("[ApplicationLab] Cover letter generation error:",t),o({title:"Something Went Wrong",description:"An unexpected error occurred. Please try again in a moment.",variant:"destructive"})}finally{L(!1)}},F=async t=>{if(!b){console.error("[ApplicationLab] Resume data not available for edited resume generation"),o({title:"Resume Required",description:"Please upload your resume to generate an edited version.",variant:"destructive"});return}m(!0);let a=null;try{const r=await ye(b,s.resume_edits,t);if(r.status==="ok"&&r.edited_resume){if(t==="pdf"&&r.edited_resume.pdf_base64){const i=Uint8Array.from(atob(r.edited_resume.pdf_base64),v=>v.charCodeAt(0)),y=new Blob([i],{type:"application/pdf"});a=URL.createObjectURL(y);const g=document.createElement("a");g.href=a;const N=v=>v.replace(/[^a-z0-9-]/gi,"-").replace(/-+/g,"-").toLowerCase();g.download=`resume-${N(u.company||"company")}-${N(u.title||"position")}.pdf`,g.click(),URL.revokeObjectURL(a),a=null,r.edited_resume.formatted_text&&R(r.edited_resume.formatted_text),o({title:"Resume Downloaded",description:"Your edited resume has been downloaded as PDF."})}else if(r.edited_resume.formatted_text){R(r.edited_resume.formatted_text);const i=new Blob([r.edited_resume.formatted_text],{type:"text/plain"});a=URL.createObjectURL(i);const y=document.createElement("a");y.href=a;const g=N=>N.replace(/[^a-z0-9-]/gi,"-").replace(/-+/g,"-").toLowerCase();y.download=`resume-${g(u.company||"company")}-${g(u.title||"position")}.txt`,y.click(),URL.revokeObjectURL(a),a=null,o({title:"Resume Downloaded",description:"Your edited resume has been downloaded as text file."})}}else{const i=r.message||"Failed to generate edited resume";console.error("[ApplicationLab] Edited resume generation failed:",i),o({title:"Generation Failed",description:"We couldn't generate your edited resume. Please try again.",variant:"destructive"})}}catch(r){console.error("[ApplicationLab] Resume generation error:",r),o({title:"Something Went Wrong",description:"An unexpected error occurred. Please try again in a moment.",variant:"destructive"})}finally{a&&URL.revokeObjectURL(a),m(!1)}},I=s.job_requirements;return e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 p-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-gray-900",children:["Application Analysis: ",u.title]}),e.jsx("p",{className:"text-sm text-gray-600",children:u.company})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:`text-3xl font-bold ${s.score>=80?"text-green-600":s.score>=60?"text-blue-600":s.score>=40?"text-yellow-600":"text-red-600"}`,children:[s.score,"%"]}),e.jsxs("div",{className:"text-sm text-gray-500 capitalize",children:[s.match_level," match"]})]})]}),e.jsxs("div",{className:"flex gap-4 mt-3 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Y,{size:14,className:"text-green-500"}),e.jsxs("span",{children:[s.requirements_summary.matched," matched"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(K,{size:14,className:"text-yellow-500 fill-yellow-200"}),e.jsxs("span",{children:[s.requirements_summary.partial," partial"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(M,{size:14,className:"text-red-400"}),e.jsxs("span",{children:[s.requirements_summary.missing," missing"]})]})]})]}),e.jsx("div",{className:"flex border-b border-gray-200",children:[{id:"overview",label:"Overview"},{id:"requirements",label:`Requirements (${((G=s.job_requirements)==null?void 0:G.length)||0})`},{id:"edits",label:`Resume Edits (${s.resume_edits.length})`},{id:"cover_letter",label:"Cover Letter"}].map(t=>e.jsx("button",{onClick:()=>d(t.id),className:`flex-1 px-4 py-2 text-sm font-medium transition-colors relative ${c===t.id?"border-b-2 border-blue-600 text-blue-600 bg-blue-50":"text-gray-600 hover:bg-gray-50"}`,children:t.label},t.id))}),e.jsxs("div",{className:"p-4 max-h-[600px] overflow-y-auto",children:[c==="overview"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-1",children:"Your Pitch"}),e.jsx("p",{className:"text-blue-800 text-sm",children:s.pitch})]}),s.strengths.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-green-700 mb-2 flex items-center gap-1",children:[e.jsx(Y,{size:16})," Strengths"]}),e.jsx("ul",{className:"space-y-2",children:s.strengths.map((t,a)=>e.jsxs("li",{className:"bg-green-50 rounded p-2 text-sm",children:[e.jsx("span",{className:"font-medium text-green-800",children:t.point}),t.evidence&&e.jsxs("span",{className:"text-green-600",children:[" — ",t.evidence]})]},a))})]}),s.gaps.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-orange-700 mb-2 flex items-center gap-1",children:[e.jsx(M,{size:16})," Gaps to Address"]}),e.jsx("ul",{className:"space-y-2",children:s.gaps.map((t,a)=>e.jsxs("li",{className:"bg-orange-50 rounded p-2 text-sm",children:[e.jsx("span",{className:"font-medium text-orange-800",children:t.gap}),t.mitigation&&e.jsxs("span",{className:"text-orange-600 block mt-1",children:["→ ",t.mitigation]})]},a))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-700 mb-2",children:"Keywords to Use"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.keywords_to_use.map((t,a)=>e.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-700 rounded text-sm",children:t},a))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-700 mb-2",children:"Talking Points"}),e.jsx("ul",{className:"space-y-3",children:s.talking_points.map((t,a)=>e.jsxs("li",{className:"text-sm text-gray-700 border border-gray-200 rounded-lg p-3 bg-gray-50",children:[e.jsx("div",{className:"font-medium text-gray-900 mb-1",children:t.topic}),e.jsx("div",{className:"text-gray-600 mb-2",children:t.angle}),e.jsxs("div",{className:"text-gray-700 mb-2",children:[e.jsx("span",{className:"font-medium",children:"Example (STAR):"})," ",t.example]}),e.jsxs("div",{className:"text-blue-600 text-xs",children:[e.jsx("span",{className:"font-medium",children:"Potential question:"})," ",t.potential_question]})]},a))})]}),s.potential_score_after_edits>s.score&&e.jsx("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg p-3 border border-green-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-green-800",children:"Potential score after edits:"}),e.jsxs("span",{className:"text-xl font-bold text-green-600",children:[s.potential_score_after_edits,"%",e.jsxs("span",{className:"text-sm font-normal text-green-500 ml-1",children:["(+",s.potential_score_after_edits-s.score,")"]})]})]})})]}),c==="requirements"&&e.jsx("div",{className:"space-y-2",children:I&&I.length>0?e.jsx(e.Fragment,{children:I.map((t,a)=>e.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>Q(a),className:"w-full flex items-center gap-3 p-3 hover:bg-gray-50 text-left",children:[E(t.match_strength),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:t.requirement}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[e.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded ${t.requirement_type==="required"?"bg-red-100 text-red-700":t.requirement_type==="preferred"?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-600"}`,children:t.requirement_type}),e.jsxs("span",{className:"text-xs text-gray-500",children:[t.importance," priority"]})]})]}),n.has(a)?e.jsx(ie,{size:16,className:"text-gray-400"}):e.jsx(le,{size:16,className:"text-gray-400"})]}),n.has(a)&&e.jsxs("div",{className:"px-3 pb-3 border-t border-gray-100 bg-gray-50",children:[e.jsx("p",{className:"text-sm text-gray-600 mt-2 mb-2",children:t.explanation}),t.resume_matches.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 mb-1",children:"Matching Resume Content:"}),t.resume_matches.map((r,i)=>e.jsxs("div",{className:"bg-white rounded p-2 mt-1 border border-gray-200 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500 mb-1",children:[e.jsx("span",{className:"font-medium",children:r.section}),e.jsx("span",{children:"•"}),e.jsx("span",{children:r.company_or_context}),e.jsx("span",{className:`ml-auto px-1.5 py-0.5 rounded ${r.relevance==="direct"?"bg-green-100 text-green-700":r.relevance==="partial"?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-600"}`,children:r.relevance})]}),e.jsx("p",{className:"text-gray-700",children:r.bullet})]},i))]}),!t.is_matched&&t.suggestion_if_missing&&e.jsxs("div",{className:"mt-2 p-2 bg-yellow-50 rounded border border-yellow-200",children:[e.jsx("p",{className:"text-xs font-medium text-yellow-800 mb-1",children:"How to address:"}),e.jsx("p",{className:"text-sm text-yellow-700",children:t.suggestion_if_missing})]})]})]},a))}):e.jsx("div",{className:"text-center py-8 text-gray-500",children:e.jsx("p",{children:"No requirements data available"})})}),c==="edits"&&e.jsx("div",{className:"space-y-3",children:e.jsxs(e.Fragment,{children:[s.potential_score_after_edits>s.score&&e.jsx("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg p-3 mb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-green-800",children:"Potential score after edits:"}),e.jsxs("span",{className:"text-xl font-bold text-green-600",children:[s.potential_score_after_edits,"%",e.jsxs("span",{className:"text-sm font-normal text-green-500 ml-1",children:["(+",s.potential_score_after_edits-s.score,")"]})]})]})}),s.resume_edits.length>0&&e.jsx("div",{className:"bg-blue-50 rounded-lg p-4 mb-4 border border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-1",children:"Generate Complete Edited Resume"}),e.jsxs("p",{className:"text-sm text-blue-700",children:["Apply all ",s.resume_edits.length," edits and get a formatted resume ready to use"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(A,{onClick:()=>F("pdf"),disabled:P,className:"bg-blue-600 hover:bg-blue-700",children:P?e.jsx(U,{size:16,className:"animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(oe,{size:16,className:"mr-2"}),"PDF"]})}),e.jsx(A,{onClick:()=>F("plain"),disabled:P,variant:"outline",children:P?e.jsx(U,{size:16,className:"animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(X,{size:16,className:"mr-2"}),"TXT"]})})]})]})}),s.resume_edits.map(t=>e.jsx("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:e.jsxs("div",{className:"p-3",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{size:16,className:"text-blue-500"}),e.jsxs("span",{className:"font-medium text-gray-900",children:[t.section,t.subsection&&e.jsxs("span",{className:"text-gray-500",children:[" • ",t.subsection]})]})]}),e.jsxs("span",{className:`text-xs px-2 py-0.5 rounded border ${q(t.priority)}`,children:[t.priority," priority"]})]}),e.jsx("p",{className:"text-sm text-blue-600 mb-2",children:t.impact}),t.before_after_preview&&e.jsxs("div",{className:"space-y-2 mb-2",children:[t.before_after_preview.before&&e.jsxs("div",{className:"bg-red-50 rounded p-2 border border-red-100",children:[e.jsx("p",{className:"text-xs text-red-500 font-medium mb-1",children:"Before:"}),e.jsx("p",{className:"text-sm text-red-700 line-through",children:t.before_after_preview.before})]}),e.jsxs("div",{className:"bg-green-50 rounded p-2 border border-green-100",children:[e.jsx("p",{className:"text-xs text-green-600 font-medium mb-1",children:t.current_content?"After:":"Add:"}),e.jsx("p",{className:"text-sm text-green-800",children:t.before_after_preview.after||t.suggested_content})]})]}),!t.before_after_preview&&e.jsxs("div",{className:"bg-blue-50 rounded p-2 border border-blue-100 mb-2",children:[e.jsx("p",{className:"text-xs text-blue-600 font-medium mb-1",children:"Suggestion:"}),e.jsx("p",{className:"text-sm text-blue-800",children:t.suggested_content})]}),e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:t.rationale}),t.keywords_added.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1",children:t.keywords_added.map((a,r)=>e.jsxs("span",{className:"text-xs px-1.5 py-0.5 bg-purple-100 text-purple-700 rounded",children:["+",a]},r))}),e.jsx("button",{onClick:()=>k(t.suggested_content,t.id),className:"mt-2 flex items-center gap-1 text-xs text-gray-500 hover:text-gray-700",children:x===t.id?e.jsxs(e.Fragment,{children:[e.jsx(Z,{size:12,className:"text-green-500"}),"Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{size:12}),"Copy suggestion"]})})]})},t.id))]})}),c==="cover_letter"&&e.jsx("div",{children:e.jsx(e.Fragment,{children:T?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("span",{className:`text-xs px-2 py-1 rounded ${T.tone==="formal"?"bg-gray-100 text-gray-700":T.tone==="enthusiastic"?"bg-orange-100 text-orange-700":"bg-blue-100 text-blue-700"}`,children:[T.tone," tone"]}),e.jsxs("span",{className:"text-xs text-gray-500 ml-2",children:[T.word_count," words"]})]}),e.jsx(A,{onClick:()=>k(T.full_text,"full_letter"),size:"sm",className:"bg-blue-600 hover:bg-blue-700",children:x==="full_letter"?e.jsxs(e.Fragment,{children:[e.jsx(Z,{size:14,className:"mr-2"}),"Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{size:14,className:"mr-2"}),"Copy Full Letter"]})})]}),e.jsxs("div",{className:"bg-purple-50 rounded-lg p-3 text-sm",children:[e.jsx("span",{className:"font-medium text-purple-800",children:"Customization: "}),e.jsx("span",{className:"text-purple-700",children:T.customization_summary})]}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 border border-gray-200",children:e.jsx("div",{className:"prose prose-sm max-w-none",children:T.full_text.split(`

`).map((t,a)=>e.jsx("p",{className:"text-gray-800 mb-3 last:mb-0",children:t},a))})})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(X,{size:48,className:"mx-auto text-gray-300 mb-4"}),e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Generate a Tailored Cover Letter"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Based on your fit analysis, we'll create a personalized cover letter that highlights your strengths and addresses key requirements."}),e.jsx(A,{onClick:J,disabled:S,className:"bg-blue-600 hover:bg-blue-700",children:S?e.jsxs(e.Fragment,{children:[e.jsx(U,{size:16,className:"animate-spin mr-2"}),"Generating..."]}):e.jsx(e.Fragment,{children:"Generate Cover Letter"})})]})})})]})]})};function ke(){const{user:s}=ne(),u=de(),[b]=me(),[l,o]=p.useState(""),[c,d]=p.useState(null),[n,f]=p.useState(null),[x,w]=p.useState(null),[_,R]=p.useState(!1),[P,m]=p.useState(null),[S,L]=p.useState(b.get("analysisId")||null),[T,z]=p.useState(!1),[j,k]=p.useState(""),[Q,E]=p.useState(null),[q,J]=p.useState(!1);p.useEffect(()=>{(async()=>{try{const{db:i}=await B(async()=>{const{db:h}=await import("./index-DlXH6OO2.js").then(function(C){return C.j});return{db:h}},__vite__mapDeps([0,1,2,3,4,5,6])),{doc:y,getDoc:g}=await B(async()=>{const{doc:h,getDoc:C}=await import("./vendor-firebase-Bz1e_Tmy.js").then(function(D){return D.E});return{doc:h,getDoc:C}},__vite__mapDeps([4,1,2,3]));if(!(s!=null&&s.uid))return;const N=y(i,"users",s.uid),v=await g(N);if(v.exists()){const h=v.data(),C=h.resumeText||h.resume_text||"",D={resumeText:C,rawText:C,resumeParsed:h.resumeParsed||{},resumeUrl:h.resumeUrl||null,resumeFileName:h.resumeFileName||null,resumeNeedsOCR:h.resumeNeedsOCR||!1,...h.resumeParsed};f(D),!C&&D.resumeUrl&&console.warn("[ApplicationLab] Resume text missing but resumeUrl exists - user may need to repair")}}catch(i){console.error("Failed to load resume:",i)}})()},[s]),p.useEffect(()=>{(async()=>{if(!(!S||!(s!=null&&s.uid))){R(!0),m(null);try{const i=await fe(S);i.status==="ok"&&i.analysis&&i.job_snapshot?(w(i.analysis),d(i.job_snapshot)):m(i.message||"Failed to load analysis")}catch(i){m(i instanceof Error?i.message:"Failed to load analysis")}finally{R(!1)}}})()},[S,s]);const F=async()=>{var r,i;if(!l.trim()){m("Please enter a job URL or description");return}if(!n){m("Please upload your resume in Account Settings first");return}R(!0),m(null);try{let y;if(l.startsWith("http://")||l.startsWith("https://"))y={url:l,title:"",company:"",snippet:""};else{const N=l.split(" at ");y={title:N[0]||l,company:N[1]||"",snippet:""}}const g=await re(y,n);g.status==="ok"&&g.analysis?(z(!1),k(""),w(g.analysis),d(y),g.analysis_id&&(L(g.analysis_id),window.history.replaceState({},"",`/application-lab?analysisId=${g.analysis_id}`))):(g.error_code==="JOB_DESCRIPTION_EMPTY"||((r=g.message)==null?void 0:r.includes("Unable to extract sufficient job description"))||((i=g.message)==null?void 0:i.includes("paste the job description manually")))&&(l.startsWith("http://")||l.startsWith("https://"))?(z(!0),E(l),m(null)):m(g.message||"Analysis failed")}catch(y){m(y instanceof Error?y.message:"Failed to analyze job")}finally{R(!1)}},I=r=>{x&&w({...x,cover_letter:r})},G=async()=>{if(!j.trim()||j.trim().length<300){m("Please paste at least 300 characters of the job description");return}if(!n){m("Please upload your resume in Account Settings first");return}R(!0),m(null);try{const r={title:"",company:"",url:void 0,snippet:j.trim(),job_description_override:j.trim()},i=await re(r,n);i.status==="ok"&&i.analysis?(z(!1),k(""),E(null),w(i.analysis),d(r),i.analysis_id&&(L(i.analysis_id),window.history.replaceState({},"",`/application-lab?analysisId=${i.analysis_id}`))):m(i.message||"Analysis failed")}catch(r){m(r instanceof Error?r.message:"Failed to analyze job")}finally{R(!1)}},t=()=>{z(!1),k(""),E(null),o(""),m(null)},a=async()=>{if(!(n!=null&&n.resumeUrl)){m("No resume URL found. Please upload a resume first.");return}J(!0),m(null);try{const r=await Ne();if(r.status==="ok"){const{db:i}=await B(async()=>{const{db:N}=await import("./index-DlXH6OO2.js").then(function(v){return v.j});return{db:N}},__vite__mapDeps([0,1,2,3,4,5,6])),{doc:y,getDoc:g}=await B(async()=>{const{doc:N,getDoc:v}=await import("./vendor-firebase-Bz1e_Tmy.js").then(function(h){return h.E});return{doc:N,getDoc:v}},__vite__mapDeps([4,1,2,3]));if(s!=null&&s.uid){const N=y(i,"users",s.uid),v=await g(N);if(v.exists()){const h=v.data(),C=h.resumeText||h.resume_text||"",D={resumeText:C,rawText:C,resumeParsed:h.resumeParsed||{},resumeUrl:h.resumeUrl||null,resumeFileName:h.resumeFileName||null,resumeNeedsOCR:h.resumeNeedsOCR||!1,...h.resumeParsed};f(D)}}m(null)}else m(r.message||"Failed to repair resume")}catch(r){m(r instanceof Error?r.message:"Failed to repair resume")}finally{J(!1)}};return s?e.jsx(pe,{children:e.jsxs("div",{className:"flex min-h-screen w-full bg-transparent text-foreground",children:[e.jsx(ge,{}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("header",{className:"h-16 flex items-center justify-between border-b border-gray-100/30 px-6 bg-transparent shadow-sm relative z-20",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(he,{className:"text-foreground hover:bg-secondary"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-5 w-5 text-foreground"}),e.jsx("h1",{className:"text-xl font-semibold",children:"Application Lab"})]})]}),e.jsx(be,{})]}),e.jsx("main",{className:"p-8 bg-transparent",children:e.jsxs("div",{className:"max-w-5xl mx-auto",children:[P&&e.jsxs("div",{className:"mb-6 bg-red-50 border border-red-200 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(M,{className:"text-red-600 flex-shrink-0 mt-0.5",size:20}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-red-900",children:"Error"}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:P})]}),e.jsx("button",{onClick:()=>m(null),className:"text-red-600 hover:text-red-800",children:"×"})]}),T&&!x&&e.jsxs(W,{className:"bg-white border-border rounded-2xl",children:[e.jsx(te,{className:"border-b border-border",children:e.jsx(se,{className:"text-xl text-foreground flex items-center gap-2",children:"We couldn't read this job page"})}),e.jsxs(H,{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-foreground mb-4",children:"Some job sites load job descriptions dynamically. Paste the job description below to continue."}),e.jsx("label",{className:"block text-sm font-medium mb-2 text-foreground",children:"Job Description"}),e.jsx(xe,{value:j,onChange:r=>k(r.target.value),placeholder:"Paste the full job description including requirements, responsibilities, and qualifications...",className:"bg-white border-input text-foreground placeholder:text-muted-foreground min-h-[200px]",disabled:_}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Tip: Copy the full job description including requirements.",j.length>0&&e.jsxs("span",{className:j.length<300?"text-yellow-600":"text-green-600",children:[" ","(",j.length," characters, minimum 300 required)"]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsx(A,{onClick:G,disabled:_||j.trim().length<300||!n,className:"bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-700 hover:to-blue-600 text-white",children:_?e.jsxs(e.Fragment,{children:[e.jsx(U,{size:16,className:"animate-spin mr-2"}),"Analyzing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(V,{size:16,className:"mr-2"}),"Analyze Job Description"]})}),e.jsx(A,{onClick:t,disabled:_,variant:"outline",className:"border-border hover:bg-secondary",children:"Try a different link"})]}),!n&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-yellow-800",children:["Please upload your resume in"," ",e.jsx("button",{onClick:()=>u("/account-settings"),className:"underline font-medium",children:"Account Settings"})," ","to use Application Lab."]})}),n&&!n.resumeText&&n.resumeUrl&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-blue-900 mb-1",children:"Resume text missing"}),e.jsx("p",{className:"text-sm text-blue-800",children:'Your resume file exists but the text content is missing. Click "Repair Resume" to extract text from your uploaded PDF.'})]}),e.jsx(A,{onClick:a,disabled:q,size:"sm",className:"bg-blue-600 hover:bg-blue-700 text-white",children:q?"Repairing...":"Repair Resume"})]})})]})]}),!x&&!T&&e.jsxs(W,{className:"bg-white border-border rounded-2xl",children:[e.jsx(te,{className:"border-b border-border",children:e.jsx(se,{className:"text-xl text-foreground flex items-center gap-2",children:"Application Lab"})}),e.jsxs(H,{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-foreground",children:"Job URL or Description"}),e.jsx(ue,{value:l,onChange:r=>o(r.target.value),placeholder:"Paste job posting URL or enter: 'Job Title at Company Name'",className:"bg-white border-input text-foreground placeholder:text-muted-foreground",disabled:_,onKeyPress:r=>{r.key==="Enter"&&!_&&F()}}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:'Example: "Software Engineer at Google" or paste a LinkedIn job URL'})]}),e.jsx("div",{className:"flex flex-wrap gap-3",children:e.jsx(A,{onClick:F,disabled:_||!l.trim()||!n,className:"bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-700 hover:to-blue-600 text-white",children:_?e.jsxs(e.Fragment,{children:[e.jsx(U,{size:16,className:"animate-spin mr-2"}),"Analyzing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(V,{size:16,className:"mr-2"}),"Analyze Application"]})})}),!n&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-yellow-800",children:["Please upload your resume in"," ",e.jsx("button",{onClick:()=>u("/account-settings"),className:"underline font-medium",children:"Account Settings"})," ","to use Application Lab."]})})]})]}),_&&!x&&e.jsx(W,{className:"bg-white border-border rounded-2xl",children:e.jsxs(H,{className:"p-12 text-center",children:[e.jsx(U,{className:"animate-spin text-blue-600 mx-auto mb-4",size:48}),e.jsx("p",{className:"text-gray-600",children:"Analyzing job fit..."})]})}),x&&c&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(ve,{analysis:x,job:c,userResume:n,onCoverLetterGenerated:I}),e.jsx("div",{className:"text-center",children:e.jsx(A,{variant:"outline",onClick:()=>{w(null),d(null),L(null),o(""),m(null),z(!1),k(""),E(null),window.history.replaceState({},"","/application-lab")},className:"border-border hover:bg-secondary",children:"Analyze Another Job"})})]}),!x&&!_&&!P&&e.jsx(W,{className:"bg-white border-border rounded-2xl",children:e.jsxs(H,{className:"p-12 text-center",children:[e.jsx(V,{className:"text-gray-300 mx-auto mb-4",size:48}),e.jsx("h3",{className:"text-lg font-medium text-foreground mb-2",children:"Get Started with Application Lab"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Enter a job URL or description above to get personalized analysis and recommendations."})]})})]})})]})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-600 mb-4",children:"Please sign in to use Application Lab"}),e.jsx(A,{onClick:()=>u("/signin"),children:"Sign In"})]})})}export{ke as default};
