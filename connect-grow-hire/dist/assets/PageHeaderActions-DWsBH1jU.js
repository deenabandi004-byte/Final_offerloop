import{r as a,j as e,an as H,ao as R,z as D,aj as W,u as _,aX as U,G as O}from"./vendor-react-CGb3T5FJ.js";import{B as S}from"./index-CkUgwTeu.js";import{I as V}from"./input-CsLs9Tx5.js";const K=window.location.hostname==="localhost"?"http://localhost:5001":"https://www.offerloop.ai",G=({onJobTitleSuggestion:p})=>{const[l,g]=a.useState([]),[x,m]=a.useState(""),[r,y]=a.useState(!1),[b,N]=a.useState({}),w=a.useRef(null),h=a.useRef(null);a.useEffect(()=>{var t;(t=w.current)==null||t.scrollIntoView({behavior:"smooth"})},[l]);const j=async()=>{var o;if(!x.trim()||r)return;const t={id:`user-${Date.now()}`,role:"user",content:x.trim(),timestamp:new Date};g(u=>[...u,t]),m(""),y(!0);try{const s=await(await fetch(`${K}/api/scout/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:t.content,context:b})})).json();s.context&&N(s.context);const n={id:`assistant-${Date.now()}`,role:"assistant",content:s.message,fields:s.fields,jobListings:s.job_listings,timestamp:new Date};if(s.job_listings&&s.job_listings.length>0&&console.log("[Scout] Job listings received:",s.job_listings.map(i=>({title:i.title,company:i.company,url:i.url,hasUrl:!!i.url}))),g(i=>[...i,n]),s.fields){const{job_title:i,company:d,location:v}=s.fields;(i||d||v)&&p&&p(i||"",d||void 0,v||void 0)}}catch(u){console.error("[Scout] Error:",u),g(s=>[...s,{id:`error-${Date.now()}`,role:"assistant",content:"Oops! I ran into an issue. Please try again or rephrase your message.",timestamp:new Date}])}finally{y(!1),(o=h.current)==null||o.focus()}},k=t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),j())},c=t=>{p&&p(t.title,t.company,t.location||void 0)},E=t=>t.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>").replace(/\n/g,"<br />"),f=t=>{var o,u,s,n,i,d;t==="paste-url"?(m("Paste job URL here..."),(o=h.current)==null||o.focus(),(u=h.current)==null||u.select()):t==="describe-role"?(m("Describe the role you're looking for..."),(s=h.current)==null||s.focus(),(n=h.current)==null||n.select()):t==="ask-company"&&(m("Ask about a company..."),(i=h.current)==null||i.focus(),(d=h.current)==null||d.select())};return e.jsxs("div",{className:"flex flex-col h-full bg-white",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[l.length===0&&e.jsx("div",{className:"mt-3 mx-4 p-3 rounded-2xl bg-[#F5F7FF]",children:e.jsx("p",{className:"text-sm text-slate-800",children:"Hey! I'm Scout. Paste a job posting URL or describe a role and I'll fill in your search filters for you."})}),l.length===0&&e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2 px-4",children:[e.jsx("button",{onClick:()=>f("paste-url"),className:"inline-flex items-center px-3 py-1.5 rounded-full bg-white border border-slate-200 text-xs font-medium text-slate-700 hover:bg-slate-50 cursor-pointer transition-colors",children:"Paste job URL"}),e.jsx("button",{onClick:()=>f("describe-role"),className:"inline-flex items-center px-3 py-1.5 rounded-full bg-white border border-slate-200 text-xs font-medium text-slate-700 hover:bg-slate-50 cursor-pointer transition-colors",children:"Describe a role"}),e.jsx("button",{onClick:()=>f("ask-company"),className:"inline-flex items-center px-3 py-1.5 rounded-full bg-white border border-slate-200 text-xs font-medium text-slate-700 hover:bg-slate-50 cursor-pointer transition-colors",children:"Ask about a company"})]}),e.jsxs("div",{className:"px-4 py-4 space-y-4",children:[l.map(t=>e.jsx("div",{className:`flex ${t.role==="user"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[85%] rounded-2xl p-3 ${t.role==="user"?"text-white":"bg-[#F5F7FF] text-slate-800"}`,style:t.role==="user"?{background:"linear-gradient(135deg, #3B82F6, #60A5FA)"}:void 0,children:[e.jsx("div",{className:"text-sm leading-relaxed",dangerouslySetInnerHTML:{__html:E(t.content)}}),t.fields&&Object.keys(t.fields).length>0&&e.jsxs("div",{className:"mt-3 p-2 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-1 text-blue-700 text-xs font-medium mb-1",children:[e.jsx(H,{className:"h-3 w-3"}),"Search fields updated!"]}),e.jsxs("div",{className:"text-xs text-blue-600",children:[t.fields.job_title&&e.jsxs("span",{children:["Title: ",t.fields.job_title]}),t.fields.company&&e.jsxs("span",{children:[" • Company: ",t.fields.company]}),t.fields.location&&e.jsxs("span",{children:[" • Location: ",t.fields.location]})]})]}),t.jobListings&&t.jobListings.length>0&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsx("div",{className:"text-xs text-slate-600 font-medium",children:"Click to use for search:"}),t.jobListings.slice(0,5).map((o,u)=>e.jsx("div",{className:"w-full p-3 bg-white rounded-lg border border-slate-200 hover:border-blue-400 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("button",{onClick:()=>c(o),className:"flex-1 text-left min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-slate-900",children:o.title}),e.jsxs("div",{className:"text-xs text-slate-500",children:[o.company,o.location&&` • ${o.location}`]})]}),o.url&&o.url.trim()&&o.url.startsWith("http")?e.jsxs("a",{href:o.url,target:"_blank",rel:"noopener noreferrer",className:"flex-shrink-0 px-3 py-1.5 text-xs font-medium text-white rounded transition-all shadow-sm hover:shadow-md hover:opacity-90 flex items-center gap-1.5 whitespace-nowrap",style:{background:"linear-gradient(135deg, #3B82F6, #60A5FA)"},title:"View job posting",onClick:s=>{s.stopPropagation(),console.log("[Scout] Opening job URL:",o.url)},children:[e.jsx(R,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"View"})]}):e.jsxs("button",{disabled:!0,className:"flex-shrink-0 px-3 py-1.5 text-xs font-medium bg-slate-100 text-slate-400 rounded cursor-not-allowed flex items-center gap-1.5 whitespace-nowrap",title:"Job URL not available",children:[e.jsx(R,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:"View"})]})]})},u))]})]})},t.id)),e.jsx("div",{ref:w}),r&&e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:"bg-slate-100 border border-slate-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center gap-2 text-slate-600",children:[e.jsx(D,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{className:"text-sm",children:"Scout is thinking..."})]})})})]})]}),e.jsx("div",{className:"px-4 py-3 border-t border-[#E3E8F0] bg-white",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(V,{ref:h,value:x,onChange:t=>m(t.target.value),onKeyPress:k,placeholder:"Paste a job URL or describe what you're looking for...",className:"flex-1 bg-white border-[#E3E8F0] text-slate-900 placeholder:text-slate-400 focus:border-blue-500 focus-visible:ring-2 focus-visible:ring-blue-500/20 rounded-md",disabled:r}),e.jsx(S,{onClick:j,disabled:!x.trim()||r,className:"hover:opacity-90 rounded-md",style:{background:"linear-gradient(135deg, #3B82F6, #60A5FA)"},children:r?e.jsx(D,{className:"h-4 w-4 animate-spin"}):e.jsx(W,{className:"h-4 w-4"})})]})})]})},J=({onJobTitleSuggestion:p})=>{const[l,g]=a.useState(!1),[x,m]=a.useState({x:0,y:0}),[r,y]=a.useState({width:370,height:600});a.useEffect(()=>{l&&!t.current?(m({x:Math.max(16,window.innerWidth-r.width-16),y:16}),t.current=!0):l||(t.current=!1)},[l]),a.useEffect(()=>{const s=()=>{if(l){const n=window.innerWidth-r.width,i=window.innerHeight-r.height;m(d=>({x:Math.max(0,Math.min(d.x,n)),y:Math.max(0,Math.min(d.y,i))}))}};return window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[l,r]);const[b,N]=a.useState(!1),[w,h]=a.useState(!1),[j,k]=a.useState({x:0,y:0}),[c,E]=a.useState({x:0,y:0,width:0,height:0,posX:0,posY:0}),f=a.useRef(null),t=a.useRef(!1);a.useEffect(()=>{const s=`
      @keyframes wave {
        0%, 100% { transform: rotate(-8deg); }
        50% { transform: rotate(8deg); }
      }
      @keyframes ping-soft {
        0% { transform: scale(1); opacity: 1; }
        50% { transform: scale(1.25); opacity: 0.4; }
        100% { transform: scale(1); opacity: 1; }
      }
    `,n=document.createElement("style");return n.textContent=s,document.head.appendChild(n),()=>{document.head.contains(n)&&document.head.removeChild(n)}},[]);const o=s=>{if(f.current){N(!0);const n=f.current.getBoundingClientRect();k({x:s.clientX-n.left,y:s.clientY-n.top}),s.preventDefault()}},u=s=>{if(s.stopPropagation(),s.preventDefault(),f.current){h(!0);const n=f.current.getBoundingClientRect();E({x:s.clientX,y:s.clientY,width:n.width,height:n.height,posX:x.x,posY:x.y})}};return a.useEffect(()=>{const s=i=>{if(b){const d=i.clientX-j.x,v=i.clientY-j.y,C=window.innerWidth-r.width,F=window.innerHeight-r.height;m({x:Math.max(0,Math.min(d,C)),y:Math.max(0,Math.min(v,F))})}else if(w){const d=i.clientX-c.x,v=i.clientY-c.y,C=300,F=400,z=c.width-d,A=c.height-v,I=c.posX+d,X=c.posY+v,P=window.innerWidth-I,Y=window.innerHeight-X,M=Math.max(C,Math.min(z,P)),L=Math.max(F,Math.min(A,Y)),B=c.posX+(c.width-M),$=c.posY+(c.height-L);y({width:M,height:L}),m({x:Math.max(0,B),y:Math.max(0,$)})}},n=()=>{N(!1),h(!1)};return(b||w)&&(document.addEventListener("mousemove",s),document.addEventListener("mouseup",n)),()=>{document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",n)}},[b,w,j,c,r,x]),e.jsxs(e.Fragment,{children:[l&&e.jsxs("div",{ref:f,className:"fixed z-40 flex flex-col rounded-2xl border border-[#E3E8F0] bg-white shadow-lg overflow-hidden",style:{left:`${x.x}px`,top:`${x.y}px`,width:`${r.width}px`,height:`${r.height}px`,cursor:b?"grabbing":"default",userSelect:b||w?"none":"auto"},children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-[#E3E8F0] bg-white cursor-grab active:cursor-grabbing select-none",onMouseDown:o,children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center overflow-hidden",style:{backgroundColor:"#fff6e2"},children:e.jsx("img",{src:"/scout-mascot.png",alt:"Scout AI",className:"w-6 h-6 object-contain"})}),e.jsx("div",{children:e.jsx("h3",{className:"text-sm font-semibold text-slate-900",children:"Scout AI"})})]}),e.jsx("button",{onClick:()=>g(!1),className:"text-xs text-slate-500 hover:text-slate-700 transition-colors",children:"Close"})]}),e.jsx("div",{className:"flex-1 min-h-0 overflow-hidden",children:e.jsx(G,{onJobTitleSuggestion:p})}),e.jsx("div",{className:"absolute top-0 left-0 w-6 h-6 cursor-nwse-resize z-10",onMouseDown:u,style:{background:"linear-gradient(to bottom right, transparent 0%, transparent 40%, #E3E8F0 40%, #E3E8F0 45%, transparent 45%, transparent 100%)"},children:e.jsx("div",{className:"absolute top-1 left-1 w-3 h-3 border-l-2 border-t-2 border-slate-400"})})]}),e.jsxs("button",{onClick:()=>g(!0),className:"inline-flex items-center gap-2 rounded-full border px-3 py-1.5 bg-[#ECF4FF] border-[#C7D8FF] text-sm font-medium text-[#111827] shadow-sm hover:shadow-md hover:scale-105 hover:bg-gradient-to-r hover:from-[#ECF4FF] hover:to-white cursor-pointer transition-all duration-150",children:[e.jsxs("div",{className:"relative flex items-center justify-center h-6 w-6 rounded-full bg-[#FFF7EA] flex-shrink-0",children:[e.jsx("img",{src:"/scout-mascot.png",alt:"Scout AI",className:"w-4 h-4 object-contain",style:{animation:"wave 2.5s ease-in-out infinite",transformOrigin:"center bottom"}}),e.jsx("span",{className:"absolute -top-0.5 -right-0.5 h-2.5 w-2.5 rounded-full bg-[#3B82F6]",style:{animation:"ping-soft 1.2s ease-in-out infinite"}})]}),e.jsx("span",{className:"whitespace-nowrap hidden sm:inline",children:"Ask Scout"})]})]})};function Z({onJobTitleSuggestion:p}){const l=_(),g=()=>{l("/home?tab=outbox")};return e.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2 flex-shrink-0",children:[e.jsx(S,{variant:"ghost",size:"icon",onClick:g,className:"h-9 w-9 hover:bg-blue-100 hover:text-blue-600 flex-shrink-0","aria-label":"View outbox",children:e.jsx(U,{className:"h-5 w-5"})}),e.jsx(S,{variant:"ghost",size:"icon",onClick:()=>l("/home?tab=calendar"),className:"h-9 w-9 hover:bg-blue-100 hover:text-blue-600 flex-shrink-0","aria-label":"View calendar",children:e.jsx(O,{className:"h-5 w-5"})}),e.jsx(J,{onJobTitleSuggestion:p})]})}export{Z as P};
