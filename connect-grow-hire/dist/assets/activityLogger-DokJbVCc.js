import{f}from"./firebaseApi-DU162AUl.js";import{T as D}from"./vendor-firebase-Bz1e_Tmy.js";async function S(t){try{const e=await f.getActivities(t,100),n=new Date;n.setDate(n.getDate()-7);const c=D.fromDate(n),r=e.filter(o=>{if(!o.timestamp)return!1;const a=o.timestamp.toMillis?o.timestamp.toMillis():o.timestamp,i=c.toMillis();return a>=i}),l={contactsGenerated:0,firmsSearched:0,coffeeChatsCreated:0,interviewPrepsCreated:0,totalActivities:r.length};return r.forEach(o=>{switch(o.type){case"contactSearch":l.contactsGenerated++;break;case"firmSearch":l.firmsSearched++;break;case"coffeePrep":l.coffeeChatsCreated++;break;case"interviewPrep":l.interviewPrepsCreated++;break}}),l}catch(e){return console.error("Error calculating weekly summary:",e),{contactsGenerated:0,firmsSearched:0,coffeeChatsCreated:0,interviewPrepsCreated:0,totalActivities:0}}}async function h(t){try{const e=await f.getActivities(t,200);if(e.length===0)return{currentStreak:0,longestStreak:0,lastActivityDate:null};const n=new Map;e.forEach(s=>{if(!s.timestamp)return;const g=(s.timestamp.toMillis?new Date(s.timestamp.toMillis()):new Date(s.timestamp)).toISOString().split("T")[0];n.set(g,!0)});const c=Array.from(n.keys()).sort().reverse();if(c.length===0)return{currentStreak:0,longestStreak:0,lastActivityDate:null};let r=0;const l=new Date;l.setHours(0,0,0,0);let o=new Date(l);for(let s=0;s<c.length;s++){const u=c[s];new Date(u).setHours(0,0,0,0);const m=o.toISOString().split("T")[0];if(u===m)r++,o.setDate(o.getDate()-1);else{if(s===0&&u!==m){const y=new Date(l);y.setDate(y.getDate()-1);const p=y.toISOString().split("T")[0];if(u===p){r=1,o.setDate(o.getDate()-1);continue}}break}}let a=1,i=1;for(let s=1;s<c.length;s++){const u=new Date(c[s-1]),g=new Date(c[s]);Math.floor((u.getTime()-g.getTime())/(1e3*60*60*24))===1?(i++,a=Math.max(a,i)):i=1}return{currentStreak:r,longestStreak:a,lastActivityDate:c[0]||null}}catch(e){return console.error("Error calculating streak:",e),{currentStreak:0,longestStreak:0,lastActivityDate:null}}}async function k(t,e){try{let n=0;const c=e.startDate.toMillis(),r=e.endDate.toMillis();switch(e.type){case"contacts":{n=(await f.getContacts(t)).filter(a=>{if(!a.createdAt)return!1;const i=new Date(a.createdAt).getTime();return i>=c&&i<=r}).length;break}case"firms":{n=(await f.getActivities(t,100)).filter(a=>{if(a.type!=="firmSearch"||!a.timestamp)return!1;const i=a.timestamp.toMillis?a.timestamp.toMillis():a.timestamp;return i>=c&&i<=r}).length;break}case"coffeeChats":{n=(await f.getActivities(t,100)).filter(a=>{if(a.type!=="coffeePrep"||!a.timestamp)return!1;const i=a.timestamp.toMillis?a.timestamp.toMillis():a.timestamp;return i>=c&&i<=r}).length;break}case"outreach":{n=(await f.getContacts(t)).filter(a=>{if(!a.firstContactDate||a.status==="Not Contacted")return!1;const i=new Date(a.firstContactDate).getTime();return i>=c&&i<=r}).length;break}}const l=e.target>0?Math.min(100,n/e.target*100):0;return{goal:e,current:n,target:e.target,percentage:l}}catch(n){return console.error("Error calculating goal progress:",n),{goal:e,current:0,target:e.target,percentage:0}}}function v(){const t=new Date;return new Date(t.getFullYear(),t.getMonth(),1),new Date(t.getFullYear(),t.getMonth()+1,0,23,59,59),[{type:"contacts",target:50,period:"month"},{type:"firms",target:20,period:"month"},{type:"coffeeChats",target:10,period:"month"}]}async function C(t,e,n,c){try{console.log("ðŸ“ activityLogger.logActivity called:",{userId:t,type:e,summary:n}),await f.logActivity(t,e,n,c),console.log("âœ… activityLogger: Activity logged successfully");try{const r=await h(t),l=new Date().toISOString().split("T")[0];r.lastActivityDate&&(await f.updateUserStreak(t,{currentStreak:r.currentStreak,longestStreak:Math.max(r.currentStreak,r.longestStreak),lastActivityDate:r.lastActivityDate}),console.log("âœ… Streak updated:",r))}catch(r){console.error("âš ï¸ Failed to update streak (non-critical):",r)}}catch(r){console.error("âŒ activityLogger: Failed to log activity:",r)}}function A(t){const e=[];return t.jobTitle&&e.push(t.jobTitle),t.company&&e.push(`at ${t.company}`),t.location&&e.push(`in ${t.location}`),t.college&&e.push(`who attended ${t.college}`),`${e.length>0?e.join(" "):"contacts"} â€“ Generated ${t.contactCount} contacts`}function M(t){return t.contactName&&t.company?`Created coffee chat prep for ${t.contactName} at ${t.company}`:t.contactName?`Created coffee chat prep for ${t.contactName}`:"Created coffee chat prep"}function T(t){return t.roleTitle&&t.company?`Created interview prep for ${t.roleTitle} at ${t.company}`:t.roleTitle?`Created interview prep for ${t.roleTitle}`:"Created interview prep"}export{h as a,k as b,S as c,M as d,A as e,T as f,v as g,C as l};
