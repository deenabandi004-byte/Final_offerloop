import{j as e,Z as w,q as v,r as n,y as C,W as f,Y as P,$ as p,a0 as A,a1 as S,a2 as D,a3 as k,a4 as F}from"./vendor-react-CNPOdD8u.js";import{a as L,B as c,t as m}from"./index-BIM4zrI7.js";import{S as E,A as B,a as R}from"./AppSidebar-JdqSLMuR.js";import{a as x}from"./api-ByVBniNk.js";import"./vendor-MQF2bGKN.js";import"./vendor-utils-B2rm_Apj.js";import"./vendor-firebase-DXNs06wB.js";import"./input-BaBIQFNu.js";import"./avatar-CtNc4JMz.js";function T({credits:r,max:i}){const l=r===0?"red":r<30?"amber":"blue",d=l==="red"?"bg-red-500/15 text-red-700 ring-red-400/30":l==="amber"?"bg-amber-500/15 text-amber-700 ring-amber-400/30":"bg-blue-500/15 text-blue-700 ring-blue-400/30";return e.jsxs("span",{className:`inline-flex items-center gap-1 px-3 py-1 rounded-full ring-1 ${d}`,children:[e.jsx(w,{className:"h-4 w-4"}),e.jsx("span",{className:"tabular-nums",children:r}),e.jsxs("span",{className:"opacity-70",children:["/ ",i]})]})}const H=()=>{const{user:r}=L(),i=v(),[l,d]=n.useState([]),[b,u]=n.useState(!0),[h,g]=n.useState(null);n.useEffect(()=>{(async()=>{var t;try{console.log("ðŸ” Starting to load coffee chat preps...");const a=await x.getAllCoffeeChatPreps();if(console.log("ðŸ“¦ Raw result from API:",a),"error"in a)throw console.error("âŒ Error in result:",a.error),new Error(a.error);console.log("âœ… Preps received:",a.preps),console.log("ðŸ“Š Number of preps:",((t=a.preps)==null?void 0:t.length)||0),d(a.preps||[])}catch(a){console.error("ðŸ’¥ Failed to load coffee chat preps:",a),m({title:"Unable to load library",description:a instanceof Error?a.message:"Please try again.",variant:"destructive"})}finally{u(!1),console.log("ðŸ Loading complete")}})()},[]);const j=async s=>{try{if(s.pdfUrl){window.open(s.pdfUrl,"_blank","noopener");return}const{pdfUrl:t}=await x.downloadCoffeeChatPDF(s.id);if(t)window.open(t,"_blank","noopener");else throw new Error("PDF URL not available yet")}catch{m({title:"Download failed",description:"Could not open the PDF. Please try again.",variant:"destructive"})}},y=async s=>{g(s);try{const t=await x.deleteCoffeeChatPrep(s);if("error"in t)throw new Error(t.error);d(a=>a.filter(N=>N.id!==s)),m({title:"Prep deleted",description:"Removed from your Coffee Chat Library."})}catch(t){m({title:"Delete failed",description:t instanceof Error?t.message:"Please try again.",variant:"destructive"})}finally{g(null)}},o=n.useMemo(()=>{const s=l.filter(a=>a.status==="completed"),t=l.filter(a=>a.status!=="completed");return{completed:s,inProgress:t}},[l]);return e.jsx(E,{children:e.jsxs("div",{className:"flex min-h-screen w-full bg-gray-900 text-white",children:[e.jsx(B,{}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("header",{className:"h-16 flex items-center justify-between border-b border-gray-800 px-6 bg-gray-900/80 backdrop-blur-sm",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(R,{className:"text-white hover:bg-gray-800/50"}),e.jsx("h1",{className:"text-xl font-semibold",children:"Coffee Chat Library"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(T,{credits:(r==null?void 0:r.credits)??0,max:(r==null?void 0:r.maxCredits)??120}),e.jsxs(c,{size:"sm",onClick:()=>i("/home"),variant:"outline",className:"border-gray-600 hover:border-gray-500",children:[e.jsx(C,{className:"h-4 w-4 mr-2"}),"Back to Home"]})]})]}),e.jsx("main",{className:"p-8",children:e.jsxs("div",{className:"max-w-6xl mx-auto space-y-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-semibold text-white flex items-center gap-2",children:[e.jsx(f,{className:"h-5 w-5 text-blue-400"}),"Saved Coffee Chat Preps"]}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Review, download, or delete the one-pagers youâ€™ve generated."})]}),e.jsxs(c,{onClick:()=>i("/home?tab=coffee-chat"),className:"text-white hover:opacity-90",style:{background:"linear-gradient(135deg, #3B82F6, #60A5FA)"},children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Create New Prep"]})]}),b?e.jsx("div",{className:"flex items-center justify-center h-48 rounded-xl border border-gray-800 bg-gray-900/80",children:e.jsxs("div",{className:"flex items-center gap-3 text-gray-300",children:[e.jsx(p,{className:"h-5 w-5 animate-spin text-blue-400"}),"Loading your library..."]})}):l.length===0?e.jsxs("div",{className:"rounded-xl border border-gray-800 bg-gray-900/80 p-10 text-center space-y-4",children:[e.jsx(f,{className:"h-10 w-10 mx-auto text-blue-400"}),e.jsx("h3",{className:"text-lg font-semibold text-white",children:"No preps yet"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Generate your first coffee chat prep to see it appear here."}),e.jsx(c,{onClick:()=>i("/home?tab=coffee-chat"),className:"text-white hover:opacity-90",style:{background:"linear-gradient(135deg, #3B82F6, #60A5FA)"},children:"Create Coffee Chat Prep"})]}):e.jsxs("div",{className:"space-y-6",children:[o.inProgress.length>0&&e.jsxs("section",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-400 uppercase mb-3",children:"In Progress"}),e.jsx("div",{className:"grid gap-4",children:o.inProgress.map(s=>e.jsxs("div",{className:"rounded-lg border border-yellow-500/40 bg-yellow-500/10 px-5 py-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-200 font-medium",children:s.contactName}),e.jsxs("p",{className:"text-xs text-gray-400",children:[s.jobTitle," @ ",s.company]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Requested ",s.createdAt?new Date(s.createdAt).toLocaleString():""]})]}),e.jsx("div",{className:"text-xs uppercase text-yellow-300",children:"Processing..."})]},s.id))})]}),o.completed.length>0&&e.jsxs("section",{className:"space-y-3",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-400 uppercase",children:["Completed (",o.completed.length,")"]}),e.jsx("div",{className:"grid gap-4",children:o.completed.map(s=>e.jsxs("div",{className:"rounded-xl border border-gray-800 bg-gray-900/80 p-5 flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-white font-medium",children:[e.jsx(A,{className:"h-4 w-4 text-blue-400"}),s.contactName]}),e.jsxs("div",{className:"text-sm text-gray-300",children:[s.jobTitle," @ ",s.company]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-xs text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(S,{className:"h-3 w-3"}),s.createdAt?new Date(s.createdAt).toLocaleDateString():"â€”"]}),s.hometown&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(D,{className:"h-3 w-3"}),s.hometown]})]}),s.industrySummary&&e.jsx("p",{className:"text-xs text-gray-400",children:s.industrySummary})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(c,{size:"sm",variant:"outline",className:"border-blue-500/60 text-blue-200 hover:bg-blue-500/10",onClick:()=>j(s),children:[e.jsx(k,{className:"h-4 w-4 mr-2"}),"PDF"]}),e.jsx(c,{size:"sm",variant:"ghost",className:"text-red-300 hover:text-red-200",disabled:h===s.id,onClick:()=>y(s.id),children:h===s.id?e.jsx(p,{className:"h-4 w-4 animate-spin"}):e.jsx(F,{className:"h-4 w-4"})})]})]},s.id))})]})]})]})})]})]})})};export{H as default};
