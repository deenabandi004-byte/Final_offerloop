import{r as x,j as e,aj as B,Y as ue,ax as G,ay as p,$ as z,ao as pe,a3 as J,a0 as he,a1 as ge,b as fe}from"./vendor-react-CNPOdD8u.js";import{S as Ce,A as De,a as Fe}from"./AppSidebar-JdqSLMuR.js";import{T as be,a as je,b as $,c as O}from"./tabs-BaAow5gf.js";import{a as Te,B as F,f as ve,t as u}from"./index-BIM4zrI7.js";import{a as _}from"./api-ByVBniNk.js";import{C as Y,a as we,b as Ne,c as W}from"./card-BZIFGvXF.js";import{I as b}from"./input-BaBIQFNu.js";import{B as ye}from"./badge-BGFdDQlq.js";import{L as Ae,B as Pe}from"./LockedFeatureOverlay-1wnuM3Kc.js";import{I as y}from"./constants-CpKbYGZX.js";import{f as Re,l as Le}from"./activityLogger-DJYdQF9E.js";import{P as Ee}from"./PageHeaderActions-KnCNUq_p.js";import"./vendor-MQF2bGKN.js";import"./vendor-utils-B2rm_Apj.js";import"./avatar-CtNc4JMz.js";import"./vendor-firebase-DXNs06wB.js";import"./firebaseApi-DARwkiAI.js";const ts=()=>{var ie,ne,le,oe,de,ce,me,xe;const{user:P,checkCredits:q}=Te(),U=P||{credits:0,tier:"free"},[c,T]=x.useState(!1),[K,h]=x.useState(""),[ke,Q]=x.useState(null),[i,H]=x.useState(null),[m,A]=x.useState("idle"),[g,Z]=x.useState(""),[l,Ie]=x.useState(null),[M,V]=x.useState(!1),[j,S]=x.useState(""),[v,C]=x.useState(""),[R,ee]=x.useState([]),[se,_e]=x.useState(!0),[qe,Ue]=x.useState(null);x.useEffect(()=>{(async()=>{try{const t=await _.getInterviewPrepHistory(1e3);if("error"in t)throw new Error(t.error);ee(t.history||[])}catch(t){console.error("Failed to load interview preps:",t),u({title:"Unable to load library",description:t instanceof Error?t.message:"Please try again.",variant:"destructive"})}finally{_e(!1)}})()},[]),x.useEffect(()=>{m==="completed"&&setTimeout(()=>{(async()=>{try{const t=await _.getInterviewPrepHistory(1e3);if("error"in t)throw new Error(t.error);ee(t.history||[])}catch(t){console.error("Failed to reload interview preps:",t)}})()},2e3)},[m]);const te=async()=>{console.log("ðŸŽ¬ handleInterviewPrepSubmit called");const s=g.trim(),t=j.trim()&&v.trim();if(!s&&!t){u({title:"Missing Information",description:"Please enter a job posting URL, or provide company name and job title.",variant:"destructive"});return}if(!P){u({title:"Authentication Required",description:"Please sign in to continue.",variant:"destructive"});return}if(U.credits<y){u({title:"Insufficient Credits",description:`You need ${y} credits to generate an interview prep.`,variant:"destructive"});return}T(!0),A("processing"),h("Analyzing job posting..."),H(null);try{const n={};g.trim()?n.job_posting_url=g.trim():(n.company_name=j.trim(),n.job_title=v.trim());const k=await _.generateInterviewPrep(n);if("error"in k)throw new Error(k.error);const o=k.id;Q(o);let d=0;const L=120;await new Promise((E,I)=>{const N=setInterval(async()=>{d++,console.log(`ðŸ”„ Interview Prep Poll ${d} starting...`);try{const r=await _.getInterviewPrepStatus(o);if(console.log(`Poll ${d}:`,r),"error"in r&&!("status"in r)){clearInterval(N),I(new Error(r.error));return}if("status"in r){const a=r.status;h(a==="parsing_job_posting"?r.progress||"Analyzing job posting...":a==="extracting_requirements"?r.progress||"Extracting role requirements...":a==="scraping_reddit"?r.progress||"Searching Reddit for interview experiences...":a==="processing_content"?r.progress||"Processing insights...":a==="generating_pdf"?r.progress||"Generating your prep guide...":r.progress||"Processing your request..."),r.jobDetails&&Ie(r.jobDetails)}if(r.pdfUrl){if(clearInterval(N),console.log("âœ… Interview Prep completed! pdfUrl:",r.pdfUrl),P!=null&&P.uid&&r.jobDetails)try{const a=r.jobDetails,D=a.job_title||v.trim()||"",w=a.company_name||j.trim()||"",Se=Re({roleTitle:D||void 0,company:w||void 0});await Le(P.uid,"interviewPrep",Se,{prepId:o,roleTitle:D||"",company:w||"",jobPostingUrl:g.trim()||""})}catch(a){console.error("Failed to log interview prep activity:",a)}fe.flushSync(()=>{T(!1),A("completed"),h("Interview Prep ready!"),H(r),Q(r.id||o)}),u({title:"Interview Prep Ready!",description:"Your interview prep PDF has been generated successfully.",duration:5e3}),q&&q().then(()=>{console.log("âœ… Interview Prep complete!")}),E(r);return}if(r.status==="failed"||r.status==="parsing_failed"){if(clearInterval(N),r.needsManualInput||r.status==="parsing_failed"){V(!0),T(!1),A("idle"),u({title:"URL Parsing Failed",description:"Please enter the company name and job title manually below.",variant:"default"}),E(r);return}I(new Error(r.error||"Generation failed"));return}if(d>=L){clearInterval(N),setTimeout(async()=>{try{const a=await _.getInterviewPrepStatus(o);"pdfUrl"in a&&a.pdfUrl?(fe.flushSync(()=>{T(!1),A("completed"),h("Interview Prep ready!"),H(a),Q(a.id||o)}),u({title:"Interview Prep Ready!",description:"Your interview prep PDF has been generated successfully.",duration:5e3}),q&&q(),E(a)):I(new Error("Generation is taking longer than expected. Please check back in a few minutes."))}catch{I(new Error("Generation timed out. Please try again or check back later."))}},2e3);return}}catch(r){clearInterval(N),I(r)}},3e3)})}catch(n){console.error("Interview prep failed:",n),A("failed"),h("Generation failed"),u({title:"Generation Failed",description:n.message||"Please try again.",variant:"destructive"})}finally{T(!1)}},re=async s=>{const t=ke;if(!(!t||!P))try{let o,d,L;u({title:"Preparing PDF",description:"Please wait while we prepare your Interview Prep PDF...",duration:3e3});for(let r=0;r<20;r++){try{const a=await _.downloadInterviewPrepPDF(t);if(o=(a==null?void 0:a.pdfUrl)||void 0,d=(a==null?void 0:a.companyName)||void 0,L=(a==null?void 0:a.jobTitle)||void 0,o&&(await fetch(o,{method:"HEAD"})).ok)break}catch{}await new Promise(a=>setTimeout(a,1e3))}if(!o)throw new Error("PDF isn't ready yet. Please try again in a moment.");const X=r=>r.replace(/[^a-zA-Z0-9\s-]/g,"").replace(/\s+/g,"_").replace(/_+/g,"_").replace(/^_+|_+$/g,"").substring(0,50),E=d?X(d):"Company",I=L?X(L):"Role",N=`Oloop_interviewprep_${E}_${I}.pdf`;await new Promise(r=>setTimeout(r,500));try{const r=await fetch(o);if(!r.ok)throw new Error(`Failed to fetch PDF: ${r.status}`);const a=await r.blob(),D=window.URL.createObjectURL(a),w=document.createElement("a");w.href=D,w.download=N,w.style.display="none",document.body.appendChild(w),w.click(),setTimeout(()=>{document.body.removeChild(w),window.URL.revokeObjectURL(D)},100),u({title:"PDF Downloaded",description:"Your Interview Prep PDF has been downloaded.",duration:3e3})}catch(r){console.warn("Blob download failed, trying direct link:",r);const a=document.createElement("a");a.href=o,a.download=N,a.target="_blank",a.rel="noopener noreferrer",a.style.display="none",document.body.appendChild(a),a.click(),setTimeout(()=>{document.body.removeChild(a)},100),u({title:"PDF Download Started",description:"Your Interview Prep PDF download has started.",duration:3e3})}}catch(n){u({title:"Download Failed",description:n instanceof Error?n.message:"Could not download the PDF.",variant:"destructive"})}},ae=async s=>{try{if(s.pdfUrl){window.open(s.pdfUrl,"_blank","noopener");return}const{pdfUrl:t}=await _.downloadInterviewPrepPDF(s.id);if(t)window.open(t,"_blank","noopener");else throw new Error("PDF URL not available yet")}catch{u({title:"Download failed",description:"Could not open the PDF. Please try again.",variant:"destructive"})}},f=x.useMemo(()=>{const s=R.filter(n=>n.status==="completed"),t=R.filter(n=>n.status!=="completed");return{completed:s,inProgress:t}},[R]);return e.jsx(Ce,{children:e.jsxs("div",{className:"flex min-h-screen w-full bg-transparent text-foreground",children:[e.jsx(De,{}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("header",{className:"h-16 flex items-center justify-between border-b border-gray-100/30 px-6 bg-transparent shadow-sm relative z-20",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Fe,{className:"text-foreground hover:bg-secondary"}),e.jsx("h1",{className:"text-xl font-semibold",children:"Interview Prep"})]}),e.jsx(Ee,{})]}),e.jsx("main",{className:"p-8 bg-transparent",children:e.jsx("div",{className:"max-w-5xl mx-auto",children:U.tier!=="pro"?e.jsx(Ae,{featureName:"Interview Prep",requiredTier:"Pro",children:e.jsxs(be,{defaultValue:"interview-prep",className:"w-full",children:[e.jsx("div",{className:"flex justify-center mb-8",children:e.jsxs(je,{className:"h-14 tabs-container-gradient border border-border grid grid-cols-2 max-w-lg w-full rounded-xl p-1 bg-white",children:[e.jsxs($,{value:"interview-prep",className:"h-12 font-medium text-base data-[state=active] data-[state=active]:text-white data-[state=inactive]:text-muted-foreground transition-all",children:[e.jsx(B,{className:"h-5 w-5 mr-2"}),"Interview Prep"]}),e.jsxs($,{value:"interview-library",className:"h-12 font-medium text-base data-[state=active] data-[state=active]:text-white data-[state=inactive]:text-muted-foreground transition-all",children:[e.jsx(ue,{className:"h-5 w-5 mr-2"}),"Interview Library"]})]})}),e.jsx(O,{value:"interview-prep",className:"mt-6",children:e.jsxs(Y,{className:"bg-white border-border relative overflow-hidden",children:[e.jsx(we,{className:"border-b border-border",children:e.jsxs(Ne,{className:"text-xl text-foreground flex items-center gap-2",children:["Interview Prep",e.jsx(Pe,{size:"xs",variant:"glow"}),e.jsxs(ye,{variant:"secondary",className:"ml-auto",children:[y," credits"]})]})}),e.jsx(W,{className:"p-6",children:e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2 text-foreground",children:["Job Posting URL ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(b,{value:g,onChange:s=>{Z(s.target.value),s.target.value.trim()&&(V(!1),S(""),C(""))},placeholder:"Paste the job posting URL here...",className:"bg-white border-input text-foreground placeholder:text-muted-foreground focus:border-pink-500 hover:border-purple-400 transition-colors",disabled:c}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Supports LinkedIn, Indeed, Greenhouse, Lever, Workday, and most career pages. If URL parsing fails, you can enter company and job title manually below."})]}),!M&&!g.trim()&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-sm text-muted-foreground mb-2",children:"Or enter manually:"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-foreground",children:"Company Name"}),e.jsx(b,{value:j,onChange:s=>S(s.target.value),placeholder:"e.g., Google, Amazon, Meta",className:"bg-white border-input text-foreground placeholder:text-muted-foreground focus:border-pink-500 hover:border-purple-400 transition-colors",disabled:c})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-foreground",children:"Job Title"}),e.jsx(b,{value:v,onChange:s=>C(s.target.value),placeholder:"e.g., Software Engineer, Data Scientist",className:"bg-white border-input text-foreground placeholder:text-muted-foreground focus:border-pink-500 hover:border-purple-400 transition-colors",disabled:c})]})]}),l&&e.jsxs("div",{className:"bg-muted/30 rounded-xl p-4 border border-border",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground mb-3",children:"Job Details Preview:"}),e.jsxs("div",{className:"space-y-2 text-sm text-foreground",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Company:"})," ",l.company_name]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Role:"})," ",l.job_title]}),l.level&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Level:"})," ",l.level]}),l.team_division&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Team:"})," ",l.team_division]}),l.required_skills&&l.required_skills.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Key Skills:"})," ",l.required_skills.slice(0,5).join(", "),l.required_skills.length>5&&` +${l.required_skills.length-5} more`]})]})]}),M&&e.jsxs("div",{className:"bg-yellow-500/10 border border-yellow-500/30 rounded-xl p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(G,{className:"h-5 w-5 text-yellow-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-yellow-800 mb-1",children:"URL Parsing Failed - Manual Input Required"}),e.jsx("p",{className:"text-xs text-yellow-700/80 mb-3",children:"We couldn't parse the job posting URL. Please enter the details manually below."})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2 text-foreground",children:["Company Name ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(b,{value:j,onChange:s=>S(s.target.value),placeholder:"e.g., Google, Amazon, Meta",className:"bg-white border-input text-foreground placeholder:text-muted-foreground focus:border-pink-500 hover:border-purple-400 transition-colors",disabled:c})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2 text-foreground",children:["Job Title ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(b,{value:v,onChange:s=>C(s.target.value),placeholder:"e.g., Software Engineer, Data Scientist, Product Manager",className:"bg-white border-input text-foreground placeholder:text-muted-foreground focus:border-pink-500 hover:border-purple-400 transition-colors",disabled:c})]})]})]}),e.jsxs("div",{className:"bg-muted/30 rounded-xl p-4 border border-border",children:[e.jsx("p",{className:"text-sm text-foreground mb-2",children:e.jsx("span",{className:"font-semibold text-foreground",children:"What you'll receive:"})}),e.jsxs("ul",{className:"space-y-1.5 text-sm text-foreground",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(p,{className:"h-4 w-4 text-blue-600 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"Company-specific interview process overview"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(p,{className:"h-4 w-4 text-blue-600 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"Common questions grouped by category (Behavioral, Technical, System Design, etc.)"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(p,{className:"h-4 w-4 text-blue-600 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"Success tips from candidates who passed"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(p,{className:"h-4 w-4 text-blue-600 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"Red flags and things to avoid"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(p,{className:"h-4 w-4 text-blue-600 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"Culture insights and work environment details"})]})]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-3",children:["Uses ",y," credits. Analyzes the job posting, searches Reddit for role-specific interview insights, and generates a comprehensive 5-6 page prep guide tailored to this specific role."]})]}),e.jsx(F,{onClick:te,disabled:c||U.credits<y||!g.trim()&&(!j.trim()||!v.trim()),className:"w-full text-white font-semibold py-6 text-base shadow-lg transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",style:{background:"linear-gradient(135deg, #3B82F6, #60A5FA)"},children:c?e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"h-5 w-5 mr-2 animate-spin"}),"Generating Interview Prep..."]}):e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"h-5 w-5 mr-2"}),"Generate Interview Prep"]})}),m!=="idle"&&e.jsxs("div",{className:"rounded-lg border border-border bg-muted/50 p-4 shadow-inner text-sm text-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[c?e.jsx(z,{className:"h-4 w-4 animate-spin text-primary"}):m==="completed"?e.jsx(p,{className:"h-4 w-4 text-blue-600"}):m==="failed"?e.jsx(G,{className:"h-4 w-4 text-destructive"}):null,e.jsx("span",{className:"font-medium",children:m==="completed"?"Ready!":m==="failed"?"Failed":"Processing..."})]}),e.jsx("span",{className:"text-muted-foreground",children:K||"Processing your request..."})]}),m==="completed"&&i&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"rounded-xl border border-green-500/40 bg-green-500/10 p-5 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-sm font-semibold text-green-700 uppercase tracking-wide",children:[((ie=i.jobDetails)==null?void 0:ie.job_title)||((ne=i.jobDetails)==null?void 0:ne.company_name)||"Interview Prep"," - ",((le=i.jobDetails)==null?void 0:le.company_name)||""]}),e.jsx("span",{className:"text-xs text-blue-600/80",children:"Ready to download"})]}),i.insights&&e.jsxs("div",{className:"space-y-3 text-sm text-foreground",children:[((oe=i.insights.interview_process)==null?void 0:oe.stages)&&i.insights.interview_process.stages.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Interview Stages: "}),i.insights.interview_process.stages.map(s=>typeof s=="string"?s:(s==null?void 0:s.name)||"Stage").join(", ")]}),i.insights.common_questions&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Question Categories: "}),(()=>{const s=i.insights.common_questions;if(Array.isArray(s))return s.map(t=>t.category).join(", ");if(typeof s=="object"&&s!==null){const t=[],n=s;return n.behavioral&&t.push("Behavioral"),n.technical&&t.push("Technical"),n.company_specific&&t.push("Company-Specific"),t.join(", ")}return""})(),e.jsxs("div",{className:"mt-2 text-xs text-muted-foreground",children:["Sample questions preview:",e.jsx("ul",{className:"list-disc list-inside mt-1 space-y-1",children:(()=>{var n,k;const s=i.insights.common_questions,t=[];if(Array.isArray(s))s.slice(0,3).forEach(o=>{o.questions&&o.questions.slice(0,2).forEach(d=>{t.push(d)})});else if(typeof s=="object"&&s!==null){const o=s;(n=o.behavioral)!=null&&n.questions&&o.behavioral.questions.slice(0,2).forEach(d=>{t.push(typeof d=="string"?d:d.question||"")}),(k=o.technical)!=null&&k.questions&&t.length<3&&o.technical.questions.slice(0,2).forEach(d=>{t.push(typeof d=="string"?d:d.question||"")})}return t.slice(0,3).map((o,d)=>e.jsx("li",{className:"text-foreground",children:o},d))})()})]})]}),i.insights.sources_count&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Sources: "}),"Analyzed ",i.insights.sources_count," Reddit posts"]})]})]}),e.jsxs(F,{onClick:()=>re(),className:"w-full text-white font-semibold py-6 text-base shadow-lg",style:{background:"linear-gradient(135deg, #3B82F6, #60A5FA)"},children:[e.jsx(J,{className:"h-5 w-5 mr-2"}),"Download Full PDF"]})]}),m==="failed"&&(i==null?void 0:i.error)&&e.jsx("div",{className:"rounded-lg border border-red-500/40 bg-red-500/10 p-4",children:e.jsx("p",{className:"text-sm text-red-700",children:i.error})})]})})})]})}),e.jsx(O,{value:"interview-library",className:"mt-6",children:e.jsx("div",{className:"space-y-6",children:se?e.jsx(Y,{className:"bg-white border-border",children:e.jsx(W,{className:"p-6",children:e.jsx(ve,{variant:"card",count:3})})}):R.length===0?e.jsxs("div",{className:"rounded-xl border border-border bg-white p-10 text-center space-y-4",children:[e.jsx(B,{className:"h-10 w-10 mx-auto text-primary"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"No preps yet"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Generate your first interview prep to see it appear here."})]}):e.jsxs("div",{className:"space-y-6",children:[f.inProgress.length>0&&e.jsxs("section",{children:[e.jsx("h3",{className:"text-sm font-semibold text-muted-foreground uppercase mb-3",children:"In Progress"}),e.jsx("div",{className:"grid gap-4",children:f.inProgress.map(s=>e.jsxs("div",{className:"rounded-lg border border-yellow-500/40 bg-yellow-500/10 px-5 py-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-foreground font-medium",children:s.companyName}),s.jobTitle&&e.jsx("p",{className:"text-xs text-muted-foreground",children:s.jobTitle}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Requested ",s.createdAt?new Date(s.createdAt).toLocaleString():""]})]}),e.jsx("div",{className:"text-xs uppercase text-yellow-600",children:"Processing..."})]},s.id))})]}),f.completed.length>0&&e.jsxs("section",{className:"space-y-3",children:[e.jsxs("h3",{className:"text-sm font-semibold text-muted-foreground uppercase",children:["Completed (",f.completed.length,")"]}),e.jsx("div",{className:"grid gap-4",children:f.completed.map(s=>e.jsxs("div",{className:"rounded-xl border border-border bg-white p-5 flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-foreground font-medium",children:[e.jsx(he,{className:"h-4 w-4 text-primary"}),s.companyName]}),s.jobTitle&&e.jsx("div",{className:"text-sm text-foreground",children:s.jobTitle}),e.jsx("div",{className:"flex flex-wrap items-center gap-3 text-xs text-muted-foreground",children:e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ge,{className:"h-3 w-3"}),s.createdAt?new Date(s.createdAt).toLocaleDateString():"â€”"]})})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs(F,{size:"sm",variant:"outline",className:"border-primary text-primary hover:bg-primary/10",onClick:()=>ae(s),children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"PDF"]})})]},s.id))})]})]})})})]})}):e.jsxs(be,{defaultValue:"interview-prep",className:"w-full",children:[e.jsx("div",{className:"flex justify-center mb-8",children:e.jsxs(je,{className:"h-14 tabs-container-gradient border border-border grid grid-cols-2 max-w-lg w-full rounded-xl p-1 bg-white",children:[e.jsxs($,{value:"interview-prep",className:"h-12 font-medium text-base data-[state=active] data-[state=active]:text-white data-[state=inactive]:text-muted-foreground transition-all",children:[e.jsx(B,{className:"h-5 w-5 mr-2"}),"Interview Prep"]}),e.jsxs($,{value:"interview-library",className:"h-12 font-medium text-base data-[state=active] data-[state=active]:text-white data-[state=inactive]:text-muted-foreground transition-all",children:[e.jsx(ue,{className:"h-5 w-5 mr-2"}),"Interview Library"]})]})}),e.jsx(O,{value:"interview-prep",className:"mt-6",children:e.jsxs(Y,{className:"bg-white border-border relative overflow-hidden",children:[e.jsx(we,{className:"border-b border-border",children:e.jsxs(Ne,{className:"text-xl text-foreground flex items-center gap-2",children:["Interview Prep",e.jsx(Pe,{size:"xs",variant:"glow"}),e.jsxs(ye,{variant:"secondary",className:"ml-auto",children:[y," credits"]})]})}),e.jsx(W,{className:"p-6",children:e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2 text-foreground",children:["Job Posting URL ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(b,{value:g,onChange:s=>{Z(s.target.value),s.target.value.trim()&&(V(!1),S(""),C(""))},placeholder:"Paste the job posting URL here...",className:"bg-white border-input text-foreground placeholder:text-muted-foreground focus:border-pink-500 hover:border-purple-400 transition-colors",disabled:c}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Supports LinkedIn, Indeed, Greenhouse, Lever, Workday, and most career pages. If URL parsing fails, you can enter company and job title manually below."})]}),!M&&!g.trim()&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-sm text-muted-foreground mb-2",children:"Or enter manually:"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-foreground",children:"Company Name"}),e.jsx(b,{value:j,onChange:s=>S(s.target.value),placeholder:"e.g., Google, Amazon, Meta",className:"bg-white border-input text-foreground placeholder:text-muted-foreground focus:border-pink-500 hover:border-purple-400 transition-colors",disabled:c})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-foreground",children:"Job Title"}),e.jsx(b,{value:v,onChange:s=>C(s.target.value),placeholder:"e.g., Software Engineer, Data Scientist",className:"bg-white border-input text-foreground placeholder:text-muted-foreground focus:border-pink-500 hover:border-purple-400 transition-colors",disabled:c})]})]}),l&&e.jsxs("div",{className:"bg-muted/30 rounded-xl p-4 border border-border",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground mb-3",children:"Job Details Preview:"}),e.jsxs("div",{className:"space-y-2 text-sm text-foreground",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Company:"})," ",l.company_name]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Role:"})," ",l.job_title]}),l.level&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Level:"})," ",l.level]}),l.team_division&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Team:"})," ",l.team_division]}),l.required_skills&&l.required_skills.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Key Skills:"})," ",l.required_skills.slice(0,5).join(", "),l.required_skills.length>5&&` +${l.required_skills.length-5} more`]})]})]}),M&&e.jsxs("div",{className:"bg-yellow-500/10 border border-yellow-500/30 rounded-xl p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(G,{className:"h-5 w-5 text-yellow-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-yellow-800 mb-1",children:"URL Parsing Failed - Manual Input Required"}),e.jsx("p",{className:"text-xs text-yellow-700/80 mb-3",children:"We couldn't parse the job posting URL. Please enter the details manually below."})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2 text-foreground",children:["Company Name ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(b,{value:j,onChange:s=>S(s.target.value),placeholder:"e.g., Google, Amazon, Meta",className:"bg-white border-input text-foreground placeholder:text-muted-foreground focus:border-pink-500 hover:border-purple-400 transition-colors",disabled:c})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2 text-foreground",children:["Job Title ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(b,{value:v,onChange:s=>C(s.target.value),placeholder:"e.g., Software Engineer, Data Scientist, Product Manager",className:"bg-white border-input text-foreground placeholder:text-muted-foreground focus:border-pink-500 hover:border-purple-400 transition-colors",disabled:c})]})]})]}),e.jsxs("div",{className:"bg-muted/30 rounded-xl p-4 border border-border",children:[e.jsx("p",{className:"text-sm text-foreground mb-2",children:e.jsx("span",{className:"font-semibold text-foreground",children:"What you'll receive:"})}),e.jsxs("ul",{className:"space-y-1.5 text-sm text-foreground",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(p,{className:"h-4 w-4 text-blue-600 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"Company-specific interview process overview"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(p,{className:"h-4 w-4 text-blue-600 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"Common questions grouped by category (Behavioral, Technical, System Design, etc.)"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(p,{className:"h-4 w-4 text-blue-600 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"Success tips from candidates who passed"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(p,{className:"h-4 w-4 text-blue-600 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"Red flags and things to avoid"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx(p,{className:"h-4 w-4 text-blue-600 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:"Culture insights and work environment details"})]})]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-3",children:["Uses ",y," credits. Analyzes the job posting, searches Reddit for role-specific interview insights, and generates a comprehensive 5-6 page prep guide tailored to this specific role."]})]}),e.jsx(F,{onClick:te,disabled:c||U.credits<y||!g.trim()&&(!j.trim()||!v.trim()),className:"w-full text-white font-semibold py-6 text-base shadow-lg transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed",style:{background:"linear-gradient(135deg, #3B82F6, #60A5FA)"},children:c?e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"h-5 w-5 mr-2 animate-spin"}),"Generating Interview Prep..."]}):e.jsxs(e.Fragment,{children:[e.jsx(pe,{className:"h-5 w-5 mr-2"}),"Generate Interview Prep"]})}),m!=="idle"&&e.jsxs("div",{className:"rounded-lg border border-border bg-muted/50 p-4 shadow-inner text-sm text-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[c?e.jsx(z,{className:"h-4 w-4 animate-spin text-primary"}):m==="completed"?e.jsx(p,{className:"h-4 w-4 text-blue-600"}):m==="failed"?e.jsx(G,{className:"h-4 w-4 text-destructive"}):null,e.jsx("span",{className:"font-medium",children:m==="completed"?"Ready!":m==="failed"?"Failed":"Processing..."})]}),e.jsx("span",{className:"text-muted-foreground",children:K||"Processing your request..."})]}),m==="completed"&&i&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"rounded-xl border border-green-500/40 bg-green-500/10 p-5 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-sm font-semibold text-green-700 uppercase tracking-wide",children:[((de=i.jobDetails)==null?void 0:de.job_title)||((ce=i.jobDetails)==null?void 0:ce.company_name)||"Interview Prep"," - ",((me=i.jobDetails)==null?void 0:me.company_name)||""]}),e.jsx("span",{className:"text-xs text-blue-600/80",children:"Ready to download"})]}),i.insights&&e.jsxs("div",{className:"space-y-3 text-sm text-foreground",children:[((xe=i.insights.interview_process)==null?void 0:xe.stages)&&i.insights.interview_process.stages.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Interview Stages: "}),i.insights.interview_process.stages.map(s=>typeof s=="string"?s:(s==null?void 0:s.name)||"Stage").join(", ")]}),i.insights.common_questions&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Question Categories: "}),(()=>{const s=i.insights.common_questions;if(Array.isArray(s))return s.map(t=>t.category).join(", ");if(typeof s=="object"&&s!==null){const t=[],n=s;return n.behavioral&&t.push("Behavioral"),n.technical&&t.push("Technical"),n.company_specific&&t.push("Company-Specific"),t.join(", ")}return""})()]}),i.insights.sources_count&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Sources: "}),"Analyzed ",i.insights.sources_count," Reddit posts"]})]})]}),e.jsxs(F,{onClick:()=>re(),className:"w-full text-white font-semibold py-6 text-base shadow-lg",style:{background:"linear-gradient(135deg, #3B82F6, #60A5FA)"},children:[e.jsx(J,{className:"h-5 w-5 mr-2"}),"Download Full PDF"]})]}),m==="failed"&&(i==null?void 0:i.error)&&e.jsx("div",{className:"rounded-lg border border-red-500/40 bg-red-500/10 p-4",children:e.jsx("p",{className:"text-sm text-red-700",children:i.error})})]})})})]})}),e.jsx(O,{value:"interview-library",className:"mt-6",children:e.jsx("div",{className:"space-y-6",children:se?e.jsx(Y,{className:"bg-white border-border",children:e.jsx(W,{className:"p-6",children:e.jsx(ve,{variant:"card",count:3})})}):R.length===0?e.jsxs("div",{className:"rounded-xl border border-border bg-white p-10 text-center space-y-4",children:[e.jsx(B,{className:"h-10 w-10 mx-auto text-primary"}),e.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"No preps yet"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Generate your first interview prep to see it appear here."})]}):e.jsxs("div",{className:"space-y-6",children:[f.inProgress.length>0&&e.jsxs("section",{children:[e.jsx("h3",{className:"text-sm font-semibold text-muted-foreground uppercase mb-3",children:"In Progress"}),e.jsx("div",{className:"grid gap-4",children:f.inProgress.map(s=>e.jsxs("div",{className:"rounded-lg border border-yellow-500/40 bg-yellow-500/10 px-5 py-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-foreground font-medium",children:s.companyName}),s.jobTitle&&e.jsx("p",{className:"text-xs text-muted-foreground",children:s.jobTitle}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Requested ",s.createdAt?new Date(s.createdAt).toLocaleString():""]})]}),e.jsx("div",{className:"text-xs uppercase text-yellow-600",children:"Processing..."})]},s.id))})]}),f.completed.length>0&&e.jsxs("section",{className:"space-y-3",children:[e.jsxs("h3",{className:"text-sm font-semibold text-muted-foreground uppercase",children:["Completed (",f.completed.length,")"]}),e.jsx("div",{className:"grid gap-4",children:f.completed.map(s=>e.jsxs("div",{className:"rounded-xl border border-border bg-white p-5 flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-foreground font-medium",children:[e.jsx(he,{className:"h-4 w-4 text-primary"}),s.companyName]}),s.jobTitle&&e.jsx("div",{className:"text-sm text-foreground",children:s.jobTitle}),e.jsx("div",{className:"flex flex-wrap items-center gap-3 text-xs text-muted-foreground",children:e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ge,{className:"h-3 w-3"}),s.createdAt?new Date(s.createdAt).toLocaleDateString():"â€”"]})})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs(F,{size:"sm",variant:"outline",className:"border-primary text-primary hover:bg-primary/10",onClick:()=>ae(s),children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"PDF"]})})]},s.id))})]})]})})})]})})})]})]})})};export{ts as default};
